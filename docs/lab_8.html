<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.433">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Моделювання складних систем у Python - 8&nbsp; Лабораторна робота № 8</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./lab_9.html" rel="next">
<link href="./lab_7.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="site_libs/bootstrap/bootstrap-dark.min.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "Пошук не дав результату",
    "search-matching-documents-text": "Результати пошуку",
    "search-copy-link-title": "Скопіюйте посилання для пошуку",
    "search-hide-matches-text": "Приховати додаткові результати",
    "search-more-match-text": "Додатковий результат у цьому документі",
    "search-more-matches-text": "Додаткові результати у цьому документі",
    "search-clear-button-title": "Очистити",
    "search-detached-cancel-button-title": "Скасувати",
    "search-submit-button-title": "Надіслати",
    "search-label": "Search"
  }
}</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script>
<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML" type="text/javascript"></script>

<link rel="stylesheet" href="style.css">
</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
      <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./lab_8.html"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Лабораторна робота № 8</span></a></li></ol></nav>
      <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
      </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-full">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Моделювання складних систем у Python</a> 
        <div class="sidebar-tools-main tools-wide">
    <a href="https://github.com/Butman2099/Complex-systems-book" rel="" title="Source Code" class="quarto-navigation-tool px-1" aria-label="Source Code"><i class="bi bi-github"></i></a>
    <a href="./Моделювання-складних-систем-у-Python.docx" rel="" title="Download Docx" class="quarto-navigation-tool px-1" aria-label="Download Docx"><i class="bi bi-file-word"></i></a>
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Передмова</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./lab_1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Лабораторна робота № 1</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./lab_2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Лабораторна робота № 2</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./lab_3.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Лабораторна робота № 3</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./lab_4.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Лабораторна робота № 4</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./lab_5.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Лабораторна робота № 5</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./lab_6.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Лабораторна робота № 6</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./lab_7.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Лабораторна робота № 7</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./lab_8.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Лабораторна робота № 8</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./lab_9.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Лабораторна робота № 9</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./lab_10.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Лабораторна робота № 10</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./lab_11.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Лабораторна робота № 11</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./lab_12.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Лабораторна робота № 12</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./lab_13.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Лабораторна робота № 13</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./lab_14.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Лабораторна робота № 14</span></span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
 <span class="menu-text">Додатки</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./appa.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">A</span>&nbsp; <span class="chapter-title">Інструкція зі встановлення Anaconda Navigator</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./appb.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">B</span>&nbsp; <span class="chapter-title">Вступ до мови програмування Python</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./appc.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">C</span>&nbsp; <span class="chapter-title">Основи Jupyter Notebook</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">D</span>&nbsp; <span class="chapter-title">Список рекомендованої літератури</span></span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Зміст</h2>
   
  <ul>
  <li><a href="#теоретичні-відомості" id="toc-теоретичні-відомості" class="nav-link active" data-scroll-target="#теоретичні-відомості"><span class="header-section-number">8.1</span> Теоретичні відомості</a>
  <ul class="collapse">
  <li><a href="#знаходження-коефіцієнтів-матриці-крос-кореляцій" id="toc-знаходження-коефіцієнтів-матриці-крос-кореляцій" class="nav-link" data-scroll-target="#знаходження-коефіцієнтів-матриці-крос-кореляцій"><span class="header-section-number">8.1.1</span> Знаходження коефіцієнтів матриці крос-кореляцій</a></li>
  <li><a href="#розподіл-власних-значень" id="toc-розподіл-власних-значень" class="nav-link" data-scroll-target="#розподіл-власних-значень"><span class="header-section-number">8.1.2</span> Розподіл власних значень</a></li>
  <li><a href="#розподіл-власних-векторів" id="toc-розподіл-власних-векторів" class="nav-link" data-scroll-target="#розподіл-власних-векторів"><span class="header-section-number">8.1.3</span> Розподіл власних векторів</a></li>
  <li><a href="#обернене-відношення-участі" id="toc-обернене-відношення-участі" class="nav-link" data-scroll-target="#обернене-відношення-участі"><span class="header-section-number">8.1.4</span> Обернене відношення участі</a></li>
  </ul></li>
  <li><a href="#хід-роботи" id="toc-хід-роботи" class="nav-link" data-scroll-target="#хід-роботи"><span class="header-section-number">8.2</span> Хід роботи</a>
  <ul class="collapse">
  <li><a href="#знаходження-коефіцієнтів-матриці-крос-кореляцій-1" id="toc-знаходження-коефіцієнтів-матриці-крос-кореляцій-1" class="nav-link" data-scroll-target="#знаходження-коефіцієнтів-матриці-крос-кореляцій-1"><span class="header-section-number">8.2.1</span> Знаходження коефіцієнтів матриці крос-кореляцій</a></li>
  <li><a href="#розподіл-власних-значень-та-векторів" id="toc-розподіл-власних-значень-та-векторів" class="nav-link" data-scroll-target="#розподіл-власних-значень-та-векторів"><span class="header-section-number">8.2.2</span> Розподіл власних значень та векторів</a></li>
  <li><a href="#обернене-відношення-участі-1" id="toc-обернене-відношення-участі-1" class="nav-link" data-scroll-target="#обернене-відношення-участі-1"><span class="header-section-number">8.2.3</span> Обернене відношення участі</a></li>
  <li><a href="#коефіцієнт-поглинання" id="toc-коефіцієнт-поглинання" class="nav-link" data-scroll-target="#коефіцієнт-поглинання"><span class="header-section-number">8.2.4</span> Коефіцієнт поглинання</a></li>
  <li><a href="#віконна-процедура" id="toc-віконна-процедура" class="nav-link" data-scroll-target="#віконна-процедура"><span class="header-section-number">8.2.5</span> Віконна процедура</a></li>
  </ul></li>
  <li><a href="#завдання-для-самостійної-роботи" id="toc-завдання-для-самостійної-роботи" class="nav-link" data-scroll-target="#завдання-для-самостійної-роботи"><span class="header-section-number">8.3</span> Завдання для самостійної роботи</a></li>
  <li><a href="#контрольні-запитання" id="toc-контрольні-запитання" class="nav-link" data-scroll-target="#контрольні-запитання"><span class="header-section-number">8.4</span> Контрольні запитання</a></li>
  </ul>
<div class="toc-actions"><div><i class="bi bi-github"></i></div><div class="action-links"><p><a href="https://github.dev/Butman2099/Complex-systems-book/blob/main/lab_8.ipynb" class="toc-action">Редагувати сторінку</a></p></div></div></nav>
    </div>
<!-- main -->
<main class="content column-body" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Лабораторна робота № 8</span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<p><strong>Тема.</strong> Дослідження процесів самоорганізації в складних системах із використання теорії випадкових матриць</p>
<p><strong>Мета.</strong> Навчитись використовувати методи теорії випадкових матриць для отримання «прихованої» інформації в складних економічних системах</p>
<section id="теоретичні-відомості" class="level2" data-number="8.1">
<h2 data-number="8.1" class="anchored" data-anchor-id="теоретичні-відомості"><span class="header-section-number">8.1</span> Теоретичні відомості</h2>
<p>Вивчення статистичних властивостей матриць з незалежними випадковими елементами — випадкових матриць — має багату історію, що починається з ядерної фізики <span class="citation" data-cites="Wigner_1951_1 Wigner_1951_2 10.1063/1.1703773 10.1063/1.1704008 10.1063/1.1704009 mehta1991random RevModPhys.53.385">&nbsp;[<a href="references.html#ref-Wigner_1951_1" role="doc-biblioref">1</a>–<a href="references.html#ref-RevModPhys.53.385" role="doc-biblioref">7</a>]</span>, де проблема з’явилася 50 років тому при дослідженні енергетичних рівнів складних ядер, що існуючі на той час моделі були не в змозі пояснити. Теорія випадкової матриці (ТВМ) була розвинена в цьому контексті Вігнером (Wigner), Дайсоном (Dyson), Метою (Mehta) та іншими для пояснення статистики рівнів енергії складних квантових систем. Дослідники постулювали, що функція Гамільтона, яка описує важкі ядра, може бути задана матрицею <span class="math inline">\(H\)</span> з незалежними випадковими елементами <span class="math inline">\(H_{ij}\)</span>, отриманими з розподілу імовірності. Відштовхуючись від цього припущення було зроблено низку вражаючих передбачень, які було підтверджено експериментально. Для складних квантових систем передбачення на основі ТВМ представляють середнє за всіма можливими взаємодіями. Відхилення від універсальних передбачень ТВМ відображують системну специфіку, невипадкові властивості системи, забезпечуючи ключові підходи до розуміння базової взаємодії системи. Недавні дослідження, що використовували методи аналізу ТВМ до аналізу властивостей матриці взаємних кореляцій <span class="math inline">\(C\)</span>, показують, що близько 98% власних значень матриці <span class="math inline">\(C\)</span> співпадають зі значеннями, отримуваними з використанням ТВМ, таким чином пропонуючи задовільний рівень хаотичності у вимірюваних крос-кореляціях. Також було знайдено, що існують відхилення від передбачень за допомогою ТВМ у близько 2% найбільших власних значень. Ці результати викликають наступні питання:</p>
<ol type="1">
<li>Яка можлива інтерпретація для відхилень від ТВМ?</li>
<li>Що можна сказати про структуру C з цих результатів?</li>
<li>Яке практичне значення отриманих результатів?</li>
</ol>
<p>Шляхом комп’ютерного моделювання виявлено, що найбільше власне значення матриці <span class="math inline">\(C\)</span> представляє вплив усього ринку, що є звичайним для всіх акцій. Аналіз змісту власних значень, що відхиляються від ТВМ, показує існування взаємних кореляцій між акціями того ж самого типу промисловості, найбільш капіталізованими акціями, і акціями фірм, що мають бізнес у певному географічному секторі (локалізовані територіально). Обчислюючи скалярний добуток власних векторів від одного періоду часу до наступного, можна побачити, що “власні вектори, що відхиляються”, мають різні ступені стабільності в часі, визначеному кількісно величиною скалярного добутку. Найбільші два-три власних вектори стійкі протягом тривалих періодів часу, у той час як для іншої частини власних векторів, що відхиляються, стабільність у часі зменшується як тільки відповідні власні значення наближаються до верхньої межі ТВМ.</p>
<section id="знаходження-коефіцієнтів-матриці-крос-кореляцій" class="level3" data-number="8.1.1">
<h3 data-number="8.1.1" class="anchored" data-anchor-id="знаходження-коефіцієнтів-матриці-крос-кореляцій"><span class="header-section-number">8.1.1</span> Знаходження коефіцієнтів матриці крос-кореляцій</h3>
<p>Визначення кореляцій між різними акціями — тема, цікава не лише з точки зору наукових причин розуміння економіки як складної динамічної системи, але також і з практичних поглядів, зокрема, з точки зору розміщення активів і оцінки портфельного ризику. Ми будемо аналізувати взаємні кореляції між акціями, застосовуючи поняття і методи теорії випадкових матриць, що використовуються в контексті складних квантових систем, де точний характер взаємодій між підодиницями невідомий.</p>
<p>Для визначення кількісно кореляцій спочатку обчислюється зміна цін (прибутковості) акції <span class="math inline">\(i=1,...,N\)</span> за час <span class="math inline">\(\Delta t\)</span>,</p>
<p><span id="eq-8-1"><span class="math display">\[
G_{i}(t) = \ln S_i(t+\Delta t) - \ln S_i(t),
\qquad(8.1)\]</span></span></p>
<p>де <span class="math inline">\(S_i(t)\)</span> позначає ціну акції <span class="math inline">\(i\)</span>. Оскільки різні ціни мають різні рівні змінюванності (стандартні відхилення), визначатимемо стандартизовану прибутковість</p>
<p><span id="eq-8-2"><span class="math display">\[
g_i(t) \equiv \left[ G_i(t) - \left\langle G_i \right\rangle \right] \big/ \sigma_i,
\qquad(8.2)\]</span></span></p>
<p>де <span class="math inline">\(\sigma_i \equiv \sqrt{\left\langle G_{i}^{2} \right\rangle - \left\langle G_i \right\rangle^{2}}\)</span> — стандартне відхилення <span class="math inline">\(G_i\)</span>, а <span class="math inline">\(\left\langle...\right\rangle\)</span> позначає середнє значення за досліджуваний період часу. Тобі обчислення кореляцій <span class="math inline">\(C\)</span> зводиться до обчислення формули:</p>
<p><span id="eq-8-3"><span class="math display">\[
C_{ij} \equiv \left\langle g_i(t)g_j(t) \right\rangle.
\qquad(8.3)\]</span></span></p>
<p>Згідно з побудовою елементи <span class="math inline">\(C_{ij}\)</span> обмежені областю <span class="math inline">\(−1 \leq C_{ij} \leq 1\)</span>, де <span class="math inline">\(C_{ij} = 1\)</span> відповідає повним кореляціям, <span class="math inline">\(C_{ij} = -1\)</span> — повним антикореляціям, і <span class="math inline">\(C_{ij} = 0\)</span> свідчить про некорельованність пар акцій.</p>
<p>Труднощі в аналізі важливості та значення коефіцієнтів крос-кореляції <span class="math inline">\(C_{ij}\)</span> виникають внаслідок кількох причин, що полягають в наступному:</p>
<ol type="1">
<li>ринкові умови з часом змінюються і взаємна кореляція, що існує між будь-якою парою акцій, може бути не постійною (нестаціонарною);</li>
<li>скінчена довжина досліджуваного ряду, доступного для оцінювання взаємних кореляцій, додає так званий “шум вимірювання” — чим коротший досліджуваний ряд — тим менш точними будуть отримувані значення.</li>
</ol>
<p>Якщо буде використано довгий ряд для вилучення проблеми скінченної довжини, на отримані значення буде впливати нестаціонарність крос-кореляцій. З цих причин, емпірично виміряні крос-кореляції будуть містити “випадкові” складові, і найбільш важливою (і одночасно важкою проблемою) є оцінка в складі матриці <span class="math inline">\(C\)</span> таких взаємних кореляцій, що не є результатом випадковості.</p>
<p>Яким же чином можна виділяти з <span class="math inline">\(C_{ij}\)</span> ті акції, що залишилися корельованими на розглядуваному періоді часу? Щоб відповісти на це питання, перевіримо статистику <span class="math inline">\(C\)</span> у порівнянні із так званою “нульовою гіпотезою” випадкової кореляційної матриці — матриці кореляцій, побудованої із взаємно некорельованих часових рядів. Якщо властивості <span class="math inline">\(C\)</span> відповідають властивостям для випадкової матриці кореляцій, тоді можна говорити про те, що значення емпірично вимірюваних властивостей <span class="math inline">\(C\)</span> випадкові. Навпаки, відхилення властивостей <span class="math inline">\(C\)</span> від таких же властивостей для випадкової кореляційної матриці передає інформацію про “справжні” кореляції. Таким чином, нашою метою є порівняння властивостей <span class="math inline">\(C\)</span> з такими ж властивостями випадкової матриці кореляцій і розділ властивостей <span class="math inline">\(C\)</span> на дві групи: (a) частина <span class="math inline">\(C\)</span>, що відповідає властивостям випадкової кореляційної матриці (“шум”) і (b) частина <span class="math inline">\(C\)</span>, що відхиляється (“інформація”).</p>
</section>
<section id="розподіл-власних-значень" class="level3" data-number="8.1.2">
<h3 data-number="8.1.2" class="anchored" data-anchor-id="розподіл-власних-значень"><span class="header-section-number">8.1.2</span> Розподіл власних значень</h3>
<p>Для отримання інформації про взаємні кореляції <span class="math inline">\(C\)</span> необхідно порівняти властивості <span class="math inline">\(C\)</span> з такими ж властивостями випадкової матриці крос-кореляцій <span class="citation" data-cites="PhysRevLett.83.1467">&nbsp;[<a href="references.html#ref-PhysRevLett.83.1467" role="doc-biblioref">8</a>]</span>. У матричній нотації така матриця може бути виражена як</p>
<p><span id="eq-8-4"><span class="math display">\[
C = \frac{1}{L} GG^{T},
\qquad(8.4)\]</span></span></p>
<p>де <span class="math inline">\(G\)</span> — матриця розміру <span class="math inline">\(N \times L\)</span> з елементами <span class="math inline">\(g_{im}=g_i(m\Delta t), i=1,...,N; m=0,...,L-1\)</span> і <span class="math inline">\(G^{T}\)</span> позначає транспонування <span class="math inline">\(G\)</span>. Розглянемо випадкову кореляційну матрицю</p>
<p><span id="eq-8-5"><span class="math display">\[
R = \frac{1}{L} AA^{T},
\qquad(8.5)\]</span></span></p>
<p>де <span class="math inline">\(A\)</span> — матриця розміру <span class="math inline">\(N \times L\)</span>, що містить <span class="math inline">\(N\)</span> часових рядів із <span class="math inline">\(L\)</span> випадковими елементів <span class="math inline">\(a_{im}\)</span> з нульовим середнім і одиничним відхиленням, що означають взаємну некорельованість. За побудовою <span class="math inline">\(R\)</span> належить до типу матриць, які часто називають матрицями Вішарта у багатовимірній статистиці <span class="citation" data-cites="Muirhead">&nbsp;[<a href="references.html#ref-Muirhead" role="doc-biblioref">9</a>]</span>.</p>
<p>Статистичні властивості випадкових матриць <span class="math inline">\(R\)</span> відомі <span class="citation" data-cites="dyson1971distribution PhysRevE.60.3389">&nbsp;[<a href="references.html#ref-dyson1971distribution" role="doc-biblioref">10</a>,<a href="references.html#ref-PhysRevE.60.3389" role="doc-biblioref">11</a>]</span>. Зокрема, у наближенні <span class="math inline">\(N \to \infty\)</span>, <span class="math inline">\(L \to \infty\)</span>, такому, що <span class="math inline">\(Q \equiv L/N(&gt;1)\)</span> фіксоване, показано аналітично <span class="citation" data-cites="PhysRevE.60.3389">&nbsp;[<a href="references.html#ref-PhysRevE.60.3389" role="doc-biblioref">11</a>]</span>, що функція розподілу щільності імовірності <span class="math inline">\(P_{rm}(\lambda)\)</span> власних значень <span class="math inline">\(\lambda\)</span> випадкової матриці кореляції <span class="math inline">\(R\)</span> визначається як</p>
<p><span id="eq-8-6"><span class="math display">\[
P_{rm}(\lambda) = \frac{Q}{2\pi}\frac{\sqrt{(\lambda_{+} - \lambda)(\lambda - \lambda_{-})}}{\lambda}
\qquad(8.6)\]</span></span></p>
<p>де <span class="math inline">\(\lambda\)</span> в межах границь <span class="math inline">\(\lambda_{-} \leq \lambda_{i} \leq \lambda_{+}\)</span>, де <span class="math inline">\(\lambda_{-}\)</span> і <span class="math inline">\(\lambda_{+}\)</span> — найменше та найбільше власні значення <span class="math inline">\(R\)</span>, які можна визначити аналітично як</p>
<p><span id="eq-8-7"><span class="math display">\[
\lambda_{\pm} = 1 + 1/Q \pm 2\sqrt{1/Q}.
\qquad(8.7)\]</span></span></p>
<p>Звертаємо вашу увагу, що вираз (<a href="#eq-8-6">Рівняння&nbsp;<span>8.6</span></a>) є точним для випадку розподілених за Гаусом матричних елементів <span class="math inline">\(a_{im}\)</span>.</p>
<p>Порівняємо розподіл власних значень <span class="math inline">\(P(\lambda)\)</span> для <span class="math inline">\(C\)</span> з <span class="math inline">\(P_{rm}(\lambda)\)</span>. Для цього обчислимо власні значення <span class="math inline">\(\lambda_i\)</span> матриці <span class="math inline">\(C\)</span>, причому <span class="math inline">\(\lambda_i\)</span> впорядкуємо за зростанням (<span class="math inline">\(\lambda_{i+1} &gt; \lambda_{i}\)</span>). При дослідженнях зверніть увагу на присутність чіткої “великої частини” власних значень, що спадають у межах границь <span class="math inline">\([\lambda_{-}, \lambda_{+}]\)</span> для <span class="math inline">\(P_{rm}(\lambda)\)</span>. Також зверніть увагу на відхилення для деяких найбільших і найменших власних значень власних значень отриманих за допомогою ТВМ.</p>
<p>Оскільки <a href="#eq-8-6">Рівняння&nbsp;<span>8.6</span></a> є такою, що строго відповідає лише для <span class="math inline">\(L \to \infty\)</span> і <span class="math inline">\(N \to \infty\)</span>, необхідно перевірити також відхилення від ідеального випадку, оскільки робота проводиться завжди із <strong>скінченими</strong> рядами. При дослідженнях виявляється, що для кількох найбільших (найменших) власних значень ефект впливу скінчених величин <span class="math inline">\(L\)</span> і <span class="math inline">\(N\)</span> відсутній.</p>
</section>
<section id="розподіл-власних-векторів" class="level3" data-number="8.1.3">
<h3 data-number="8.1.3" class="anchored" data-anchor-id="розподіл-власних-векторів"><span class="header-section-number">8.1.3</span> Розподіл власних векторів</h3>
<p>Відхилення <span class="math inline">\(P(\lambda)\)</span> від передбачення ТВМ <span class="math inline">\(P_{rm}(\lambda)\)</span> свідчить про те, що ці відхилення також повинні відображатися в статистиці відповідних компонент власного вектора <span class="citation" data-cites="PhysRevLett.83.1467">&nbsp;[<a href="references.html#ref-PhysRevLett.83.1467" role="doc-biblioref">8</a>]</span>. Відповідно, у даній лабораторній ми будемо аналізувати розподіл компонент власного вектора. Розподіл компонент <span class="math inline">\(\left\{ u_{l}^{k}; l=1,...,N \right\}\)</span> власного вектора <span class="math inline">\(u^k\)</span> випадкової кореляційної матриці <span class="math inline">\(R\)</span> має відповідати розподілу Гауса з нульовим середнім та одиничною дисперсією,</p>
<p><span class="math display">\[
\rho_{rm}(u) = \frac{1}{\sqrt{2\pi}}\exp\left( -u^{2} \big/ 2 \right).
\]</span></p>
</section>
<section id="обернене-відношення-участі" class="level3" data-number="8.1.4">
<h3 data-number="8.1.4" class="anchored" data-anchor-id="обернене-відношення-участі"><span class="header-section-number">8.1.4</span> Обернене відношення участі</h3>
<p>Вивчивши інтерпретацію найбільшого власного значення, що значно відхиляється від результатів ТВМ, зосередимось на власних значеннях, що залишаються. Відхилення розподілу компонентів власного вектора <span class="math inline">\(u_k\)</span> від ТВМ Гаусового передбачення більш явне, коли відстань від верхньої границі ТВМ <span class="math inline">\(\lambda_k - \lambda_{+}\)</span> збільшується. Оскільки близькість до <span class="math inline">\(\lambda_{+}\)</span> збільшує ефекти хаотичності визначаємо кількість компонентів, що беруть значну участь в кожному власному векторі, що, у свою чергу, відображає ступінь відхилення від ТВМ для розподілу компонентів власного вектора. Для цього використовується поняття оберненого відношення участі (ОВУ) <span class="citation" data-cites="PhysRevLett.83.1471 GUHR1998189 PhysRevLett.69.1093">&nbsp;[<a href="references.html#ref-PhysRevLett.83.1471" role="doc-biblioref">12</a>–<a href="references.html#ref-PhysRevLett.69.1093" role="doc-biblioref">14</a>]</span>, що часто застосовується в теорії локалізації. ОВУ власного вектора <span class="math inline">\(u_k\)</span> визначається як</p>
<p><span id="eq-8-8"><span class="math display">\[
I^{k} \equiv \sum_{l=1}^{N}\left[ u_{l}^{k} \right]^4,
\qquad(8.8)\]</span></span></p>
<p>де <span class="math inline">\(u_{l}^{k}\)</span>, <span class="math inline">\(l=1,...,N\)</span> — компоненти власного вектора <span class="math inline">\(u^{k}\)</span>. Значення <span class="math inline">\(I^{k}\)</span> може бути проілюстровано двома граничними випадками:</p>
<ol type="1">
<li>вектор з ідентичними компонентами <span class="math inline">\(u_{l}^{k} \equiv 1 \big/ \sqrt{N}\)</span> має <span class="math inline">\(I^{k} = 1 \big/ N\)</span>;<br>
</li>
<li>вектор з одним компонентом <span class="math inline">\(u_{1}^{k}=1\)</span> і нульовими іншими має <span class="math inline">\(I^{k}=1\)</span>.</li>
</ol>
<p>Таким чином, ОВУ визначає кількість даних з числа компонентів власного вектора, що значний впливають на ринок, заданий системою часових рядів. Наявність векторів з великими значеннями <span class="math inline">\(I^{k}\)</span> також виникає в теорії локалізації Андерсона. У контексті теорії локалізації часто знаходять “випадкову смугу матриць”, що містять узагальнені стани з маленьким <span class="math inline">\(I^{k}\)</span> в більшій частині спектра власних значень, тоді як основні стани локалізовані і мають великі <span class="math inline">\(I^{k}\)</span>. Виявлення локалізованих станів для маленьких і великих власних значень матриці крос-кореляцій <span class="math inline">\(C\)</span> нагадує про локалізацію Андерсона і припускає, що <span class="math inline">\(C\)</span> може мати випадкову зону матричної структури.</p>
</section>
</section>
<section id="хід-роботи" class="level2" data-number="8.2">
<h2 data-number="8.2" class="anchored" data-anchor-id="хід-роботи"><span class="header-section-number">8.2</span> Хід роботи</h2>
<p>Імпортуємо необхідні бібліотеки:</p>
<div class="cell" data-execution_count="374">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.gridspec <span class="im">as</span> gridspec</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.ticker <span class="im">as</span> mticker</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> yfinance <span class="im">as</span> yf</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> scienceplots</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> requests</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> tqdm <span class="im">import</span> tqdm</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="op">%</span>matplotlib inline</span></code><button title="Копіювати" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Визначаємо стиль рисунків:</p>
<div class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>plt.style.use([<span class="st">'science'</span>, <span class="st">'notebook'</span>, <span class="st">'grid'</span>]) <span class="co"># стиль, що використовуватиметься</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>                                               <span class="co"># для виведення рисунків</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>params <span class="op">=</span> {</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">'figure.figsize'</span>: (<span class="dv">8</span>, <span class="dv">6</span>),         <span class="co"># встановлюємо ширину та висоту рисунків за замовчуванням</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">'font.size'</span>: <span class="dv">22</span>,                  <span class="co"># розмір фонтів рисунку</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">'lines.linewidth'</span>: <span class="dv">2</span>,             <span class="co"># товщина ліній</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>    <span class="st">'axes.titlesize'</span>: <span class="st">'small'</span>,        <span class="co"># розмір титулки над рисунком</span></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>    <span class="st">"font.family"</span>: <span class="st">"sans-serif"</span>,      <span class="co"># сімейство стилів підписів </span></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>    <span class="st">"font.serif"</span>: [<span class="st">"Times"</span>],          <span class="co"># стиль підпису</span></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>    <span class="st">'savefig.dpi'</span>: <span class="dv">300</span>                <span class="co"># якість збережених зображень</span></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>plt.rcParams.update(params)           <span class="co"># оновлення стилю згідно налаштувань</span></span></code><button title="Копіювати" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Виконуємо парсинг та фільтрацію заголовків акцій компаній:</p>
<div class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>headers <span class="op">=</span> {</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">'authority'</span>: <span class="st">'api.nasdaq.com'</span>,</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">'accept'</span>: <span class="st">'application/json, text/plain, */*'</span>,</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">'user-agent'</span>: <span class="st">'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/87.0.4280.141 Safari/537.36'</span>,</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">'origin'</span>: <span class="st">'https://www.nasdaq.com'</span>,</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">'sec-fetch-site'</span>: <span class="st">'same-site'</span>,</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">'sec-fetch-mode'</span>: <span class="st">'cors'</span>,</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>    <span class="st">'sec-fetch-dest'</span>: <span class="st">'empty'</span>,</span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>    <span class="st">'referer'</span>: <span class="st">'https://www.nasdaq.com/'</span>,</span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>    <span class="st">'accept-language'</span>: <span class="st">'en-US,en;q=0.9'</span>,</span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>params <span class="op">=</span> (</span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>    (<span class="st">'tableonly'</span>, <span class="st">'true'</span>),</span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>    (<span class="st">'limit'</span>, <span class="st">'25'</span>),</span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a>    (<span class="st">'offset'</span>, <span class="st">'0'</span>),</span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a>    (<span class="st">'download'</span>, <span class="st">'true'</span>),</span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a>r <span class="op">=</span> requests.get(<span class="st">'https://api.nasdaq.com/api/screener/stocks'</span>, headers<span class="op">=</span>headers, params<span class="op">=</span>params)</span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> r.json()[<span class="st">'data'</span>]</span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.DataFrame(data[<span class="st">'rows'</span>], columns<span class="op">=</span>data[<span class="st">'headers'</span>])</span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> df.dropna(subset<span class="op">=</span>{<span class="st">'marketCap'</span>})</span>
<span id="cb3-24"><a href="#cb3-24" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> df[<span class="op">~</span>df[<span class="st">'symbol'</span>].<span class="bu">str</span>.contains(<span class="st">"\/|\.|\^"</span>)]</span>
<span id="cb3-25"><a href="#cb3-25" aria-hidden="true" tabindex="-1"></a>df.head()</span></code><button title="Копіювати" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="3">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">symbol</th>
<th data-quarto-table-cell-role="th">name</th>
<th data-quarto-table-cell-role="th">lastsale</th>
<th data-quarto-table-cell-role="th">netchange</th>
<th data-quarto-table-cell-role="th">pctchange</th>
<th data-quarto-table-cell-role="th">marketCap</th>
<th data-quarto-table-cell-role="th">country</th>
<th data-quarto-table-cell-role="th">ipoyear</th>
<th data-quarto-table-cell-role="th">volume</th>
<th data-quarto-table-cell-role="th">sector</th>
<th data-quarto-table-cell-role="th">industry</th>
<th data-quarto-table-cell-role="th">url</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>A</td>
<td>Agilent Technologies Inc. Common Stock</td>
<td>$131.55</td>
<td>0.56</td>
<td>0.428%</td>
<td>38544689618.00</td>
<td>United States</td>
<td>1999</td>
<td>121107</td>
<td>Industrials</td>
<td>Electrical Products</td>
<td>/market-activity/stocks/a</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>AA</td>
<td>Alcoa Corporation Common Stock</td>
<td>$30.011</td>
<td>-0.599</td>
<td>-1.957%</td>
<td>5356120431.00</td>
<td>United States</td>
<td>2016</td>
<td>934231</td>
<td>Industrials</td>
<td>Aluminum</td>
<td>/market-activity/stocks/aa</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>AACG</td>
<td>ATA Creativity Global American Depositary Shares</td>
<td>$1.08</td>
<td>0.00</td>
<td>0.00%</td>
<td>34151944.00</td>
<td>China</td>
<td>2008</td>
<td>1076</td>
<td>Real Estate</td>
<td>Other Consumer Services</td>
<td>/market-activity/stocks/aacg</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>AACI</td>
<td>Armada Acquisition Corp. I Common Stock</td>
<td>$10.90</td>
<td>0.00</td>
<td>0.00%</td>
<td>0.00</td>
<td>United States</td>
<td>2021</td>
<td>111</td>
<td>Finance</td>
<td>Blank Checks</td>
<td>/market-activity/stocks/aaci</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>AACIU</td>
<td>Armada Acquisition Corp. I Unit</td>
<td>$10.70</td>
<td>0.00</td>
<td>0.00%</td>
<td>0.00</td>
<td>United States</td>
<td>2021</td>
<td>4</td>
<td>Finance</td>
<td>Blank Checks</td>
<td>/market-activity/stocks/aaciu</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>Фільтруємо та сортуємо заголовків акцій за їх капіталізацією:</p>
<div class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> cust_filter(mkt_cap):</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="st">'M'</span> <span class="kw">in</span> mkt_cap:</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="bu">float</span>(mkt_cap[<span class="dv">1</span>:<span class="op">-</span><span class="dv">1</span>])</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">elif</span> <span class="st">'B'</span> <span class="kw">in</span> mkt_cap:</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="bu">float</span>(mkt_cap[<span class="dv">1</span>:<span class="op">-</span><span class="dv">1</span>]) <span class="op">*</span> <span class="dv">1000</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">elif</span> mkt_cap <span class="op">==</span> <span class="st">''</span>:</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="fl">0.0</span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="bu">float</span>(mkt_cap[<span class="dv">1</span>:]) <span class="op">/</span> <span class="fl">1e6</span></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'marketCap'</span>] <span class="op">=</span> df[<span class="st">'marketCap'</span>].<span class="bu">apply</span>(cust_filter)</span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> df.sort_values(<span class="st">'marketCap'</span>, ascending<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a>df.head()</span></code><button title="Копіювати" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="4">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">symbol</th>
<th data-quarto-table-cell-role="th">name</th>
<th data-quarto-table-cell-role="th">lastsale</th>
<th data-quarto-table-cell-role="th">netchange</th>
<th data-quarto-table-cell-role="th">pctchange</th>
<th data-quarto-table-cell-role="th">marketCap</th>
<th data-quarto-table-cell-role="th">country</th>
<th data-quarto-table-cell-role="th">ipoyear</th>
<th data-quarto-table-cell-role="th">volume</th>
<th data-quarto-table-cell-role="th">sector</th>
<th data-quarto-table-cell-role="th">industry</th>
<th data-quarto-table-cell-role="th">url</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">17</td>
<td>AAPL</td>
<td>Apple Inc. Common Stock</td>
<td>$190.935</td>
<td>-1.485</td>
<td>-0.772%</td>
<td>952217.112760</td>
<td>United States</td>
<td>1980</td>
<td>11805837</td>
<td>Technology</td>
<td>Computer Manufacturing</td>
<td>/market-activity/stocks/aapl</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2944</td>
<td>GOOG</td>
<td>Alphabet Inc. Class C Capital Stock</td>
<td>$153.43</td>
<td>-0.36</td>
<td>-0.234%</td>
<td>920329.880000</td>
<td>United States</td>
<td>2004</td>
<td>4722822</td>
<td>Technology</td>
<td>Computer Software: Programming Data Processing</td>
<td>/market-activity/stocks/goog</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2945</td>
<td>GOOGL</td>
<td>Alphabet Inc. Class A Common Stock</td>
<td>$151.96</td>
<td>-0.225</td>
<td>-0.148%</td>
<td>901931.360000</td>
<td>United States</td>
<td>2004</td>
<td>6069308</td>
<td>Technology</td>
<td>Computer Software: Programming Data Processing</td>
<td>/market-activity/stocks/googl</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">408</td>
<td>AMZN</td>
<td>Amazon.com Inc. Common Stock</td>
<td>$159.435</td>
<td>0.315</td>
<td>0.198%</td>
<td>647606.166479</td>
<td>United States</td>
<td>1997</td>
<td>9424297</td>
<td>Consumer Discretionary</td>
<td>Catalog/Specialty Distribution</td>
<td>/market-activity/stocks/amzn</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4744</td>
<td>NVDA</td>
<td>NVIDIA Corporation Common Stock</td>
<td>$617.655</td>
<td>7.345</td>
<td>1.203%</td>
<td>525607.850000</td>
<td>United States</td>
<td>1999</td>
<td>9545670</td>
<td>Technology</td>
<td>Semiconductors</td>
<td>/market-activity/stocks/nvda</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>Визначаємо найпередовіші акцій за їх капіталізацією:</p>
<div class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>top <span class="op">=</span> <span class="dv">200</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>tickers_list <span class="op">=</span> df.iloc[:top][<span class="st">'symbol'</span>].tolist()</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>tickers_list[:<span class="dv">10</span>]</span></code><button title="Копіювати" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="5">
<pre><code>['AAPL', 'GOOG', 'GOOGL', 'AMZN', 'NVDA', 'V', 'JPM', 'LIN', 'ABT', 'ABBV']</code></pre>
</div>
</div>
<p>Зчитуємо дані з Yahoo Finance згідно створенного списку акцій:</p>
<div class="cell" data-execution_count="235">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>start <span class="op">=</span> <span class="st">"2001-12-31"</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>end <span class="op">=</span> <span class="st">"2024-01-29"</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>data_init <span class="op">=</span> yf.download(tickers_list, start, end)[<span class="st">"Adj Close"</span>]</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>xlabel <span class="op">=</span> <span class="st">'time, days'</span>    <span class="co"># підпис по вісі Ох </span></span></code><button title="Копіювати" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Далі нам потребується обрати фінансовий індекс для порівняння з розрахованими індикаторами. Далі надається список усіх доступних для нас акцій:</p>
<div class="cell" data-execution_count="232">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>ylabel <span class="op">=</span> <span class="st">'A'</span>             <span class="co"># підпис по вісі Оу           </span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>data_init.columns.values</span></code><button title="Копіювати" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="232">
<pre><code>array(['A', 'AAPL', 'ABT', 'ACGL', 'ACN', 'ADBE', 'AFL', 'AIG', 'AJG',
       'AMAT', 'AMD', 'AMGN', 'AMZN', 'ANSS', 'AON', 'APH', 'ASML',
       'AXON', 'AXP', 'BA', 'BAC', 'BAX', 'BCS', 'BDX', 'BHP', 'BKNG',
       'BLK', 'BMO', 'BSX', 'CAT', 'CCJ', 'CDNS', 'CHKP', 'CL', 'CMCSA',
       'CNC', 'CNI', 'CNQ', 'COP', 'CRH', 'CSCO', 'CSX', 'CTRA', 'CTSH',
       'CVX', 'DE', 'DECK', 'DHR', 'DIS', 'DLTR', 'DRI', 'ELV', 'EPD',
       'ERIC', 'ES', 'EXPD', 'FAST', 'FMX', 'GE', 'GILD', 'GPC', 'GS',
       'GSK', 'HBAN', 'HD', 'HDB', 'HON', 'HPQ', 'HSBC', 'HSY', 'IBM',
       'INTC', 'INTU', 'IRM', 'ISRG', 'ITW', 'JNJ', 'JPM', 'K', 'KO',
       'KOF', 'LH', 'LHX', 'LIN', 'LLY', 'LNG', 'LOW', 'LRCX', 'LYG',
       'MCD', 'MDT', 'MFC', 'MKL', 'MRVL', 'MS', 'MSFT', 'MUFG', 'NEE',
       'NEM', 'NFLX', 'NKE', 'NVDA', 'NVO', 'NVS', 'O', 'ORCL', 'PBR',
       'PCG', 'PEG', 'PEP', 'PFE', 'PFG', 'PG', 'PHG', 'PLD', 'PPL',
       'PUK', 'QCOM', 'RIO', 'RMD', 'ROP', 'RTX', 'RY', 'RYAAY', 'SAP',
       'SCHW', 'SLF', 'SNY', 'SONY', 'SPGI', 'STLD', 'STM', 'STX', 'SYK',
       'T', 'TD', 'TDY', 'TJX', 'TM', 'TMO', 'TS', 'TSN', 'TTE', 'TXN',
       'UL', 'UMC', 'UNH', 'UNP', 'UPS', 'VMC', 'VRTX', 'VTR', 'VZ',
       'WAT', 'WBA', 'WCN', 'WDC', 'WDS', 'WFC', 'WMT'], dtype=object)</code></pre>
</div>
</div>
<div class="cell" data-execution_count="226">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>perc <span class="op">=</span> <span class="fl">5.0</span> </span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>min_count <span class="op">=</span>  <span class="bu">int</span>(((<span class="dv">100</span><span class="op">-</span>perc)<span class="op">/</span><span class="dv">100</span>)<span class="op">*</span>data_init.shape[<span class="dv">0</span>] <span class="op">+</span> <span class="dv">1</span>)</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>data_init <span class="op">=</span> data_init.dropna(axis<span class="op">=</span><span class="dv">1</span>, thresh<span class="op">=</span>min_count)</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>data_init</span></code><button title="Копіювати" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="226">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">A</th>
<th data-quarto-table-cell-role="th">AAPL</th>
<th data-quarto-table-cell-role="th">ABT</th>
<th data-quarto-table-cell-role="th">ACGL</th>
<th data-quarto-table-cell-role="th">ACN</th>
<th data-quarto-table-cell-role="th">ADBE</th>
<th data-quarto-table-cell-role="th">AFL</th>
<th data-quarto-table-cell-role="th">AIG</th>
<th data-quarto-table-cell-role="th">AJG</th>
<th data-quarto-table-cell-role="th">AMAT</th>
<th data-quarto-table-cell-role="th">...</th>
<th data-quarto-table-cell-role="th">VRTX</th>
<th data-quarto-table-cell-role="th">VTR</th>
<th data-quarto-table-cell-role="th">VZ</th>
<th data-quarto-table-cell-role="th">WAT</th>
<th data-quarto-table-cell-role="th">WBA</th>
<th data-quarto-table-cell-role="th">WCN</th>
<th data-quarto-table-cell-role="th">WDC</th>
<th data-quarto-table-cell-role="th">WDS</th>
<th data-quarto-table-cell-role="th">WFC</th>
<th data-quarto-table-cell-role="th">WMT</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">Date</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">2001-12-31</td>
<td>17.297586</td>
<td>0.331503</td>
<td>14.912388</td>
<td>2.861111</td>
<td>19.321150</td>
<td>15.452659</td>
<td>7.743106</td>
<td>979.726379</td>
<td>17.191076</td>
<td>14.783871</td>
<td>...</td>
<td>24.590000</td>
<td>4.431195</td>
<td>14.652889</td>
<td>38.750000</td>
<td>20.802359</td>
<td>5.453039</td>
<td>5.033543</td>
<td>2.791204</td>
<td>11.735176</td>
<td>37.910130</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2002-01-02</td>
<td>17.746569</td>
<td>0.352695</td>
<td>14.936458</td>
<td>2.945556</td>
<td>18.811562</td>
<td>15.845817</td>
<td>7.497190</td>
<td>971.706116</td>
<td>16.916937</td>
<td>15.362686</td>
<td>...</td>
<td>24.540001</td>
<td>4.569910</td>
<td>14.970884</td>
<td>38.750000</td>
<td>20.443911</td>
<td>5.303473</td>
<td>4.929180</td>
<td>2.770977</td>
<td>11.727076</td>
<td>38.239510</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2002-01-03</td>
<td>18.868996</td>
<td>0.356933</td>
<td>14.949837</td>
<td>3.008889</td>
<td>18.223030</td>
<td>16.462931</td>
<td>7.415218</td>
<td>969.608521</td>
<td>16.597942</td>
<td>16.771030</td>
<td>...</td>
<td>24.170000</td>
<td>4.785689</td>
<td>15.467970</td>
<td>37.990002</td>
<td>21.265877</td>
<td>5.322829</td>
<td>4.929180</td>
<td>2.791204</td>
<td>11.770274</td>
<td>38.193398</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2002-01-04</td>
<td>19.888290</td>
<td>0.358599</td>
<td>14.923080</td>
<td>2.984444</td>
<td>19.880976</td>
<td>17.866360</td>
<td>7.541327</td>
<td>959.984192</td>
<td>16.358702</td>
<td>16.671478</td>
<td>...</td>
<td>23.950001</td>
<td>4.700920</td>
<td>15.625427</td>
<td>38.889999</td>
<td>21.358564</td>
<td>5.122231</td>
<td>5.178046</td>
<td>2.831656</td>
<td>11.799970</td>
<td>37.943069</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2002-01-07</td>
<td>19.809412</td>
<td>0.346641</td>
<td>14.818761</td>
<td>2.997778</td>
<td>18.983816</td>
<td>17.995752</td>
<td>7.289105</td>
<td>947.644836</td>
<td>15.880191</td>
<td>16.494522</td>
<td>...</td>
<td>23.790001</td>
<td>4.758718</td>
<td>15.529716</td>
<td>38.740002</td>
<td>21.556326</td>
<td>4.999060</td>
<td>5.507194</td>
<td>2.892334</td>
<td>11.818866</td>
<td>37.804741</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2024-01-22</td>
<td>132.550003</td>
<td>193.889999</td>
<td>114.190002</td>
<td>80.470001</td>
<td>367.209991</td>
<td>603.590027</td>
<td>84.500000</td>
<td>69.260002</td>
<td>237.520004</td>
<td>168.300003</td>
<td>...</td>
<td>440.109985</td>
<td>48.439999</td>
<td>39.580002</td>
<td>317.049988</td>
<td>22.559999</td>
<td>152.600006</td>
<td>57.000000</td>
<td>20.430000</td>
<td>48.529999</td>
<td>162.389999</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2024-01-23</td>
<td>131.639999</td>
<td>195.179993</td>
<td>114.000000</td>
<td>80.339996</td>
<td>369.859985</td>
<td>597.179993</td>
<td>84.639999</td>
<td>69.000000</td>
<td>239.679993</td>
<td>167.050003</td>
<td>...</td>
<td>439.700012</td>
<td>47.680000</td>
<td>42.230000</td>
<td>316.440002</td>
<td>22.580000</td>
<td>153.350006</td>
<td>57.730000</td>
<td>20.510000</td>
<td>49.119999</td>
<td>162.800003</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2024-01-24</td>
<td>129.779999</td>
<td>194.500000</td>
<td>110.769997</td>
<td>80.129997</td>
<td>368.899994</td>
<td>606.479980</td>
<td>85.000000</td>
<td>69.160004</td>
<td>239.070007</td>
<td>174.139999</td>
<td>...</td>
<td>427.559998</td>
<td>47.549999</td>
<td>41.279999</td>
<td>312.420013</td>
<td>22.370001</td>
<td>151.800003</td>
<td>58.029999</td>
<td>20.379999</td>
<td>49.490002</td>
<td>160.500000</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2024-01-25</td>
<td>129.880005</td>
<td>194.169998</td>
<td>112.449997</td>
<td>79.599998</td>
<td>371.940002</td>
<td>622.580017</td>
<td>84.889999</td>
<td>68.980003</td>
<td>237.750000</td>
<td>172.630005</td>
<td>...</td>
<td>429.959991</td>
<td>47.439999</td>
<td>42.290001</td>
<td>312.000000</td>
<td>23.110001</td>
<td>153.429993</td>
<td>60.330002</td>
<td>20.660000</td>
<td>49.880001</td>
<td>162.839996</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2024-01-26</td>
<td>130.990005</td>
<td>192.419998</td>
<td>112.010002</td>
<td>79.900002</td>
<td>371.070007</td>
<td>613.929993</td>
<td>85.309998</td>
<td>69.529999</td>
<td>233.029999</td>
<td>166.899994</td>
<td>...</td>
<td>430.170013</td>
<td>47.400002</td>
<td>42.400002</td>
<td>316.119995</td>
<td>22.850000</td>
<td>154.410004</td>
<td>58.230000</td>
<td>20.670000</td>
<td>50.320000</td>
<td>164.270004</td>
</tr>
</tbody>
</table>

<p>5556 rows × 160 columns</p>
</div>
</div>
</div>
<div class="cell" data-execution_count="228">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>data_init <span class="op">=</span> data_init.dropna(axis<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>data_init</span></code><button title="Копіювати" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="228">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">A</th>
<th data-quarto-table-cell-role="th">AAPL</th>
<th data-quarto-table-cell-role="th">ABT</th>
<th data-quarto-table-cell-role="th">ACGL</th>
<th data-quarto-table-cell-role="th">ACN</th>
<th data-quarto-table-cell-role="th">ADBE</th>
<th data-quarto-table-cell-role="th">AFL</th>
<th data-quarto-table-cell-role="th">AIG</th>
<th data-quarto-table-cell-role="th">AJG</th>
<th data-quarto-table-cell-role="th">AMAT</th>
<th data-quarto-table-cell-role="th">...</th>
<th data-quarto-table-cell-role="th">VRTX</th>
<th data-quarto-table-cell-role="th">VTR</th>
<th data-quarto-table-cell-role="th">VZ</th>
<th data-quarto-table-cell-role="th">WAT</th>
<th data-quarto-table-cell-role="th">WBA</th>
<th data-quarto-table-cell-role="th">WCN</th>
<th data-quarto-table-cell-role="th">WDC</th>
<th data-quarto-table-cell-role="th">WDS</th>
<th data-quarto-table-cell-role="th">WFC</th>
<th data-quarto-table-cell-role="th">WMT</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">Date</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">2002-12-16</td>
<td>10.690413</td>
<td>0.224787</td>
<td>11.187967</td>
<td>3.474444</td>
<td>12.775499</td>
<td>13.237535</td>
<td>9.424965</td>
<td>758.508911</td>
<td>14.975086</td>
<td>10.662081</td>
<td>...</td>
<td>16.790001</td>
<td>4.659505</td>
<td>12.810547</td>
<td>20.959999</td>
<td>17.952019</td>
<td>6.325806</td>
<td>5.659726</td>
<td>2.912350</td>
<td>12.977189</td>
<td>34.346539</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2002-12-17</td>
<td>10.556931</td>
<td>0.228268</td>
<td>11.201620</td>
<td>3.402222</td>
<td>12.976459</td>
<td>13.377089</td>
<td>9.348700</td>
<td>749.475708</td>
<td>14.793025</td>
<td>10.219672</td>
<td>...</td>
<td>16.950001</td>
<td>4.597099</td>
<td>12.560366</td>
<td>20.950001</td>
<td>18.076126</td>
<td>6.466575</td>
<td>5.563388</td>
<td>2.848576</td>
<td>12.927494</td>
<td>33.685261</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2002-12-18</td>
<td>10.223237</td>
<td>0.220548</td>
<td>11.136068</td>
<td>3.372222</td>
<td>12.911861</td>
<td>12.973383</td>
<td>9.374124</td>
<td>730.544128</td>
<td>14.545205</td>
<td>9.777258</td>
<td>...</td>
<td>16.879999</td>
<td>4.659505</td>
<td>12.589236</td>
<td>20.969999</td>
<td>17.939608</td>
<td>6.514087</td>
<td>5.202130</td>
<td>2.857079</td>
<td>12.775632</td>
<td>33.364067</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2002-12-19</td>
<td>10.168632</td>
<td>0.214947</td>
<td>11.032280</td>
<td>3.383333</td>
<td>12.588892</td>
<td>12.729166</td>
<td>9.227955</td>
<td>718.789368</td>
<td>14.464287</td>
<td>9.976346</td>
<td>...</td>
<td>16.610001</td>
<td>4.659505</td>
<td>12.441692</td>
<td>20.590000</td>
<td>17.983047</td>
<td>6.419065</td>
<td>5.194102</td>
<td>2.891092</td>
<td>12.748014</td>
<td>33.218376</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2002-12-20</td>
<td>10.920969</td>
<td>0.214039</td>
<td>10.570665</td>
<td>3.388889</td>
<td>12.308981</td>
<td>12.828847</td>
<td>9.278793</td>
<td>730.915466</td>
<td>14.656469</td>
<td>9.814127</td>
<td>...</td>
<td>16.670000</td>
<td>4.655344</td>
<td>12.829791</td>
<td>20.799999</td>
<td>18.429834</td>
<td>6.686528</td>
<td>5.410858</td>
<td>2.891092</td>
<td>12.996518</td>
<td>33.635590</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2024-01-22</td>
<td>132.550003</td>
<td>193.889999</td>
<td>114.190002</td>
<td>80.470001</td>
<td>367.209991</td>
<td>603.590027</td>
<td>84.500000</td>
<td>69.260002</td>
<td>237.520004</td>
<td>168.300003</td>
<td>...</td>
<td>440.109985</td>
<td>48.439999</td>
<td>39.580002</td>
<td>317.049988</td>
<td>22.559999</td>
<td>152.600006</td>
<td>57.000000</td>
<td>20.430000</td>
<td>48.529999</td>
<td>162.389999</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2024-01-23</td>
<td>131.639999</td>
<td>195.179993</td>
<td>114.000000</td>
<td>80.339996</td>
<td>369.859985</td>
<td>597.179993</td>
<td>84.639999</td>
<td>69.000000</td>
<td>239.679993</td>
<td>167.050003</td>
<td>...</td>
<td>439.700012</td>
<td>47.680000</td>
<td>42.230000</td>
<td>316.440002</td>
<td>22.580000</td>
<td>153.350006</td>
<td>57.730000</td>
<td>20.510000</td>
<td>49.119999</td>
<td>162.800003</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2024-01-24</td>
<td>129.779999</td>
<td>194.500000</td>
<td>110.769997</td>
<td>80.129997</td>
<td>368.899994</td>
<td>606.479980</td>
<td>85.000000</td>
<td>69.160004</td>
<td>239.070007</td>
<td>174.139999</td>
<td>...</td>
<td>427.559998</td>
<td>47.549999</td>
<td>41.279999</td>
<td>312.420013</td>
<td>22.370001</td>
<td>151.800003</td>
<td>58.029999</td>
<td>20.379999</td>
<td>49.490002</td>
<td>160.500000</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2024-01-25</td>
<td>129.880005</td>
<td>194.169998</td>
<td>112.449997</td>
<td>79.599998</td>
<td>371.940002</td>
<td>622.580017</td>
<td>84.889999</td>
<td>68.980003</td>
<td>237.750000</td>
<td>172.630005</td>
<td>...</td>
<td>429.959991</td>
<td>47.439999</td>
<td>42.290001</td>
<td>312.000000</td>
<td>23.110001</td>
<td>153.429993</td>
<td>60.330002</td>
<td>20.660000</td>
<td>49.880001</td>
<td>162.839996</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2024-01-26</td>
<td>130.990005</td>
<td>192.419998</td>
<td>112.010002</td>
<td>79.900002</td>
<td>371.070007</td>
<td>613.929993</td>
<td>85.309998</td>
<td>69.529999</td>
<td>233.029999</td>
<td>166.899994</td>
<td>...</td>
<td>430.170013</td>
<td>47.400002</td>
<td>42.400002</td>
<td>316.119995</td>
<td>22.850000</td>
<td>154.410004</td>
<td>58.230000</td>
<td>20.670000</td>
<td>50.320000</td>
<td>164.270004</td>
</tr>
</tbody>
</table>

<p>5314 rows × 160 columns</p>
</div>
</div>
</div>
<div class="cell" data-execution_count="229">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> data_init.T</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>data</span></code><button title="Копіювати" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="229">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">Date</th>
<th data-quarto-table-cell-role="th">2002-12-16</th>
<th data-quarto-table-cell-role="th">2002-12-17</th>
<th data-quarto-table-cell-role="th">2002-12-18</th>
<th data-quarto-table-cell-role="th">2002-12-19</th>
<th data-quarto-table-cell-role="th">2002-12-20</th>
<th data-quarto-table-cell-role="th">2002-12-23</th>
<th data-quarto-table-cell-role="th">2002-12-24</th>
<th data-quarto-table-cell-role="th">2002-12-26</th>
<th data-quarto-table-cell-role="th">2002-12-27</th>
<th data-quarto-table-cell-role="th">2002-12-30</th>
<th data-quarto-table-cell-role="th">...</th>
<th data-quarto-table-cell-role="th">2024-01-12</th>
<th data-quarto-table-cell-role="th">2024-01-16</th>
<th data-quarto-table-cell-role="th">2024-01-17</th>
<th data-quarto-table-cell-role="th">2024-01-18</th>
<th data-quarto-table-cell-role="th">2024-01-19</th>
<th data-quarto-table-cell-role="th">2024-01-22</th>
<th data-quarto-table-cell-role="th">2024-01-23</th>
<th data-quarto-table-cell-role="th">2024-01-24</th>
<th data-quarto-table-cell-role="th">2024-01-25</th>
<th data-quarto-table-cell-role="th">2024-01-26</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">A</td>
<td>10.690413</td>
<td>10.556931</td>
<td>10.223237</td>
<td>10.168632</td>
<td>10.920969</td>
<td>11.248591</td>
<td>11.060510</td>
<td>11.102981</td>
<td>11.042307</td>
<td>10.927034</td>
<td>...</td>
<td>130.539993</td>
<td>130.529999</td>
<td>128.119995</td>
<td>130.460007</td>
<td>131.220001</td>
<td>132.550003</td>
<td>131.639999</td>
<td>129.779999</td>
<td>129.880005</td>
<td>130.990005</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">AAPL</td>
<td>0.224787</td>
<td>0.228268</td>
<td>0.220548</td>
<td>0.214947</td>
<td>0.214039</td>
<td>0.219337</td>
<td>0.217370</td>
<td>0.217975</td>
<td>0.212828</td>
<td>0.212980</td>
<td>...</td>
<td>185.919998</td>
<td>183.630005</td>
<td>182.679993</td>
<td>188.630005</td>
<td>191.559998</td>
<td>193.889999</td>
<td>195.179993</td>
<td>194.500000</td>
<td>194.169998</td>
<td>192.419998</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">ABT</td>
<td>11.187967</td>
<td>11.201620</td>
<td>11.136068</td>
<td>11.032280</td>
<td>10.570665</td>
<td>10.414969</td>
<td>10.297520</td>
<td>10.010720</td>
<td>10.046227</td>
<td>10.133636</td>
<td>...</td>
<td>113.919998</td>
<td>113.760002</td>
<td>113.930000</td>
<td>114.019997</td>
<td>114.690002</td>
<td>114.190002</td>
<td>114.000000</td>
<td>110.769997</td>
<td>112.449997</td>
<td>112.010002</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">ACGL</td>
<td>3.474444</td>
<td>3.402222</td>
<td>3.372222</td>
<td>3.383333</td>
<td>3.388889</td>
<td>3.397778</td>
<td>3.425556</td>
<td>3.432222</td>
<td>3.387778</td>
<td>3.343333</td>
<td>...</td>
<td>77.690002</td>
<td>78.169998</td>
<td>78.669998</td>
<td>78.959999</td>
<td>80.879997</td>
<td>80.470001</td>
<td>80.339996</td>
<td>80.129997</td>
<td>79.599998</td>
<td>79.900002</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">ACN</td>
<td>12.775499</td>
<td>12.976459</td>
<td>12.911861</td>
<td>12.588892</td>
<td>12.308981</td>
<td>12.344862</td>
<td>12.538649</td>
<td>12.818563</td>
<td>12.696548</td>
<td>12.789855</td>
<td>...</td>
<td>355.033539</td>
<td>353.269989</td>
<td>353.649994</td>
<td>359.549988</td>
<td>363.899994</td>
<td>367.209991</td>
<td>369.859985</td>
<td>368.899994</td>
<td>371.940002</td>
<td>371.070007</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">WCN</td>
<td>6.325806</td>
<td>6.466575</td>
<td>6.514087</td>
<td>6.419065</td>
<td>6.686528</td>
<td>6.670691</td>
<td>6.640778</td>
<td>6.704123</td>
<td>6.635498</td>
<td>6.726998</td>
<td>...</td>
<td>148.919998</td>
<td>146.830002</td>
<td>146.720001</td>
<td>149.589996</td>
<td>152.199997</td>
<td>152.600006</td>
<td>153.350006</td>
<td>151.800003</td>
<td>153.429993</td>
<td>154.410004</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">WDC</td>
<td>5.659726</td>
<td>5.563388</td>
<td>5.202130</td>
<td>5.194102</td>
<td>5.410858</td>
<td>5.178046</td>
<td>5.418886</td>
<td>5.322549</td>
<td>5.186075</td>
<td>5.073682</td>
<td>...</td>
<td>50.009998</td>
<td>52.230000</td>
<td>52.320000</td>
<td>53.549999</td>
<td>54.770000</td>
<td>57.000000</td>
<td>57.730000</td>
<td>58.029999</td>
<td>60.330002</td>
<td>58.230000</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">WDS</td>
<td>2.912350</td>
<td>2.848576</td>
<td>2.857079</td>
<td>2.891092</td>
<td>2.891092</td>
<td>2.891092</td>
<td>2.869833</td>
<td>2.869833</td>
<td>2.869833</td>
<td>2.976125</td>
<td>...</td>
<td>20.940001</td>
<td>20.360001</td>
<td>20.190001</td>
<td>20.219999</td>
<td>20.309999</td>
<td>20.430000</td>
<td>20.510000</td>
<td>20.379999</td>
<td>20.660000</td>
<td>20.670000</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">WFC</td>
<td>12.977189</td>
<td>12.927494</td>
<td>12.775632</td>
<td>12.748014</td>
<td>12.996518</td>
<td>12.993757</td>
<td>12.955107</td>
<td>12.933015</td>
<td>12.783907</td>
<td>12.999282</td>
<td>...</td>
<td>47.400002</td>
<td>46.820000</td>
<td>46.669998</td>
<td>46.439999</td>
<td>48.119999</td>
<td>48.529999</td>
<td>49.119999</td>
<td>49.490002</td>
<td>49.880001</td>
<td>50.320000</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">WMT</td>
<td>34.346539</td>
<td>33.685261</td>
<td>33.364067</td>
<td>33.218376</td>
<td>33.635590</td>
<td>32.840885</td>
<td>32.913738</td>
<td>32.953480</td>
<td>32.556122</td>
<td>33.536232</td>
<td>...</td>
<td>161.320007</td>
<td>161.830002</td>
<td>161.070007</td>
<td>163.240005</td>
<td>162.380005</td>
<td>162.389999</td>
<td>162.800003</td>
<td>160.500000</td>
<td>162.839996</td>
<td>164.270004</td>
</tr>
</tbody>
</table>

<p>160 rows × 5314 columns</p>
</div>
</div>
</div>
<section id="знаходження-коефіцієнтів-матриці-крос-кореляцій-1" class="level3" data-number="8.2.1">
<h3 data-number="8.2.1" class="anchored" data-anchor-id="знаходження-коефіцієнтів-матриці-крос-кореляцій-1"><span class="header-section-number">8.2.1</span> Знаходження коефіцієнтів матриці крос-кореляцій</h3>
<p>Перш за все нам потребується процедура для перетворення ряду до потрібного нам виду. Для цього визначимо функцію <code>transformation()</code>. З її допомогою для всього ряду та у віконній процедурі будемо рахувати прибутковості та розраховувати всі необхідні індикатори.</p>
<div class="cell" data-execution_count="136">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> transformation(signal, ret_type):</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>    for_rmt <span class="op">=</span> signal.copy()</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> ret_type <span class="op">==</span> <span class="dv">1</span>:       <span class="co"># Зважаючи на вид ряду, виконуємо</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>                            <span class="co"># необхідні перетворення</span></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>        for_rmt.values</span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">elif</span> ret_type <span class="op">==</span> <span class="dv">2</span>:</span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>        for_rmt <span class="op">=</span> for_rmt.diff(axis<span class="op">=</span><span class="dv">1</span>).iloc[:,<span class="dv">1</span>:]</span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">elif</span> ret_type <span class="op">==</span> <span class="dv">3</span>:</span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>        for_rmt <span class="op">=</span> for_rmt.pct_change(axis<span class="op">=</span><span class="dv">1</span>).iloc[:,<span class="dv">1</span>:]</span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">elif</span> ret_type <span class="op">==</span> <span class="dv">4</span>:</span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a>        for_rmt <span class="op">=</span> for_rmt.pct_change(axis<span class="op">=</span><span class="dv">1</span>).iloc[:,<span class="dv">1</span>:]</span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a>        for_rmt <span class="op">=</span> for_rmt.values</span>
<span id="cb13-15"><a href="#cb13-15" aria-hidden="true" tabindex="-1"></a>        for_rmt <span class="op">-=</span> np.mean(for_rmt, axis<span class="op">=</span><span class="dv">1</span>, keepdims<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb13-16"><a href="#cb13-16" aria-hidden="true" tabindex="-1"></a>        for_rmt <span class="op">/=</span> np.std(for_rmt, axis<span class="op">=</span><span class="dv">1</span>, keepdims<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb13-17"><a href="#cb13-17" aria-hidden="true" tabindex="-1"></a>    <span class="cf">elif</span> ret_type <span class="op">==</span> <span class="dv">5</span>: </span>
<span id="cb13-18"><a href="#cb13-18" aria-hidden="true" tabindex="-1"></a>        for_rmt <span class="op">=</span> for_rmt.pct_change(axis<span class="op">=</span><span class="dv">1</span>).iloc[:,<span class="dv">1</span>:]</span>
<span id="cb13-19"><a href="#cb13-19" aria-hidden="true" tabindex="-1"></a>        for_rmt <span class="op">=</span> for_rmt.values</span>
<span id="cb13-20"><a href="#cb13-20" aria-hidden="true" tabindex="-1"></a>        for_rmt <span class="op">-=</span> np.mean(for_rmt, axis<span class="op">=</span><span class="dv">1</span>, keepdims<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb13-21"><a href="#cb13-21" aria-hidden="true" tabindex="-1"></a>        for_rmt <span class="op">/=</span> np.std(for_rmt, axis<span class="op">=</span><span class="dv">1</span>, keepdims<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb13-22"><a href="#cb13-22" aria-hidden="true" tabindex="-1"></a>        for_rmt <span class="op">=</span> np.<span class="bu">abs</span>(for_rmt)</span>
<span id="cb13-23"><a href="#cb13-23" aria-hidden="true" tabindex="-1"></a>    <span class="cf">elif</span> ret_type <span class="op">==</span> <span class="dv">6</span>:</span>
<span id="cb13-24"><a href="#cb13-24" aria-hidden="true" tabindex="-1"></a>        for_rmt <span class="op">=</span> for_rmt.values</span>
<span id="cb13-25"><a href="#cb13-25" aria-hidden="true" tabindex="-1"></a>        for_rmt <span class="op">-=</span> np.mean(for_rmt, axis<span class="op">=</span><span class="dv">1</span>, keepdims<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb13-26"><a href="#cb13-26" aria-hidden="true" tabindex="-1"></a>        for_rmt <span class="op">/=</span> np.std(for_rmt, axis<span class="op">=</span><span class="dv">1</span>, keepdims<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb13-27"><a href="#cb13-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-28"><a href="#cb13-28" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> for_rmt</span></code><button title="Копіювати" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="211">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="bu">type</span> <span class="op">=</span> <span class="dv">4</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>log_ret <span class="op">=</span> transformation(data, <span class="bu">type</span>)</span></code><button title="Копіювати" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="212">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>N, T <span class="op">=</span> log_ret.shape</span></code><button title="Копіювати" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Будуємо матрицю кореляцій для матриці прибутковостей наших активів:</p>
<div class="cell" data-execution_count="441">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> calc_cross_corr(data):</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>    C <span class="op">=</span> (<span class="dv">1</span><span class="op">/</span>T)<span class="op">*</span>np.dot(data, data.T)</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>    di <span class="op">=</span> np.diag_indices(N)</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>    ccoef <span class="op">=</span> np.ma.asarray(C)</span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>    ccoef[di] <span class="op">=</span> np.ma.masked</span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>    ccoef_flat <span class="op">=</span> ccoef.compressed()</span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> C, ccoef_flat</span></code><button title="Копіювати" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="442">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>C, ccoef_flat <span class="op">=</span> calc_cross_corr(log_ret)</span></code><button title="Копіювати" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="443">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>C</span></code><button title="Копіювати" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="443">
<pre><code>array([[1.        , 0.42979246, 0.43304736, ..., 0.3747332 , 0.40580156,
        0.33566806],
       [0.42979246, 1.        , 0.33253841, ..., 0.30379772, 0.33559457,
        0.29955249],
       [0.43304736, 0.33253841, 1.        , ..., 0.26114239, 0.33433625,
        0.36327203],
       ...,
       [0.3747332 , 0.30379772, 0.26114239, ..., 1.        , 0.37569424,
        0.21525548],
       [0.40580156, 0.33559457, 0.33433625, ..., 0.37569424, 1.        ,
        0.28825913],
       [0.33566806, 0.29955249, 0.36327203, ..., 0.21525548, 0.28825913,
        1.        ]])</code></pre>
</div>
</div>
<p>і матрицю кореляцій для перемішаної матриці прибутковостей:</p>
<div class="cell" data-execution_count="444">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>np.random.seed(<span class="dv">1234</span>)</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>random_stocks <span class="op">=</span> np.random.normal(size<span class="op">=</span>(N,T))</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>R, ccoef_flat_rand <span class="op">=</span> calc_cross_corr(random_stocks)</span></code><button title="Копіювати" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Виводимо результат:</p>
<div class="cell" data-execution_count="448">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>fig <span class="op">=</span> plt.figure(figsize<span class="op">=</span>(<span class="dv">15</span>, <span class="dv">10</span>))</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>gs <span class="op">=</span> gridspec.GridSpec(<span class="dv">2</span>, <span class="dv">2</span>)</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>ax1 <span class="op">=</span> fig.add_subplot(gs[<span class="dv">0</span>, <span class="dv">0</span>])</span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>im1 <span class="op">=</span> ax1.imshow(C, cmap<span class="op">=</span><span class="st">'hot'</span>, interpolation<span class="op">=</span><span class="st">'nearest'</span>)</span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>ax1.invert_yaxis()</span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a>fig.colorbar(im1, ax<span class="op">=</span>ax1)</span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a>ax2 <span class="op">=</span> fig.add_subplot(gs[<span class="dv">0</span>, <span class="dv">1</span>])</span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a>im2 <span class="op">=</span> ax2.imshow(R, cmap<span class="op">=</span><span class="st">'hot'</span>, interpolation<span class="op">=</span><span class="st">'nearest'</span>)</span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a>ax2.invert_yaxis()</span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a>fig.colorbar(im2, ax<span class="op">=</span>ax2)</span>
<span id="cb21-13"><a href="#cb21-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-14"><a href="#cb21-14" aria-hidden="true" tabindex="-1"></a>ax3 <span class="op">=</span> fig.add_subplot(gs[<span class="dv">1</span>, :])</span>
<span id="cb21-15"><a href="#cb21-15" aria-hidden="true" tabindex="-1"></a>ax3.hist(ccoef_flat, bins<span class="op">=</span><span class="st">'auto'</span>, density<span class="op">=</span><span class="va">True</span>, label<span class="op">=</span><span class="vs">r'$P^</span><span class="sc">{init}</span><span class="vs">(C_</span><span class="sc">{ij}</span><span class="vs">)$'</span>)</span>
<span id="cb21-16"><a href="#cb21-16" aria-hidden="true" tabindex="-1"></a>ax3.hist(ccoef_flat_rand, bins<span class="op">=</span><span class="st">'auto'</span>, density<span class="op">=</span><span class="va">True</span>, label<span class="op">=</span><span class="vs">r'$P^</span><span class="sc">{rand}</span><span class="vs">(C_</span><span class="sc">{ij}</span><span class="vs">)$'</span>)</span>
<span id="cb21-17"><a href="#cb21-17" aria-hidden="true" tabindex="-1"></a>ax3.set_xlabel(<span class="vs">r'$C_</span><span class="sc">{ij}</span><span class="vs">$'</span>)</span>
<span id="cb21-18"><a href="#cb21-18" aria-hidden="true" tabindex="-1"></a>ax3.set_ylabel(<span class="vs">r'$P(C_</span><span class="sc">{ij}</span><span class="vs">)$'</span>)</span>
<span id="cb21-19"><a href="#cb21-19" aria-hidden="true" tabindex="-1"></a>ax3.legend()</span>
<span id="cb21-20"><a href="#cb21-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-21"><a href="#cb21-21" aria-hidden="true" tabindex="-1"></a>fig.align_labels()</span>
<span id="cb21-22"><a href="#cb21-22" aria-hidden="true" tabindex="-1"></a>plt.show()<span class="op">;</span></span></code><button title="Копіювати" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div id="fig-matrix-cor" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="lab_8_files/figure-html/fig-matrix-cor-output-1.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Рис.&nbsp;8.1: Карти полів кореляцій вихідної і перемішаної матриць. На третому рисунку (нижній) представлено порівняння розподілів значень коефіцієнтів кореляції вихідної та перемішаної матриць</figcaption>
</figure>
</div>
</div>
</div>
</section>
<section id="розподіл-власних-значень-та-векторів" class="level3" data-number="8.2.2">
<h3 data-number="8.2.2" class="anchored" data-anchor-id="розподіл-власних-значень-та-векторів"><span class="header-section-number">8.2.2</span> Розподіл власних значень та векторів</h3>
<div class="cell" data-execution_count="406">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> calc_lambd_eig(C):</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> np.linalg.eig(C)</span></code><button title="Копіювати" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="407">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>lambdas, u <span class="op">=</span> calc_lambd_eig(C)</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>lambdas_rand, u_rand <span class="op">=</span> calc_lambd_eig(R)</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>Q <span class="op">=</span> T<span class="op">/</span>N</span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>lambda_plus <span class="op">=</span> <span class="dv">1</span> <span class="op">+</span> <span class="dv">1</span><span class="op">/</span>Q <span class="op">+</span> <span class="dv">2</span><span class="op">*</span>np.sqrt(<span class="dv">1</span><span class="op">/</span>Q)</span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>lambda_minus <span class="op">=</span> <span class="dv">1</span> <span class="op">-</span> <span class="dv">1</span><span class="op">/</span>Q <span class="op">-</span> <span class="dv">2</span><span class="op">*</span>np.sqrt(<span class="dv">1</span><span class="op">/</span>Q)</span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Верхня границя розподілу власних значень, що прогнозується ТВМ: "</span>, lambda_plus)</span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Нижня границя розподілу власних значень, що прогнозується ТВМ: "</span>, lambda_minus)</span></code><button title="Копіювати" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Верхня границя розподілу власних значень, що прогнозується ТВМ:  1.3771872127988147
Нижня границя розподілу власних значень, що прогнозується ТВМ:  0.6228127872011853</code></pre>
</div>
</div>
<p>Генеруємо 1000 випадкових значень в діапазоні від <span class="math inline">\(\lambda_{-}\)</span> до <span class="math inline">\(\lambda_{+}\)</span>, і генеруємо <span class="math inline">\(P_{rm}(\lambda)\)</span>.</p>
<div class="cell" data-execution_count="408">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>lambda_random <span class="op">=</span> np.linspace(lambda_minus, lambda_plus, <span class="dv">1000</span>)</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>P_rm <span class="op">=</span> (Q<span class="op">/</span>(<span class="dv">2</span><span class="op">*</span>np.pi))<span class="op">*</span>np.sqrt((lambda_plus<span class="op">-</span>lambda_random)<span class="op">*</span>(lambda_random<span class="op">-</span>lambda_minus))<span class="op">/</span>lambda_random</span></code><button title="Копіювати" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Виводимо результат:</p>
<div class="cell" data-execution_count="409">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(<span class="dv">2</span>, <span class="dv">1</span>, figsize<span class="op">=</span>(<span class="dv">13</span>, <span class="dv">10</span>))</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">0</span>].hist(lambdas, bins<span class="op">=</span><span class="dv">50</span>, density<span class="op">=</span><span class="va">True</span>, color<span class="op">=</span><span class="st">"skyblue"</span>, label<span class="op">=</span><span class="st">'$P^</span><span class="sc">{init}</span><span class="st">_{\it</span><span class="sc">{empiric}</span><span class="st">}$'</span>)</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">0</span>].hist(lambdas_rand, bins<span class="op">=</span><span class="st">'auto'</span>, density<span class="op">=</span><span class="va">True</span>, color<span class="op">=</span><span class="st">"red"</span>, label<span class="op">=</span><span class="st">'$P^</span><span class="sc">{rand}</span><span class="st">_{\it</span><span class="sc">{empiric}</span><span class="st">}$'</span>)</span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">0</span>].set_xlabel(<span class="st">'$\lambda_</span><span class="sc">{i}</span><span class="st">$'</span>)</span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">0</span>].set_ylabel(<span class="st">'$P(\lambda_</span><span class="sc">{i}</span><span class="st">)$'</span>)</span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">0</span>].text(<span class="dv">20</span>, <span class="fl">0.5</span>, <span class="st">'$\lambda_</span><span class="sc">{max}</span><span class="st">=$'</span><span class="op">+</span><span class="ss">f'</span><span class="sc">{</span>lambdas<span class="sc">.</span><span class="bu">max</span>()<span class="sc">:.2f}</span><span class="ss">'</span>, ha<span class="op">=</span><span class="st">'center'</span>, va<span class="op">=</span><span class="st">'center'</span>)</span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">0</span>].set_yscale(<span class="st">'log'</span>)</span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">0</span>].legend()</span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-10"><a href="#cb26-10" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">1</span>].hist(lambdas, bins<span class="op">=</span><span class="st">'auto'</span>, density<span class="op">=</span><span class="va">True</span>, color<span class="op">=</span><span class="st">"skyblue"</span>, label<span class="op">=</span><span class="st">'$P^</span><span class="sc">{init}</span><span class="st">_{\it</span><span class="sc">{empiric}</span><span class="st">}$'</span>)</span>
<span id="cb26-11"><a href="#cb26-11" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">1</span>].hist(lambdas_rand, bins<span class="op">=</span><span class="st">'auto'</span>, density<span class="op">=</span><span class="va">True</span>, color<span class="op">=</span><span class="st">"red"</span>, label<span class="op">=</span><span class="st">'$P^</span><span class="sc">{rand}</span><span class="st">_{\it</span><span class="sc">{empiric}</span><span class="st">}$'</span>)</span>
<span id="cb26-12"><a href="#cb26-12" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">1</span>].set_xlabel(<span class="st">'$\lambda_</span><span class="sc">{i}</span><span class="st">$'</span>)</span>
<span id="cb26-13"><a href="#cb26-13" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">1</span>].set_ylabel(<span class="st">'$P(\lambda_</span><span class="sc">{i}</span><span class="st">)$'</span>)</span>
<span id="cb26-14"><a href="#cb26-14" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">1</span>].set_xlim(lambda_minus<span class="op">-</span><span class="dv">3</span><span class="op">*</span>np.std(lambdas_rand), lambda_plus<span class="op">+</span><span class="dv">3</span><span class="op">*</span>np.std(lambdas_rand))</span>
<span id="cb26-15"><a href="#cb26-15" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">1</span>].scatter(lambda_random, P_rm, label<span class="op">=</span><span class="st">'$P_{\it</span><span class="sc">{RMT}</span><span class="st">}$'</span>, color<span class="op">=</span><span class="st">'green'</span>)</span>
<span id="cb26-16"><a href="#cb26-16" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">1</span>].legend()</span>
<span id="cb26-17"><a href="#cb26-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-18"><a href="#cb26-18" aria-hidden="true" tabindex="-1"></a>fig.tight_layout()</span>
<span id="cb26-19"><a href="#cb26-19" aria-hidden="true" tabindex="-1"></a>plt.show()<span class="op">;</span></span></code><button title="Копіювати" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div id="fig-lambda" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="lab_8_files/figure-html/fig-lambda-output-1.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Рис.&nbsp;8.2: Щільність розподілу ймовірностей для матриці прибутковостей фінансових активів <span class="math inline">\(P_{empiric}^{init}\)</span> та випадкової матриці <span class="math inline">\(P_{empiric}^{rand}\)</span>. Другий рисунок представляє щільність розподілу, що прогнозується ТВМ (зелена крива)</figcaption>
</figure>
</div>
</div>
</div>
<div class="cell" data-execution_count="410">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(<span class="dv">3</span>, <span class="dv">1</span>, figsize<span class="op">=</span>(<span class="dv">13</span>, <span class="dv">10</span>), sharex<span class="op">=</span><span class="va">True</span>, sharey<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">0</span>].hist(u[:, <span class="dv">0</span>], bins<span class="op">=</span><span class="dv">50</span>, density<span class="op">=</span><span class="va">True</span>, label<span class="op">=</span><span class="vs">r'$\rho(u)_</span><span class="sc">{empiric}</span><span class="vs">^</span><span class="sc">{init}</span><span class="vs">$'</span>)</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">0</span>].hist(u_rand[:, <span class="dv">0</span>], bins<span class="op">=</span><span class="dv">50</span>, density<span class="op">=</span><span class="va">True</span>, alpha<span class="op">=</span><span class="fl">0.7</span>, label<span class="op">=</span><span class="vs">r'$\rho(u)_</span><span class="sc">{empiric}</span><span class="vs">^</span><span class="sc">{rand}</span><span class="vs">$'</span>)</span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">0</span>].set_xlabel(<span class="st">'$u_</span><span class="sc">{1}</span><span class="st">$'</span>)</span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">0</span>].set_ylabel(<span class="st">'$P(u)$'</span>)</span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">0</span>].set_title(<span class="st">'Компоненти власного вектора при $ \lambda_</span><span class="sc">{1}</span><span class="st"> $'</span>)</span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">0</span>].legend()</span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">0</span>].set_yscale(<span class="st">'log'</span>)</span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">1</span>].hist(u[:, <span class="dv">30</span>], bins<span class="op">=</span><span class="dv">50</span>, density<span class="op">=</span><span class="va">True</span>, label<span class="op">=</span><span class="vs">r'$\rho(u)_</span><span class="sc">{empiric}</span><span class="vs">^</span><span class="sc">{init}</span><span class="vs">$'</span>)</span>
<span id="cb27-11"><a href="#cb27-11" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">1</span>].hist(u_rand[:, <span class="dv">30</span>], bins<span class="op">=</span><span class="dv">50</span>, density<span class="op">=</span><span class="va">True</span>, alpha<span class="op">=</span><span class="fl">0.7</span>, label<span class="op">=</span><span class="vs">r'$\rho(u)_</span><span class="sc">{empiric}</span><span class="vs">^</span><span class="sc">{rand}</span><span class="vs">$'</span>)</span>
<span id="cb27-12"><a href="#cb27-12" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">1</span>].set_xlabel(<span class="st">'$u_</span><span class="sc">{30}</span><span class="st">$'</span>)</span>
<span id="cb27-13"><a href="#cb27-13" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">1</span>].set_ylabel(<span class="st">'$P(u)$'</span>)</span>
<span id="cb27-14"><a href="#cb27-14" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">1</span>].set_title(<span class="st">'Компоненти власного вектора при $ \lambda_</span><span class="sc">{30}</span><span class="st"> $'</span>)</span>
<span id="cb27-15"><a href="#cb27-15" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">1</span>].legend()</span>
<span id="cb27-16"><a href="#cb27-16" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">1</span>].set_yscale(<span class="st">'log'</span>)</span>
<span id="cb27-17"><a href="#cb27-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-18"><a href="#cb27-18" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">2</span>].hist(u[:, <span class="dv">70</span>], bins<span class="op">=</span><span class="dv">50</span>, density<span class="op">=</span><span class="va">True</span>, label<span class="op">=</span><span class="vs">r'$\rho(u)_</span><span class="sc">{empiric}</span><span class="vs">^</span><span class="sc">{init}</span><span class="vs">$'</span>)</span>
<span id="cb27-19"><a href="#cb27-19" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">2</span>].hist(u_rand[:, <span class="dv">70</span>], bins<span class="op">=</span><span class="dv">50</span>, density<span class="op">=</span><span class="va">True</span>, alpha<span class="op">=</span><span class="fl">0.7</span>, label<span class="op">=</span><span class="vs">r'$\rho(u)_</span><span class="sc">{empiric}</span><span class="vs">^</span><span class="sc">{rand}</span><span class="vs">$'</span>)</span>
<span id="cb27-20"><a href="#cb27-20" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">2</span>].set_xlabel(<span class="st">'$u_</span><span class="sc">{70}</span><span class="st">$'</span>)</span>
<span id="cb27-21"><a href="#cb27-21" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">2</span>].set_ylabel(<span class="st">'$P(u)$'</span>)</span>
<span id="cb27-22"><a href="#cb27-22" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">2</span>].set_title(<span class="st">'Компоненти власного вектора при $ \lambda_</span><span class="sc">{70}</span><span class="st"> $'</span>)</span>
<span id="cb27-23"><a href="#cb27-23" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">2</span>].legend()</span>
<span id="cb27-24"><a href="#cb27-24" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">2</span>].set_yscale(<span class="st">'log'</span>)</span>
<span id="cb27-25"><a href="#cb27-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-26"><a href="#cb27-26" aria-hidden="true" tabindex="-1"></a>fig.tight_layout()</span>
<span id="cb27-27"><a href="#cb27-27" aria-hidden="true" tabindex="-1"></a>plt.show()<span class="op">;</span></span></code><button title="Копіювати" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div id="fig-eigen" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="lab_8_files/figure-html/fig-eigen-output-1.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Рис.&nbsp;8.3: Щільність розподілу ймовірностей компонент власних векторів вихідної матриці прибутковостей та пвипадкової матриці при <span class="math inline">\(\lambda_1\)</span>, <span class="math inline">\(\lambda_{30}\)</span> та <span class="math inline">\(\lambda_{70}\)</span></figcaption>
</figure>
</div>
</div>
</div>
</section>
<section id="обернене-відношення-участі-1" class="level3" data-number="8.2.3">
<h3 data-number="8.2.3" class="anchored" data-anchor-id="обернене-відношення-участі-1"><span class="header-section-number">8.2.3</span> Обернене відношення участі</h3>
<div class="cell" data-execution_count="411">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> calc_ipr(u):</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> np.<span class="bu">sum</span>(u<span class="op">**</span><span class="dv">4</span>, axis<span class="op">=</span><span class="dv">0</span>)</span></code><button title="Копіювати" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="412">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>IPR <span class="op">=</span> calc_ipr(u)</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>IPR_rand <span class="op">=</span> calc_ipr(u_rand)</span></code><button title="Копіювати" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="413">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">1</span>)</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>ax.scatter(lambdas, IPR, color<span class="op">=</span><span class="st">'green'</span>, label<span class="op">=</span><span class="vs">r'$IPR_</span><span class="sc">{init}</span><span class="vs">$'</span>, s<span class="op">=</span><span class="dv">10</span><span class="op">**</span><span class="dv">2</span>, marker<span class="op">=</span><span class="st">'x'</span>)</span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>ax.scatter(lambdas_rand, IPR_rand, color<span class="op">=</span><span class="st">'red'</span>, label<span class="op">=</span><span class="vs">r'$IPR_</span><span class="sc">{rand}</span><span class="vs">$'</span>, s<span class="op">=</span><span class="dv">10</span><span class="op">**</span><span class="dv">2</span>, marker<span class="op">=</span><span class="st">'x'</span>)</span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a>ax.set_xlabel(<span class="vs">r'$\lambda_</span><span class="sc">{i}</span><span class="vs">$'</span>)</span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a>ax.set_ylabel(<span class="vs">r'$IPR$'</span>)</span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a>ax.set_xscale(<span class="st">'log'</span>)</span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a>ax.legend()</span>
<span id="cb30-9"><a href="#cb30-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-10"><a href="#cb30-10" aria-hidden="true" tabindex="-1"></a>fig.tight_layout()</span>
<span id="cb30-11"><a href="#cb30-11" aria-hidden="true" tabindex="-1"></a>plt.show()<span class="op">;</span> </span></code><button title="Копіювати" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div id="fig-ipr" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="lab_8_files/figure-html/fig-ipr-output-1.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Рис.&nbsp;8.4: Обернене відношення участі для вихідного та перемішаного рядів</figcaption>
</figure>
</div>
</div>
</div>
</section>
<section id="коефіцієнт-поглинання" class="level3" data-number="8.2.4">
<h3 data-number="8.2.4" class="anchored" data-anchor-id="коефіцієнт-поглинання"><span class="header-section-number">8.2.4</span> Коефіцієнт поглинання</h3>
<p>Цікаво буде буде порівняти максимальне власне значення <span class="math inline">\(\lambda_{max}\)</span> з середнім значенням коефіцієнта кореляції і так званим коефіцієнтом поглинання (absorption ratio, AR), який є кумулятивною мірою ризику і визначається як</p>
<p><span id="eq-8-9"><span class="math display">\[
AR = \sum_{k=1}^{n}\lambda_k \bigg/ \sum_{k=1}^{N}\lambda_k,
\qquad(8.9)\]</span></span></p>
<p>і вказує, яку частину загальної варіації описують <span class="math inline">\(n\)</span> із загальної кількості <span class="math inline">\(N\)</span> власних значень.</p>
<p>Щоб вирішити, який власний вектор можна відкинути для розрахунків у чисельнику формули вище, не втрачаючи занадто багато інформації, нам потрібно перевірити відповідні власні значення: власні вектори з найменшими власними значеннями несуть найменшу інформацію про розподіл даних; це ті, які можна відкинути.</p>
<p>Загальний підхід полягає в ранжируванні власних значень від найвищого до найнижчого.</p>
<p>Після сортування власних пар наступне запитання: “скільки основних компонентів ми збираємось вибрати для розрахунку коефіцієнту поглинання?”. Корисною мірою є так звана “врахована (пояснена) дисперсія”, яка може бути обчислена за власними значеннями. Пояснена дисперсія говорить нам, скільки інформації (дисперсії) можна віднести до кожної із головних компонент.</p>
<p>Визначимо слідуючу функцію для коефіцієнту поглинання:</p>
<div class="cell" data-execution_count="414">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> ar(lambdas, proc):</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>    <span class="co"># сортуємо власні значення у спадному порядку</span></span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>    sorted_lambdas <span class="op">=</span> np.sort(lambdas)[::<span class="op">-</span><span class="dv">1</span>]</span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a>    <span class="co"># розраховуємо кумулятивну варіацію </span></span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a>    cumulative_variance <span class="op">=</span> np.cumsum(sorted_lambdas) <span class="op">/</span> np.<span class="bu">sum</span>(sorted_lambdas)</span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-9"><a href="#cb31-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># знаходимо індекс, де кумулятивна варіація перетинає "proc"</span></span>
<span id="cb31-10"><a href="#cb31-10" aria-hidden="true" tabindex="-1"></a>    index_percent <span class="op">=</span> np.argmax(cumulative_variance <span class="op">&gt;=</span> proc) <span class="op">+</span> <span class="dv">1</span></span>
<span id="cb31-11"><a href="#cb31-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-12"><a href="#cb31-12" aria-hidden="true" tabindex="-1"></a>    <span class="co"># виділяємо верхні власні значення, які описують встановлений відсоток даних</span></span>
<span id="cb31-13"><a href="#cb31-13" aria-hidden="true" tabindex="-1"></a>    selected_lambdas <span class="op">=</span> sorted_lambdas[:index_percent]</span>
<span id="cb31-14"><a href="#cb31-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-15"><a href="#cb31-15" aria-hidden="true" tabindex="-1"></a>    <span class="co"># повертаємо коефіцієнт поглинання та кількість значень, що пояснюють обраний відсоток варіації</span></span>
<span id="cb31-16"><a href="#cb31-16" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> np.<span class="bu">sum</span>(selected_lambdas)<span class="op">/</span>np.<span class="bu">sum</span>(sorted_lambdas), <span class="bu">len</span>(selected_lambdas)</span></code><button title="Копіювати" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Розрахуємо коефіцієнт поглинання як для власних значень вихідної матриці кореляцій, так і для випадкової. Тут ми розглянемо як варіюється коефіцієнт поглинання при різних значеннях поясненої варіації власними значеннями матриці кореляцій:</p>
<div class="cell" data-execution_count="415">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>proc_variance <span class="op">=</span> np.linspace(<span class="dv">0</span>, <span class="fl">0.99</span>, <span class="dv">100</span>)</span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>ar_init <span class="op">=</span> np.array([ar(lambdas, proc)[<span class="dv">0</span>] <span class="cf">for</span> proc <span class="kw">in</span> proc_variance])</span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>ar_rand <span class="op">=</span> np.array([ar(lambdas_rand, proc)[<span class="dv">0</span>] <span class="cf">for</span> proc <span class="kw">in</span> proc_variance])</span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a>lambdas_init_cnt <span class="op">=</span> np.array([ar(lambdas, proc)[<span class="dv">1</span>] <span class="cf">for</span> proc <span class="kw">in</span> proc_variance])</span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a>lambdas_rand_cnt <span class="op">=</span> np.array([ar(lambdas_rand, proc)[<span class="dv">1</span>] <span class="cf">for</span> proc <span class="kw">in</span> proc_variance])</span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-8"><a href="#cb32-8" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">2</span>, figsize<span class="op">=</span>(<span class="dv">13</span>, <span class="dv">8</span>))</span>
<span id="cb32-9"><a href="#cb32-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-10"><a href="#cb32-10" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">0</span>].plot(proc_variance, ar_init, color<span class="op">=</span><span class="st">'green'</span>, label<span class="op">=</span><span class="vs">r'$AR_</span><span class="sc">{init}</span><span class="vs">$'</span>)</span>
<span id="cb32-11"><a href="#cb32-11" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">0</span>].plot(proc_variance, ar_rand, color<span class="op">=</span><span class="st">'red'</span>, label<span class="op">=</span><span class="vs">r'$AR_</span><span class="sc">{rand}</span><span class="vs">$'</span>)</span>
<span id="cb32-12"><a href="#cb32-12" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">0</span>].set_xlabel(<span class="st">'Відсоток варіації'</span>)</span>
<span id="cb32-13"><a href="#cb32-13" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">0</span>].set_ylabel(<span class="st">'$AR$'</span>)</span>
<span id="cb32-14"><a href="#cb32-14" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">0</span>].legend()</span>
<span id="cb32-15"><a href="#cb32-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-16"><a href="#cb32-16" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">1</span>].plot(proc_variance, lambdas_init_cnt, color<span class="op">=</span><span class="st">'green'</span>, label<span class="op">=</span><span class="vs">r'$\#\lambda_</span><span class="sc">{i}</span><span class="vs">^</span><span class="sc">{init}</span><span class="vs">$'</span>)</span>
<span id="cb32-17"><a href="#cb32-17" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">1</span>].plot(proc_variance, lambdas_rand_cnt, color<span class="op">=</span><span class="st">'red'</span>, label<span class="op">=</span><span class="vs">r'$\#\lambda_</span><span class="sc">{i}</span><span class="vs">^</span><span class="sc">{rand}</span><span class="vs">$'</span>)</span>
<span id="cb32-18"><a href="#cb32-18" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">1</span>].set_xlabel(<span class="st">'Відсоток варіації'</span>)</span>
<span id="cb32-19"><a href="#cb32-19" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">1</span>].set_ylabel(<span class="vs">r'Кі-ть $\lambda_i$'</span>)</span>
<span id="cb32-20"><a href="#cb32-20" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">1</span>].legend()</span>
<span id="cb32-21"><a href="#cb32-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-22"><a href="#cb32-22" aria-hidden="true" tabindex="-1"></a>fig.tight_layout()</span>
<span id="cb32-23"><a href="#cb32-23" aria-hidden="true" tabindex="-1"></a>plt.show()<span class="op">;</span></span></code><button title="Копіювати" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div id="fig-ar" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="lab_8_files/figure-html/fig-ar-output-1.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Рис.&nbsp;8.5: Залежність коефіцієнта поглинання від різних значень поясненої варіації власними значеннями матриць кореляції вихідних прибутковостей та випадкових (рисунок ліворуч). Залежність кількості поясненої варіації від кількості власних значень, що пояснюють такий відсоток (рисунок праворуч)</figcaption>
</figure>
</div>
</div>
</div>
<p>Як ми можемо бачити на даних рисунках, коефіцієнт поглинання для вихідної матриці кореляцій залишається сталим при перших 40% варіації. На рисунку справа видно, що лише одного власного значення достатньо для опису майже половини всього ринку. Для випадкової матриці кількість власних значень необхідних для опису системи зростає прямо пропоційно відсотку варіації. Отже, для нашої задачі при розрахунку коефіцієнту поглинання достатньо буде взяти до 40% варіації при врахуванні кількості необхідних власних значень у чисельнику <a href="#eq-8-9">Рівняння&nbsp;<span>8.9</span></a>.</p>
</section>
<section id="віконна-процедура" class="level3" data-number="8.2.5">
<h3 data-number="8.2.5" class="anchored" data-anchor-id="віконна-процедура"><span class="header-section-number">8.2.5</span> Віконна процедура</h3>
<p>Перш ніж розпочинати розрахунки визначимо функцію для побудови графіків. Вона буде виводити один із часових рядів досліджуваної бази акцій компаній та розраховані індикатори. Ми будемо виводити як двовимірні, так і тривимірні графіки.</p>
<div class="cell" data-execution_count="246">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> plot_2d(time_ser_index, </span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>            time_ser_values,</span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>            y1_values,  </span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>            time_ser_label, </span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a>            y1_label, </span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a>            x_label,</span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a>            file_name, </span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true" tabindex="-1"></a>            clr<span class="op">=</span><span class="st">"magenta"</span>):</span>
<span id="cb33-9"><a href="#cb33-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-10"><a href="#cb33-10" aria-hidden="true" tabindex="-1"></a>    fig, ax <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">1</span>)</span>
<span id="cb33-11"><a href="#cb33-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-12"><a href="#cb33-12" aria-hidden="true" tabindex="-1"></a>    ax2 <span class="op">=</span> ax.twinx()</span>
<span id="cb33-13"><a href="#cb33-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-14"><a href="#cb33-14" aria-hidden="true" tabindex="-1"></a>    ax2.spines.right.set_position((<span class="st">"axes"</span>, <span class="fl">1.03</span>))</span>
<span id="cb33-15"><a href="#cb33-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-16"><a href="#cb33-16" aria-hidden="true" tabindex="-1"></a>    p1, <span class="op">=</span> ax.plot(time_ser_index, </span>
<span id="cb33-17"><a href="#cb33-17" aria-hidden="true" tabindex="-1"></a>                time_ser_values, </span>
<span id="cb33-18"><a href="#cb33-18" aria-hidden="true" tabindex="-1"></a>                <span class="st">"b-"</span>, </span>
<span id="cb33-19"><a href="#cb33-19" aria-hidden="true" tabindex="-1"></a>                label<span class="op">=</span><span class="vs">fr"</span><span class="sc">{</span>time_ser_label<span class="sc">}</span><span class="vs">"</span>)</span>
<span id="cb33-20"><a href="#cb33-20" aria-hidden="true" tabindex="-1"></a>    p2, <span class="op">=</span> ax2.plot(time_ser_index, </span>
<span id="cb33-21"><a href="#cb33-21" aria-hidden="true" tabindex="-1"></a>                y1_values, color<span class="op">=</span>clr, label<span class="op">=</span>y1_label)</span>
<span id="cb33-22"><a href="#cb33-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-23"><a href="#cb33-23" aria-hidden="true" tabindex="-1"></a>    ax.set_xlabel(x_label)</span>
<span id="cb33-24"><a href="#cb33-24" aria-hidden="true" tabindex="-1"></a>    ax.set_ylabel(<span class="ss">f"</span><span class="sc">{</span>y1_label<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb33-25"><a href="#cb33-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-26"><a href="#cb33-26" aria-hidden="true" tabindex="-1"></a>    ax.yaxis.label.set_color(p1.get_color())</span>
<span id="cb33-27"><a href="#cb33-27" aria-hidden="true" tabindex="-1"></a>    ax2.yaxis.label.set_color(p2.get_color())</span>
<span id="cb33-28"><a href="#cb33-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-29"><a href="#cb33-29" aria-hidden="true" tabindex="-1"></a>    tkw <span class="op">=</span> <span class="bu">dict</span>(size<span class="op">=</span><span class="dv">4</span>, width<span class="op">=</span><span class="fl">1.5</span>)</span>
<span id="cb33-30"><a href="#cb33-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-31"><a href="#cb33-31" aria-hidden="true" tabindex="-1"></a>    ax.tick_params(axis<span class="op">=</span><span class="st">'y'</span>, colors<span class="op">=</span>p1.get_color(), <span class="op">**</span>tkw)</span>
<span id="cb33-32"><a href="#cb33-32" aria-hidden="true" tabindex="-1"></a>    ax2.tick_params(axis<span class="op">=</span><span class="st">'y'</span>, colors<span class="op">=</span>p2.get_color(), <span class="op">**</span>tkw)</span>
<span id="cb33-33"><a href="#cb33-33" aria-hidden="true" tabindex="-1"></a>    ax.tick_params(axis<span class="op">=</span><span class="st">'x'</span>, <span class="op">**</span>tkw)</span>
<span id="cb33-34"><a href="#cb33-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-35"><a href="#cb33-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-36"><a href="#cb33-36" aria-hidden="true" tabindex="-1"></a>    ax2.legend(handles<span class="op">=</span>[p1, p2])</span>
<span id="cb33-37"><a href="#cb33-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-38"><a href="#cb33-38" aria-hidden="true" tabindex="-1"></a>    plt.savefig(file_name <span class="op">+</span> <span class="st">".jpg"</span>)</span>
<span id="cb33-39"><a href="#cb33-39" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb33-40"><a href="#cb33-40" aria-hidden="true" tabindex="-1"></a>    plt.show()<span class="op">;</span></span></code><button title="Копіювати" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="451">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>window <span class="op">=</span> <span class="dv">250</span>        <span class="co"># розмір вікна</span></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>tstep <span class="op">=</span> <span class="dv">1</span>           <span class="co"># крок вікна</span></span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>ret_type <span class="op">=</span> <span class="dv">4</span>        <span class="co"># вид ряду: </span></span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a>                    <span class="co"># 1 - вихідний, </span></span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a>                    <span class="co"># 2 - детрендований (різниця між теп. значенням та попереднім)</span></span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a>                    <span class="co"># 3 - прибутковості звичайні, </span></span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a>                    <span class="co"># 4 - стандартизовані прибутковості, </span></span>
<span id="cb34-8"><a href="#cb34-8" aria-hidden="true" tabindex="-1"></a>                    <span class="co"># 5 - абсолютні значення (волатильності)</span></span>
<span id="cb34-9"><a href="#cb34-9" aria-hidden="true" tabindex="-1"></a>                    <span class="co"># 6 - стандартизований ряд</span></span>
<span id="cb34-10"><a href="#cb34-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-11"><a href="#cb34-11" aria-hidden="true" tabindex="-1"></a>length <span class="op">=</span> data.shape[<span class="dv">1</span>]</span>
<span id="cb34-12"><a href="#cb34-12" aria-hidden="true" tabindex="-1"></a>num_bins <span class="op">=</span> <span class="dv">50</span></span>
<span id="cb34-13"><a href="#cb34-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-14"><a href="#cb34-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-15"><a href="#cb34-15" aria-hidden="true" tabindex="-1"></a>mean_corr_init <span class="op">=</span> []</span>
<span id="cb34-16"><a href="#cb34-16" aria-hidden="true" tabindex="-1"></a>mean_corr_rand <span class="op">=</span> []</span>
<span id="cb34-17"><a href="#cb34-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-18"><a href="#cb34-18" aria-hidden="true" tabindex="-1"></a>C_vals_init <span class="op">=</span> [] </span>
<span id="cb34-19"><a href="#cb34-19" aria-hidden="true" tabindex="-1"></a>C_vals_rand <span class="op">=</span> []</span>
<span id="cb34-20"><a href="#cb34-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-21"><a href="#cb34-21" aria-hidden="true" tabindex="-1"></a>C_hist_vals_init <span class="op">=</span> []</span>
<span id="cb34-22"><a href="#cb34-22" aria-hidden="true" tabindex="-1"></a>C_hist_vals_rand <span class="op">=</span> []</span>
<span id="cb34-23"><a href="#cb34-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-24"><a href="#cb34-24" aria-hidden="true" tabindex="-1"></a>u_hist_vals_init <span class="op">=</span> []</span>
<span id="cb34-25"><a href="#cb34-25" aria-hidden="true" tabindex="-1"></a>u_hist_vals_rand <span class="op">=</span> []</span>
<span id="cb34-26"><a href="#cb34-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-27"><a href="#cb34-27" aria-hidden="true" tabindex="-1"></a>lambdas_vals_init <span class="op">=</span> []</span>
<span id="cb34-28"><a href="#cb34-28" aria-hidden="true" tabindex="-1"></a>lambdas_vals_rand <span class="op">=</span> []</span>
<span id="cb34-29"><a href="#cb34-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-30"><a href="#cb34-30" aria-hidden="true" tabindex="-1"></a>lambdas_vals_max_init <span class="op">=</span> []</span>
<span id="cb34-31"><a href="#cb34-31" aria-hidden="true" tabindex="-1"></a>lambdas_vals_max_rand <span class="op">=</span> []</span>
<span id="cb34-32"><a href="#cb34-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-33"><a href="#cb34-33" aria-hidden="true" tabindex="-1"></a>lambdas_hist_vals_init <span class="op">=</span> []</span>
<span id="cb34-34"><a href="#cb34-34" aria-hidden="true" tabindex="-1"></a>lambdas_hist_vals_rand <span class="op">=</span> []</span>
<span id="cb34-35"><a href="#cb34-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-36"><a href="#cb34-36" aria-hidden="true" tabindex="-1"></a>ipr_vals_init <span class="op">=</span> []</span>
<span id="cb34-37"><a href="#cb34-37" aria-hidden="true" tabindex="-1"></a>ipr_vals_rand <span class="op">=</span> []</span>
<span id="cb34-38"><a href="#cb34-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-39"><a href="#cb34-39" aria-hidden="true" tabindex="-1"></a>absorb_vals_init <span class="op">=</span> []</span>
<span id="cb34-40"><a href="#cb34-40" aria-hidden="true" tabindex="-1"></a>absorb_vals_rand <span class="op">=</span> []</span></code><button title="Копіювати" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="452">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> tqdm(<span class="bu">range</span>(<span class="dv">0</span>,length<span class="op">-</span>window,tstep)):</span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>    <span class="co"># відбираємо фрагменти</span></span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>    fragm <span class="op">=</span> data.iloc[:, i:i<span class="op">+</span>window].copy()  </span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a>    <span class="co"># виконуємо процедуру трансформації ряду </span></span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a>    fragm <span class="op">=</span> transformation(fragm, ret_type)</span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-9"><a href="#cb35-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># генеруємо випадковий фрагмент</span></span>
<span id="cb35-10"><a href="#cb35-10" aria-hidden="true" tabindex="-1"></a>    fragm_random <span class="op">=</span> np.random.normal(size<span class="op">=</span>(fragm.shape[<span class="dv">0</span>], fragm.shape[<span class="dv">1</span>]))</span>
<span id="cb35-11"><a href="#cb35-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-12"><a href="#cb35-12" aria-hidden="true" tabindex="-1"></a>    <span class="co"># розраховуємо крос-кореляції</span></span>
<span id="cb35-13"><a href="#cb35-13" aria-hidden="true" tabindex="-1"></a>    C_fragm, ccoef_flat_fragm <span class="op">=</span> calc_cross_corr(fragm)</span>
<span id="cb35-14"><a href="#cb35-14" aria-hidden="true" tabindex="-1"></a>    C_fragm_random, ccoef_flat_fragm_random <span class="op">=</span> calc_cross_corr(fragm_random)</span>
<span id="cb35-15"><a href="#cb35-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-16"><a href="#cb35-16" aria-hidden="true" tabindex="-1"></a>    <span class="co"># розраховуємо гістограму крос-кореляцій</span></span>
<span id="cb35-17"><a href="#cb35-17" aria-hidden="true" tabindex="-1"></a>    C_fragm_hist <span class="op">=</span> np.histogram(ccoef_flat_fragm, bins<span class="op">=</span>num_bins, density<span class="op">=</span><span class="va">True</span>)[<span class="dv">0</span>]</span>
<span id="cb35-18"><a href="#cb35-18" aria-hidden="true" tabindex="-1"></a>    C_fragm_hist_rand <span class="op">=</span> np.histogram(ccoef_flat_fragm_random, bins<span class="op">=</span>num_bins, density<span class="op">=</span><span class="va">True</span>)[<span class="dv">0</span>]</span>
<span id="cb35-19"><a href="#cb35-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-20"><a href="#cb35-20" aria-hidden="true" tabindex="-1"></a>    <span class="co"># розрахунок середнього значення коефіцієнта кореляції</span></span>
<span id="cb35-21"><a href="#cb35-21" aria-hidden="true" tabindex="-1"></a>    mean_correlation <span class="op">=</span> np.mean(ccoef_flat_fragm)</span>
<span id="cb35-22"><a href="#cb35-22" aria-hidden="true" tabindex="-1"></a>    mean_correlation_random <span class="op">=</span> np.mean(ccoef_flat_fragm_random)</span>
<span id="cb35-23"><a href="#cb35-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-24"><a href="#cb35-24" aria-hidden="true" tabindex="-1"></a>    <span class="co"># розрахунок власних значень та векторів</span></span>
<span id="cb35-25"><a href="#cb35-25" aria-hidden="true" tabindex="-1"></a>    lambdas_fragm, u_fragm <span class="op">=</span> calc_lambd_eig(C_fragm)</span>
<span id="cb35-26"><a href="#cb35-26" aria-hidden="true" tabindex="-1"></a>    lambdas_fragm_random, u_fragm_random <span class="op">=</span> calc_lambd_eig(C_fragm_random)</span>
<span id="cb35-27"><a href="#cb35-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-28"><a href="#cb35-28" aria-hidden="true" tabindex="-1"></a>    <span class="co"># розраховуємо гістограму власних значень</span></span>
<span id="cb35-29"><a href="#cb35-29" aria-hidden="true" tabindex="-1"></a>    lambdas_fragm_hist <span class="op">=</span> np.histogram(lambdas_fragm, bins<span class="op">=</span>num_bins, density<span class="op">=</span><span class="va">True</span>)[<span class="dv">0</span>]</span>
<span id="cb35-30"><a href="#cb35-30" aria-hidden="true" tabindex="-1"></a>    u_fragm_hist_init <span class="op">=</span> np.histogram(u_fragm, bins<span class="op">=</span>num_bins, density<span class="op">=</span><span class="va">True</span>)[<span class="dv">0</span>]</span>
<span id="cb35-31"><a href="#cb35-31" aria-hidden="true" tabindex="-1"></a>    lambdas_fragm_hist_rand <span class="op">=</span> np.histogram(lambdas_fragm_random, bins<span class="op">=</span>num_bins, density<span class="op">=</span><span class="va">True</span>)[<span class="dv">0</span>]</span>
<span id="cb35-32"><a href="#cb35-32" aria-hidden="true" tabindex="-1"></a>    u_fragm_hist_rand <span class="op">=</span> np.histogram(u_fragm_random, bins<span class="op">=</span>num_bins, density<span class="op">=</span><span class="va">True</span>)[<span class="dv">0</span>]</span>
<span id="cb35-33"><a href="#cb35-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-34"><a href="#cb35-34" aria-hidden="true" tabindex="-1"></a>    <span class="co"># отримання максимального власного значення</span></span>
<span id="cb35-35"><a href="#cb35-35" aria-hidden="true" tabindex="-1"></a>    lambdas_fragm_max <span class="op">=</span> lambdas_fragm.<span class="bu">max</span>()</span>
<span id="cb35-36"><a href="#cb35-36" aria-hidden="true" tabindex="-1"></a>    lambdas_fragm_max_random <span class="op">=</span> lambdas_fragm_random.<span class="bu">max</span>()</span>
<span id="cb35-37"><a href="#cb35-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-38"><a href="#cb35-38" aria-hidden="true" tabindex="-1"></a>    <span class="co"># отримання оберненого відношення участі</span></span>
<span id="cb35-39"><a href="#cb35-39" aria-hidden="true" tabindex="-1"></a>    ipr_fragm <span class="op">=</span> calc_ipr(u_fragm)</span>
<span id="cb35-40"><a href="#cb35-40" aria-hidden="true" tabindex="-1"></a>    ipr_random <span class="op">=</span> calc_ipr(u_fragm_random)</span>
<span id="cb35-41"><a href="#cb35-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-42"><a href="#cb35-42" aria-hidden="true" tabindex="-1"></a>    <span class="co"># розрахунок коефіцієнта поглинання </span></span>
<span id="cb35-43"><a href="#cb35-43" aria-hidden="true" tabindex="-1"></a>    absorb_init <span class="op">=</span> ar(lambdas_fragm, <span class="fl">0.05</span>)[<span class="dv">0</span>]</span>
<span id="cb35-44"><a href="#cb35-44" aria-hidden="true" tabindex="-1"></a>    absorb_rand <span class="op">=</span> ar(lambdas_fragm_random, <span class="fl">0.05</span>)[<span class="dv">0</span>]</span>
<span id="cb35-45"><a href="#cb35-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-46"><a href="#cb35-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-47"><a href="#cb35-47" aria-hidden="true" tabindex="-1"></a>    <span class="co"># додаємо індикатори до масивів</span></span>
<span id="cb35-48"><a href="#cb35-48" aria-hidden="true" tabindex="-1"></a>    mean_corr_init.append(mean_correlation)</span>
<span id="cb35-49"><a href="#cb35-49" aria-hidden="true" tabindex="-1"></a>    mean_corr_rand.append(mean_correlation_random)</span>
<span id="cb35-50"><a href="#cb35-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-51"><a href="#cb35-51" aria-hidden="true" tabindex="-1"></a>    C_vals_init.append(ccoef_flat_fragm)</span>
<span id="cb35-52"><a href="#cb35-52" aria-hidden="true" tabindex="-1"></a>    C_vals_rand.append(ccoef_flat_fragm_random)</span>
<span id="cb35-53"><a href="#cb35-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-54"><a href="#cb35-54" aria-hidden="true" tabindex="-1"></a>    C_hist_vals_init.append(C_fragm_hist)</span>
<span id="cb35-55"><a href="#cb35-55" aria-hidden="true" tabindex="-1"></a>    C_hist_vals_rand.append(C_fragm_hist_rand)</span>
<span id="cb35-56"><a href="#cb35-56" aria-hidden="true" tabindex="-1"></a>    lambdas_hist_vals_init.append(lambdas_fragm_hist)</span>
<span id="cb35-57"><a href="#cb35-57" aria-hidden="true" tabindex="-1"></a>    lambdas_hist_vals_rand.append(lambdas_fragm_hist_rand)</span>
<span id="cb35-58"><a href="#cb35-58" aria-hidden="true" tabindex="-1"></a>    u_hist_vals_init.append(u_fragm_hist_init)</span>
<span id="cb35-59"><a href="#cb35-59" aria-hidden="true" tabindex="-1"></a>    u_hist_vals_rand.append(u_fragm_hist_rand)</span>
<span id="cb35-60"><a href="#cb35-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-61"><a href="#cb35-61" aria-hidden="true" tabindex="-1"></a>    lambdas_vals_init.append(lambdas_fragm)</span>
<span id="cb35-62"><a href="#cb35-62" aria-hidden="true" tabindex="-1"></a>    lambdas_vals_rand.append(lambdas_fragm_random)</span>
<span id="cb35-63"><a href="#cb35-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-64"><a href="#cb35-64" aria-hidden="true" tabindex="-1"></a>    lambdas_vals_max_init.append(lambdas_fragm_max)</span>
<span id="cb35-65"><a href="#cb35-65" aria-hidden="true" tabindex="-1"></a>    lambdas_vals_max_rand.append(lambdas_fragm_max_random)</span>
<span id="cb35-66"><a href="#cb35-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-67"><a href="#cb35-67" aria-hidden="true" tabindex="-1"></a>    ipr_vals_init.append(ipr_fragm)</span>
<span id="cb35-68"><a href="#cb35-68" aria-hidden="true" tabindex="-1"></a>    ipr_vals_rand.append(ipr_random)</span>
<span id="cb35-69"><a href="#cb35-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-70"><a href="#cb35-70" aria-hidden="true" tabindex="-1"></a>    absorb_vals_init.append(absorb_init)</span>
<span id="cb35-71"><a href="#cb35-71" aria-hidden="true" tabindex="-1"></a>    absorb_vals_rand.append(absorb_rand)</span></code><button title="Копіювати" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>100%|██████████| 5064/5064 [05:25&lt;00:00, 15.54it/s]</code></pre>
</div>
</div>
<div class="cell" data-execution_count="453">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>ind_names <span class="op">=</span> [<span class="st">'avg_corr_init'</span>, <span class="st">'lambda_max'</span>, <span class="st">'ar'</span>]</span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>indicators <span class="op">=</span> [mean_corr_init, lambdas_vals_max_init, absorb_vals_init]</span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a>measure_labels <span class="op">=</span> [<span class="vs">r'$\langle C \rangle_</span><span class="sc">{init}</span><span class="vs">$'</span>, <span class="vs">r'$\lambda_</span><span class="sc">{max}</span><span class="vs">$'</span>, <span class="vs">r'$AR$'</span>]</span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(ind_names)):</span>
<span id="cb37-8"><a href="#cb37-8" aria-hidden="true" tabindex="-1"></a>    name <span class="op">=</span> <span class="ss">f"RMT_</span><span class="sc">{</span>ind_names[i]<span class="sc">}</span><span class="ss">_symbol=</span><span class="sc">{</span>ylabel<span class="sc">}</span><span class="ss">_wind=</span><span class="sc">{</span>window<span class="sc">}</span><span class="ss">_step=</span><span class="sc">{</span>tstep<span class="sc">}</span><span class="ss">_seriestype=</span><span class="sc">{</span>ret_type<span class="sc">}</span><span class="ss">"</span></span>
<span id="cb37-9"><a href="#cb37-9" aria-hidden="true" tabindex="-1"></a>    np.savetxt(name <span class="op">+</span> <span class="st">".txt"</span>, indicators[i])</span></code><button title="Копіювати" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="середній-коефіцієнт-крос-кореляцій" class="level4" data-number="8.2.5.1">
<h4 data-number="8.2.5.1" class="anchored" data-anchor-id="середній-коефіцієнт-крос-кореляцій"><span class="header-section-number">8.2.5.1</span> Середній коефіцієнт крос-кореляцій</h4>
<div class="cell" data-execution_count="459">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>file_name <span class="op">=</span> <span class="ss">f"avg_corr_symbol=</span><span class="sc">{</span>ylabel<span class="sc">}</span><span class="ss">_wind=</span><span class="sc">{</span>window<span class="sc">}</span><span class="ss">_step=</span><span class="sc">{</span>tstep<span class="sc">}</span><span class="ss">_seriestype=</span><span class="sc">{</span>ret_type<span class="sc">}</span><span class="ss">"</span></span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>plot_2d(data_init.loc[:, ylabel].index[window:length:tstep],</span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a>        data_init.loc[:, ylabel].values[window:length:tstep],</span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a>        mean_corr_init, </span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a>        ylabel,</span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true" tabindex="-1"></a>        measure_labels[<span class="dv">0</span>],</span>
<span id="cb38-8"><a href="#cb38-8" aria-hidden="true" tabindex="-1"></a>        xlabel,</span>
<span id="cb38-9"><a href="#cb38-9" aria-hidden="true" tabindex="-1"></a>        file_name,</span>
<span id="cb38-10"><a href="#cb38-10" aria-hidden="true" tabindex="-1"></a>        clr<span class="op">=</span><span class="st">"magenta"</span>)</span></code><button title="Копіювати" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div id="fig-wind-crosscorr" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="lab_8_files/figure-html/fig-wind-crosscorr-output-1.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Рис.&nbsp;8.6: Динаміка індексу цін акцій компанії Agilent Technologies та середнього показника крос-кореляцій прибутковостей досліджуваних акцій</figcaption>
</figure>
</div>
</div>
</div>
<div class="cell" data-execution_count="463">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>Y <span class="op">=</span> np.linspace(<span class="op">-</span><span class="dv">1</span>, <span class="dv">1</span>, num_bins)</span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> np.arange(window, length, tstep)</span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> np.expand_dims(X, axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> np.repeat(a<span class="op">=</span>X, repeats<span class="op">=</span>Y.shape[<span class="dv">0</span>], axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-7"><a href="#cb39-7" aria-hidden="true" tabindex="-1"></a>Z <span class="op">=</span> np.array(C_hist_vals_init)</span>
<span id="cb39-8"><a href="#cb39-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-9"><a href="#cb39-9" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(subplot_kw<span class="op">=</span>{<span class="st">"projection"</span>: <span class="st">"3d"</span>}, figsize<span class="op">=</span>(<span class="dv">8</span>, <span class="dv">6</span>))</span>
<span id="cb39-10"><a href="#cb39-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-11"><a href="#cb39-11" aria-hidden="true" tabindex="-1"></a>surf <span class="op">=</span> ax.plot_surface(X, Y, Z, cmap<span class="op">=</span><span class="st">'hot'</span>, rstride<span class="op">=</span><span class="dv">2</span>, cstride<span class="op">=</span><span class="dv">2</span>, linewidth<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb39-12"><a href="#cb39-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-13"><a href="#cb39-13" aria-hidden="true" tabindex="-1"></a>ax.set_xlabel(xlabel, fontsize<span class="op">=</span><span class="dv">22</span>, labelpad<span class="op">=</span><span class="dv">15</span>)</span>
<span id="cb39-14"><a href="#cb39-14" aria-hidden="true" tabindex="-1"></a>ax.set_ylabel(<span class="vs">r"$C$"</span>, fontsize<span class="op">=</span><span class="dv">22</span>, labelpad<span class="op">=</span><span class="dv">15</span>)</span>
<span id="cb39-15"><a href="#cb39-15" aria-hidden="true" tabindex="-1"></a>ax.set_zlabel(<span class="vs">r"$P(C)$"</span>, fontsize<span class="op">=</span><span class="dv">22</span>, labelpad<span class="op">=</span><span class="dv">15</span>)</span>
<span id="cb39-16"><a href="#cb39-16" aria-hidden="true" tabindex="-1"></a>ax.tick_params(axis<span class="op">=</span><span class="st">'both'</span>, which<span class="op">=</span><span class="st">'major'</span>, labelsize<span class="op">=</span><span class="dv">18</span>, pad<span class="op">=</span><span class="dv">5</span>)</span>
<span id="cb39-17"><a href="#cb39-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-18"><a href="#cb39-18" aria-hidden="true" tabindex="-1"></a>ax.view_init(<span class="dv">60</span>, <span class="dv">140</span>)</span>
<span id="cb39-19"><a href="#cb39-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-20"><a href="#cb39-20" aria-hidden="true" tabindex="-1"></a>fig.tight_layout()</span>
<span id="cb39-21"><a href="#cb39-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-22"><a href="#cb39-22" aria-hidden="true" tabindex="-1"></a>plt.savefig(<span class="ss">f"RMT_3D_P(C)_wind=</span><span class="sc">{</span>window<span class="sc">}</span><span class="ss">_step=</span><span class="sc">{</span>tstep<span class="sc">}</span><span class="ss">_seriestype=</span><span class="sc">{</span>ret_type<span class="sc">}</span><span class="ss">.jpg"</span>, bbox_inches<span class="op">=</span><span class="st">"tight"</span>)</span>
<span id="cb39-23"><a href="#cb39-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-24"><a href="#cb39-24" aria-hidden="true" tabindex="-1"></a>plt.show()<span class="op">;</span></span></code><button title="Копіювати" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div id="fig-wind-3d-pc" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="lab_8_files/figure-html/fig-wind-3d-pc-output-1.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Рис.&nbsp;8.7: Віконна функція щільності розподілу коефіцієнтів кореляції вихідної матриці фінансових активів</figcaption>
</figure>
</div>
</div>
</div>
</section>
<section id="максимальне-значення-lambda" class="level4" data-number="8.2.5.2">
<h4 data-number="8.2.5.2" class="anchored" data-anchor-id="максимальне-значення-lambda"><span class="header-section-number">8.2.5.2</span> Максимальне значення <span class="math inline">\(\lambda\)</span></h4>
<div class="cell" data-execution_count="460">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>file_name <span class="op">=</span> <span class="ss">f"lambda_max_symbol=</span><span class="sc">{</span>ylabel<span class="sc">}</span><span class="ss">_wind=</span><span class="sc">{</span>window<span class="sc">}</span><span class="ss">_step=</span><span class="sc">{</span>tstep<span class="sc">}</span><span class="ss">_seriestype=</span><span class="sc">{</span>ret_type<span class="sc">}</span><span class="ss">"</span></span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>plot_2d(data_init.loc[:, ylabel].index[window:length:tstep],</span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a>        data_init.loc[:, ylabel].values[window:length:tstep],</span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a>        lambdas_vals_max_init, </span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a>        ylabel,</span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a>        measure_labels[<span class="dv">1</span>],</span>
<span id="cb40-8"><a href="#cb40-8" aria-hidden="true" tabindex="-1"></a>        xlabel,</span>
<span id="cb40-9"><a href="#cb40-9" aria-hidden="true" tabindex="-1"></a>        file_name,</span>
<span id="cb40-10"><a href="#cb40-10" aria-hidden="true" tabindex="-1"></a>        clr<span class="op">=</span><span class="st">"red"</span>)</span></code><button title="Копіювати" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div id="fig-wind-lambda" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="lab_8_files/figure-html/fig-wind-lambda-output-1.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Рис.&nbsp;8.8: Динаміка індексу цін акцій компанії Agilent Technologies та показника <span class="math inline">\(\lambda_{max}\)</span></figcaption>
</figure>
</div>
</div>
</div>
</section>
<section id="обернене-відношення-участі-2" class="level4" data-number="8.2.5.3">
<h4 data-number="8.2.5.3" class="anchored" data-anchor-id="обернене-відношення-участі-2"><span class="header-section-number">8.2.5.3</span> Обернене відношення участі</h4>
<div class="cell" data-execution_count="457">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> log_tick_formatter(val, pos<span class="op">=</span><span class="va">None</span>):</span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="ss">f"$10^</span><span class="ch">{{</span><span class="sc">{</span><span class="bu">int</span>(val)<span class="sc">}</span><span class="ch">}}</span><span class="ss">$"</span>  </span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a>Y <span class="op">=</span> np.array(lambdas_vals_init)</span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> np.arange(window, length, tstep)</span>
<span id="cb41-7"><a href="#cb41-7" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> np.expand_dims(X, axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb41-8"><a href="#cb41-8" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> np.repeat(a<span class="op">=</span>X, repeats<span class="op">=</span>Y.shape[<span class="dv">1</span>], axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb41-9"><a href="#cb41-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-10"><a href="#cb41-10" aria-hidden="true" tabindex="-1"></a>Z <span class="op">=</span> np.array(ipr_vals_init)</span>
<span id="cb41-11"><a href="#cb41-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-12"><a href="#cb41-12" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(subplot_kw<span class="op">=</span>{<span class="st">"projection"</span>: <span class="st">"3d"</span>}, figsize<span class="op">=</span>(<span class="dv">8</span>, <span class="dv">6</span>))</span>
<span id="cb41-13"><a href="#cb41-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-14"><a href="#cb41-14" aria-hidden="true" tabindex="-1"></a>surf <span class="op">=</span> ax.plot_surface(X, np.log(Y), Z, cmap<span class="op">=</span><span class="st">'magma'</span>, rstride<span class="op">=</span><span class="dv">2</span>, cstride<span class="op">=</span><span class="dv">2</span>, linewidth<span class="op">=</span><span class="fl">0.5</span>)</span>
<span id="cb41-15"><a href="#cb41-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-16"><a href="#cb41-16" aria-hidden="true" tabindex="-1"></a>ax.set_xlabel(xlabel, fontsize<span class="op">=</span><span class="dv">22</span>, labelpad<span class="op">=</span><span class="dv">15</span>)</span>
<span id="cb41-17"><a href="#cb41-17" aria-hidden="true" tabindex="-1"></a>ax.set_ylabel(<span class="vs">r"$\lambda_i$"</span>, fontsize<span class="op">=</span><span class="dv">22</span>, labelpad<span class="op">=</span><span class="dv">15</span>)</span>
<span id="cb41-18"><a href="#cb41-18" aria-hidden="true" tabindex="-1"></a>ax.set_zlabel(<span class="vs">r"$IPR$"</span>, fontsize<span class="op">=</span><span class="dv">22</span>, labelpad<span class="op">=</span><span class="dv">15</span>)</span>
<span id="cb41-19"><a href="#cb41-19" aria-hidden="true" tabindex="-1"></a>ax.tick_params(axis<span class="op">=</span><span class="st">'both'</span>, which<span class="op">=</span><span class="st">'major'</span>, labelsize<span class="op">=</span><span class="dv">18</span>, pad<span class="op">=</span><span class="dv">5</span>)</span>
<span id="cb41-20"><a href="#cb41-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-21"><a href="#cb41-21" aria-hidden="true" tabindex="-1"></a>ax.yaxis.set_major_formatter(mticker.FuncFormatter(log_tick_formatter))</span>
<span id="cb41-22"><a href="#cb41-22" aria-hidden="true" tabindex="-1"></a>ax.yaxis.set_major_locator(mticker.MaxNLocator(integer<span class="op">=</span><span class="va">True</span>))</span>
<span id="cb41-23"><a href="#cb41-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-24"><a href="#cb41-24" aria-hidden="true" tabindex="-1"></a>fig.tight_layout()</span>
<span id="cb41-25"><a href="#cb41-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-26"><a href="#cb41-26" aria-hidden="true" tabindex="-1"></a>plt.savefig(<span class="ss">f"RMT_3D_IPR_wind=</span><span class="sc">{</span>window<span class="sc">}</span><span class="ss">_step=</span><span class="sc">{</span>tstep<span class="sc">}</span><span class="ss">_seriestype=</span><span class="sc">{</span>ret_type<span class="sc">}</span><span class="ss">.jpg"</span>, bbox_inches<span class="op">=</span><span class="st">"tight"</span>)</span>
<span id="cb41-27"><a href="#cb41-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-28"><a href="#cb41-28" aria-hidden="true" tabindex="-1"></a>plt.show()<span class="op">;</span></span></code><button title="Копіювати" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div id="fig-wind-ipr3d" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="lab_8_files/figure-html/fig-wind-ipr3d-output-1.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Рис.&nbsp;8.9: Тривимірна віконна динаміка показника оберненого відношення участі</figcaption>
</figure>
</div>
</div>
</div>
</section>
<section id="коефіцієнт-поглинання-1" class="level4" data-number="8.2.5.4">
<h4 data-number="8.2.5.4" class="anchored" data-anchor-id="коефіцієнт-поглинання-1"><span class="header-section-number">8.2.5.4</span> Коефіцієнт поглинання</h4>
<div class="cell" data-execution_count="461">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>file_name <span class="op">=</span> <span class="ss">f"ar_symbol=</span><span class="sc">{</span>ylabel<span class="sc">}</span><span class="ss">_wind=</span><span class="sc">{</span>window<span class="sc">}</span><span class="ss">_step=</span><span class="sc">{</span>tstep<span class="sc">}</span><span class="ss">_seriestype=</span><span class="sc">{</span>ret_type<span class="sc">}</span><span class="ss">"</span></span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a>plot_2d(data_init.loc[:, ylabel].index[window:length:tstep],</span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a>        data_init.loc[:, ylabel].values[window:length:tstep],</span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a>        absorb_vals_init, </span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a>        ylabel,</span>
<span id="cb42-7"><a href="#cb42-7" aria-hidden="true" tabindex="-1"></a>        measure_labels[<span class="dv">2</span>],</span>
<span id="cb42-8"><a href="#cb42-8" aria-hidden="true" tabindex="-1"></a>        xlabel,</span>
<span id="cb42-9"><a href="#cb42-9" aria-hidden="true" tabindex="-1"></a>        file_name,</span>
<span id="cb42-10"><a href="#cb42-10" aria-hidden="true" tabindex="-1"></a>        clr<span class="op">=</span><span class="st">"black"</span>)</span></code><button title="Копіювати" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div id="fig-wind-ar" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="lab_8_files/figure-html/fig-wind-ar-output-1.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Рис.&nbsp;8.10: Динаміка індексу цін акцій компаній Agilent Technologies та коефіцієнту поглинання</figcaption>
</figure>
</div>
</div>
</div>
<p>Таким чином, при наявності сукупності часових рядів, що є даними діяльності економічних об’єктів однієї області, можна провести дослідження стосовно структури вказаної області та взаємодії об’єктів всередині неї. Дослідження проводяться на основі теорії випадкових матриць, що дозволяє отримувати інформацію шляхом аналізу матриці крос-кореляцій, побудованої для сукупної бази економічних об’єктів.</p>
</section>
</section>
</section>
<section id="завдання-для-самостійної-роботи" class="level2" data-number="8.3">
<h2 data-number="8.3" class="anchored" data-anchor-id="завдання-для-самостійної-роботи"><span class="header-section-number">8.3</span> Завдання для самостійної роботи</h2>
<p>Оберіть певний фондовий індекс і проведіть дослідження крахових подій для ринку, що він представляє за допомогою теорії випадкових матриць.</p>
</section>
<section id="контрольні-запитання" class="level2" data-number="8.4">
<h2 data-number="8.4" class="anchored" data-anchor-id="контрольні-запитання"><span class="header-section-number">8.4</span> Контрольні запитання</h2>
<ol type="1">
<li>Поясніть основну ідею теорії випадкових матриць</li>
<li>Про що свідчить відмінність кореляційних і спектральних властивостей матриці даних і випадкової?</li>
<li>Дослідіть, як змінюється розподіл власних значень у випадках:
<ul>
<li><span class="math inline">\(\lambda_{-} &lt; \lambda &lt; \lambda_{+}\)</span>;</li>
<li><span class="math inline">\(\lambda &gt; \lambda_{+}\)</span>;</li>
<li><span class="math inline">\(\lambda &lt; \lambda_{-}\)</span>.</li>
</ul></li>
<li>Порівняйте кольорову карту поля взаємних кореляцій випадкової матриці і заданої. Зробіть висновки</li>
</ol>


<div id="refs" class="references csl-bib-body" role="list" style="display: none">
<div id="ref-Wigner_1951_1" class="csl-entry" role="listitem">
<div class="csl-left-margin">[1] </div><div class="csl-right-inline">E. P. Wigner, <em><a href="https://doi.org/10.1017/S0305004100027237">On the Statistical Distribution of the Widths and Spacings of Nuclear Resonance Levels</a></em>, Mathematical Proceedings of the Cambridge Philosophical Society <strong>47</strong>, 790 (1951).</div>
</div>
<div id="ref-Wigner_1951_2" class="csl-entry" role="listitem">
<div class="csl-left-margin">[2] </div><div class="csl-right-inline">E. P. Wigner, <em><a href="http://www.jstor.org/stable/1969342">On a Class of Analytic Functions from the Quantum Theory of Collisions</a></em>, Annals of Mathematics <strong>53</strong>, 36 (1951).</div>
</div>
<div id="ref-10.1063/1.1703773" class="csl-entry" role="listitem">
<div class="csl-left-margin">[3] </div><div class="csl-right-inline">F. J. Dyson, <em><a href="https://doi.org/10.1063/1.1703773"><span class="nocase">Statistical Theory of the Energy Levels of Complex Systems. I</span></a></em>, Journal of Mathematical Physics <strong>3</strong>, 140 (2004).</div>
</div>
<div id="ref-10.1063/1.1704008" class="csl-entry" role="listitem">
<div class="csl-left-margin">[4] </div><div class="csl-right-inline">F. J. Dyson and M. L. Mehta, <em><a href="https://doi.org/10.1063/1.1704008"><span class="nocase">Statistical Theory of the Energy Levels of Complex Systems. IV</span></a></em>, Journal of Mathematical Physics <strong>4</strong>, 701 (2004).</div>
</div>
<div id="ref-10.1063/1.1704009" class="csl-entry" role="listitem">
<div class="csl-left-margin">[5] </div><div class="csl-right-inline">M. L. Mehta and F. J. Dyson, <em><a href="https://doi.org/10.1063/1.1704009"><span class="nocase">Statistical Theory of the Energy Levels of Complex Systems. V</span></a></em>, Journal of Mathematical Physics <strong>4</strong>, 713 (2004).</div>
</div>
<div id="ref-mehta1991random" class="csl-entry" role="listitem">
<div class="csl-left-margin">[6] </div><div class="csl-right-inline">M. L. Mehta, <em>Random Matrices</em> (Academic Press, 1991).</div>
</div>
<div id="ref-RevModPhys.53.385" class="csl-entry" role="listitem">
<div class="csl-left-margin">[7] </div><div class="csl-right-inline">T. A. Brody, J. Flores, J. B. French, P. A. Mello, A. Pandey, and S. S. M. Wong, <em><a href="https://doi.org/10.1103/RevModPhys.53.385">Random-Matrix Physics: Spectrum and Strength Fluctuations</a></em>, Rev. Mod. Phys. <strong>53</strong>, 385 (1981).</div>
</div>
<div id="ref-PhysRevLett.83.1467" class="csl-entry" role="listitem">
<div class="csl-left-margin">[8] </div><div class="csl-right-inline">L. Laloux, P. Cizeau, J.-P. Bouchaud, and M. Potters, <em><a href="https://doi.org/10.1103/PhysRevLett.83.1467">Noise Dressing of Financial Correlation Matrices</a></em>, Phys. Rev. Lett. <strong>83</strong>, 1467 (1999).</div>
</div>
<div id="ref-Muirhead" class="csl-entry" role="listitem">
<div class="csl-left-margin">[9] </div><div class="csl-right-inline"><em><a href="https://doi.org/10.1002/9780470316559">Aspects of Multivariate Statistical Theory</a></em> (Wiley, New York, 1982).</div>
</div>
<div id="ref-dyson1971distribution" class="csl-entry" role="listitem">
<div class="csl-left-margin">[10] </div><div class="csl-right-inline">F. J. Dyson, <em>Distribution of Eigenvalues for a Class of Real Symmetric Matrices</em>, Revista Mexicana de Fisica <strong>20</strong>, 231 (1971).</div>
</div>
<div id="ref-PhysRevE.60.3389" class="csl-entry" role="listitem">
<div class="csl-left-margin">[11] </div><div class="csl-right-inline">A. M. Sengupta and P. P. Mitra, <em><a href="https://doi.org/10.1103/PhysRevE.60.3389">Distributions of Singular Values for Some Random Matrices</a></em>, Phys. Rev. E <strong>60</strong>, 3389 (1999).</div>
</div>
<div id="ref-PhysRevLett.83.1471" class="csl-entry" role="listitem">
<div class="csl-left-margin">[12] </div><div class="csl-right-inline">V. Plerou, P. Gopikrishnan, B. Rosenow, L. A. Nunes Amaral, and H. E. Stanley, <em><a href="https://doi.org/10.1103/PhysRevLett.83.1471">Universal and Nonuniversal Properties of Cross Correlations in Financial Time Series</a></em>, Phys. Rev. Lett. <strong>83</strong>, 1471 (1999).</div>
</div>
<div id="ref-GUHR1998189" class="csl-entry" role="listitem">
<div class="csl-left-margin">[13] </div><div class="csl-right-inline">T. Guhr, A. Müller–Groeling, and H. A. Weidenmüller, <em><a href="https://doi.org/10.1016/S0370-1573(97)00088-4">Random-Matrix Theories in Quantum Physics: Common Concepts</a></em>, Physics Reports <strong>299</strong>, 189 (1998).</div>
</div>
<div id="ref-PhysRevLett.69.1093" class="csl-entry" role="listitem">
<div class="csl-left-margin">[14] </div><div class="csl-right-inline">Y. V. Fyodorov and A. D. Mirlin, <em><a href="https://doi.org/10.1103/PhysRevLett.69.1093">Analytical Derivation of the Scaling Law for the Inverse Participation Ratio in Quasi-One-Dimensional Disordered Systems</a></em>, Phys. Rev. Lett. <strong>69</strong>, 1093 (1992).</div>
</div>
</div>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  let localAlternateSentinel = 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Скопійовано!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Скопійовано!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation column-body">
  <div class="nav-page nav-page-previous">
      <a href="./lab_7.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Лабораторна робота № 7</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./lab_9.html" class="pagination-link">
        <span class="nav-page-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Лабораторна робота № 9</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->



</body></html>