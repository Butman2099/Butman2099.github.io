<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.433">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Моделювання складних систем у Python - 12&nbsp; Лабораторна робота № 12</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./lab_13.html" rel="next">
<link href="./lab_11.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="site_libs/bootstrap/bootstrap-dark.min.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "Пошук не дав результату",
    "search-matching-documents-text": "Результати пошуку",
    "search-copy-link-title": "Скопіюйте посилання для пошуку",
    "search-hide-matches-text": "Приховати додаткові результати",
    "search-more-match-text": "Додатковий результат у цьому документі",
    "search-more-matches-text": "Додаткові результати у цьому документі",
    "search-clear-button-title": "Очистити",
    "search-detached-cancel-button-title": "Скасувати",
    "search-submit-button-title": "Надіслати",
    "search-label": "Search"
  }
}</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script>
<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>
<script src="https://unpkg.com/@jupyter-widgets/html-manager@*/dist/embed-amd.js" crossorigin="anonymous"></script>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<link rel="stylesheet" href="style.css">
</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
      <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./lab_12.html"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Лабораторна робота № 12</span></a></li></ol></nav>
      <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
      </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-full">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Моделювання складних систем у Python</a> 
        <div class="sidebar-tools-main tools-wide">
    <a href="https://github.com/Butman2099/Complex-systems-book" rel="" title="Source Code" class="quarto-navigation-tool px-1" aria-label="Source Code"><i class="bi bi-github"></i></a>
    <a href="./Моделювання-складних-систем-у-Python.docx" rel="" title="Download Docx" class="quarto-navigation-tool px-1" aria-label="Download Docx"><i class="bi bi-file-word"></i></a>
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Передмова</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./lab_1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Лабораторна робота № 1</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./lab_2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Лабораторна робота № 2</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./lab_3.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Лабораторна робота № 3</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./lab_4.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Лабораторна робота № 4</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./lab_5.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Лабораторна робота № 5</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./lab_6.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Лабораторна робота № 6</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./lab_7.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Лабораторна робота № 7</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./lab_8.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Лабораторна робота № 8</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./lab_9.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Лабораторна робота № 9</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./lab_10.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Лабораторна робота № 10</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./lab_11.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Лабораторна робота № 11</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./lab_12.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Лабораторна робота № 12</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./lab_13.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Лабораторна робота № 13</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./lab_14.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Лабораторна робота № 14</span></span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
 <span class="menu-text">Додатки</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./appa.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">A</span>&nbsp; <span class="chapter-title">Інструкція зі встановлення Anaconda Navigator</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./appb.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">B</span>&nbsp; <span class="chapter-title">Вступ до мови програмування Python</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./appc.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">C</span>&nbsp; <span class="chapter-title">Основи Jupyter Notebook</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">D</span>&nbsp; <span class="chapter-title">Список рекомендованої літератури</span></span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Зміст</h2>
   
  <ul>
  <li><a href="#теоретичні-відомості" id="toc-теоретичні-відомості" class="nav-link active" data-scroll-target="#теоретичні-відомості"><span class="header-section-number">12.1</span> Теоретичні відомості</a>
  <ul class="collapse">
  <li><a href="#імпортуємо-необхідні-бібліотеки" id="toc-імпортуємо-необхідні-бібліотеки" class="nav-link" data-scroll-target="#імпортуємо-необхідні-бібліотеки"><span class="header-section-number">12.1.1</span> Імпортуємо необхідні бібліотеки</a></li>
  <li><a href="#виконуємо-налаштування-рисунків" id="toc-виконуємо-налаштування-рисунків" class="nav-link" data-scroll-target="#виконуємо-налаштування-рисунків"><span class="header-section-number">12.1.2</span> Виконуємо налаштування рисунків</a></li>
  <li><a href="#зчитування-даних" id="toc-зчитування-даних" class="nav-link" data-scroll-target="#зчитування-даних"><span class="header-section-number">12.1.3</span> Зчитування даних</a></li>
  <li><a href="#важкі-хвости-та-чорні-понеділки" id="toc-важкі-хвости-та-чорні-понеділки" class="nav-link" data-scroll-target="#важкі-хвости-та-чорні-понеділки"><span class="header-section-number">12.1.4</span> Важкі хвости та Чорні понеділки</a></li>
  <li><a href="#відхилення-в-23-сигма" id="toc-відхилення-в-23-сигма" class="nav-link" data-scroll-target="#відхилення-в-23-сигма"><span class="header-section-number">12.1.5</span> Відхилення в 23 сигма</a></li>
  <li><a href="#статистика-степеневого-розподілу" id="toc-статистика-степеневого-розподілу" class="nav-link" data-scroll-target="#статистика-степеневого-розподілу"><span class="header-section-number">12.1.6</span> Статистика степеневого розподілу</a></li>
  <li><a href="#статистичні-моменти-під-впливом-важких-хвостів" id="toc-статистичні-моменти-під-впливом-важких-хвостів" class="nav-link" data-scroll-target="#статистичні-моменти-під-впливом-важких-хвостів"><span class="header-section-number">12.1.7</span> Статистичні моменти під впливом важких хвостів</a></li>
  <li><a href="#як-ексцес-дестабілізує-розрахунки-волатильності" id="toc-як-ексцес-дестабілізує-розрахунки-волатильності" class="nav-link" data-scroll-target="#як-ексцес-дестабілізує-розрахунки-волатильності"><span class="header-section-number">12.1.8</span> Як ексцес дестабілізує розрахунки волатильності</a></li>
  <li><a href="#наслідки-для-моделювання-та-прогнозування" id="toc-наслідки-для-моделювання-та-прогнозування" class="nav-link" data-scroll-target="#наслідки-для-моделювання-та-прогнозування"><span class="header-section-number">12.1.9</span> Наслідки для моделювання та прогнозування</a></li>
  <li><a href="#марковіц-і-стабільність-волатильності" id="toc-марковіц-і-стабільність-волатильності" class="nav-link" data-scroll-target="#марковіц-і-стабільність-волатильності"><span class="header-section-number">12.1.10</span> Марковіц і стабільність волатильності</a></li>
  <li><a href="#розподіл-леві" id="toc-розподіл-леві" class="nav-link" data-scroll-target="#розподіл-леві"><span class="header-section-number">12.1.11</span> Розподіл Леві</a></li>
  </ul></li>
  <li><a href="#хід-роботи" id="toc-хід-роботи" class="nav-link" data-scroll-target="#хід-роботи"><span class="header-section-number">12.2</span> Хід роботи</a>
  <ul class="collapse">
  <li><a href="#побудова-розподілу-леві-та-розрахунок-параметрів-для-всього-ряду" id="toc-побудова-розподілу-леві-та-розрахунок-параметрів-для-всього-ряду" class="nav-link" data-scroll-target="#побудова-розподілу-леві-та-розрахунок-параметрів-для-всього-ряду"><span class="header-section-number">12.2.1</span> Побудова розподілу Леві та розрахунок параметрів для всього ряду</a></li>
  <li><a href="#дослідження-поведінки-альфа-стабільного-розподілу-леві" id="toc-дослідження-поведінки-альфа-стабільного-розподілу-леві" class="nav-link" data-scroll-target="#дослідження-поведінки-альфа-стабільного-розподілу-леві"><span class="header-section-number">12.2.2</span> Дослідження поведінки альфа-стабільного розподілу Леві</a></li>
  <li><a href="#віконна-процедура" id="toc-віконна-процедура" class="nav-link" data-scroll-target="#віконна-процедура"><span class="header-section-number">12.2.3</span> Віконна процедура</a></li>
  <li><a href="#динаміка-показника-стабільності-alpha" id="toc-динаміка-показника-стабільності-alpha" class="nav-link" data-scroll-target="#динаміка-показника-стабільності-alpha"><span class="header-section-number">12.2.4</span> Динаміка показника стабільності <span class="math inline">\(\alpha\)</span></a></li>
  <li><a href="#динаміка-показника-асиметрії-beta" id="toc-динаміка-показника-асиметрії-beta" class="nav-link" data-scroll-target="#динаміка-показника-асиметрії-beta"><span class="header-section-number">12.2.5</span> Динаміка показника асиметрії <span class="math inline">\(\beta\)</span></a></li>
  <li><a href="#динаміка-параметра-зміщення-mu" id="toc-динаміка-параметра-зміщення-mu" class="nav-link" data-scroll-target="#динаміка-параметра-зміщення-mu"><span class="header-section-number">12.2.6</span> Динаміка параметра зміщення <span class="math inline">\(\mu\)</span></a></li>
  <li><a href="#динаміка-параметра-масштабу-sigma" id="toc-динаміка-параметра-масштабу-sigma" class="nav-link" data-scroll-target="#динаміка-параметра-масштабу-sigma"><span class="header-section-number">12.2.7</span> Динаміка параметра масштабу <span class="math inline">\(\sigma\)</span></a></li>
  </ul></li>
  <li><a href="#висновок" id="toc-висновок" class="nav-link" data-scroll-target="#висновок"><span class="header-section-number">12.3</span> Висновок</a></li>
  <li><a href="#завдання-для-самостійної-роботи" id="toc-завдання-для-самостійної-роботи" class="nav-link" data-scroll-target="#завдання-для-самостійної-роботи"><span class="header-section-number">12.4</span> Завдання для самостійної роботи</a></li>
  </ul>
<div class="toc-actions"><div><i class="bi bi-github"></i></div><div class="action-links"><p><a href="https://github.dev/Butman2099/Complex-systems-book/blob/main/lab_12.ipynb" class="toc-action">Редагувати сторінку</a></p></div></div></nav>
    </div>
<!-- main -->
<main class="content column-body" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Лабораторна робота № 12</span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<p><strong>Тема.</strong> Важкі хвости: вплив одиничних катастрофічних подій. Аналіз кризових подій із використанням Леві альфа-стабільного розподілу</p>
<p><strong>Мета.</strong> Навчитися використовувати розподіл Леві для диференціації флуктуацій, що виходять за межі нормального розподілу</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Анотація
</div>
</div>
<div class="callout-body-container callout-body">
<p>У цій лабораторній ми досліджуємо розподіл прибутковості фінансових активів і стабільність певних показників, які ми розраховуємо, опираючись на ці активи. Зокрема, ми побачимо, що більш високі моменти розподілу прибутковостей з важкими хвостами насправді дуже нестабільні, нескінченні або взагалі не визначені, і що, наприклад, одна єдина точка даних визначає більшу частину надлишкового ексцесу. Цей факт має досить драматичні наслідки, оскільки популярні моделі, такі як GARCH, базуються на можливості оцінки кінцевого значення ексцесу. Суть, яку ми хочемо донести, полягає в тому, що, не приділяючи особливої уваги повноті фінансових розподілів, не можна очікувати, що моделі будуть працювати за межами навчальної та тестувальної вибірки. Аналітики та трейдери завжди будуть дивуватись новим екстремальним подіям, що, як правило, рідко бувають позитивними</p>
</div>
</div>
<section id="теоретичні-відомості" class="level2" data-number="12.1">
<h2 data-number="12.1" class="anchored" data-anchor-id="теоретичні-відомості"><span class="header-section-number">12.1</span> Теоретичні відомості</h2>
<section id="імпортуємо-необхідні-бібліотеки" class="level3" data-number="12.1.1">
<h3 data-number="12.1.1" class="anchored" data-anchor-id="імпортуємо-необхідні-бібліотеки"><span class="header-section-number">12.1.1</span> Імпортуємо необхідні бібліотеки</h3>
<div class="callout callout-style-default callout-important callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Увага
</div>
</div>
<div class="callout-body-container callout-body">
<p>Перш за все, для подальшої роботи, нам необхідно буде встановити бібліотеку <code>pylevy</code>. Встановити її можна з відповідного <a href="https://github.com/josemiotto/pylevy/tree/master">GitHub репозиторію</a>. Ми у свою чергу завантажимо її напряму через команду <code>pip install</code> слідуючим чином:</p>
</div>
</div>
<div class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="op">!</span>pip install git<span class="op">+</span>https:<span class="op">//</span>github.com<span class="op">/</span>josemiotto<span class="op">/</span>pylevy.git</span></code><button title="Копіювати" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Після встановлення необхідного модулю можна приступати до подальшої роботи.</p>
<div class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np                 <span class="co"># бібліотека для роботи з масивами чисел</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt    <span class="co"># бібліотека для побудови графіків</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> yfinance <span class="im">as</span> yf              <span class="co"># бібліотека для зчитування фінансових даних з Yahoo Finance</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> levy                        <span class="co"># бібліотека для роботи з альфа-стабільним розподілом Леві</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd                <span class="co"># бібліотека для фільтрації даних та їх обробки</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> scienceplots</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> scipy.stats <span class="im">import</span> norm, laplace  <span class="co"># бібліотека для побудови теоретичного розподілу Гауса</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>                                       <span class="co"># та Лапласа</span></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> tqdm <span class="im">import</span> tqdm                  <span class="co"># бібліотека для виводу шкали завантаження</span></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a><span class="op">%</span>matplotlib inline</span></code><button title="Копіювати" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="виконуємо-налаштування-рисунків" class="level3" data-number="12.1.2">
<h3 data-number="12.1.2" class="anchored" data-anchor-id="виконуємо-налаштування-рисунків"><span class="header-section-number">12.1.2</span> Виконуємо налаштування рисунків</h3>
<div class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>plt.style.use([<span class="st">'science'</span>, <span class="st">'notebook'</span>, <span class="st">'grid'</span>]) <span class="co"># стиль, що використовуватиметься</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>                                               <span class="co"># для виведення рисунків</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>params <span class="op">=</span> {</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">'figure.figsize'</span>: (<span class="dv">8</span>, <span class="dv">6</span>),         <span class="co"># встановлюємо ширину та висоту рисунків за замовчуванням</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">'font.size'</span>: <span class="dv">14</span>,                  <span class="co"># розмір фонтів рисунку</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">'lines.linewidth'</span>: <span class="dv">2</span>,             <span class="co"># товщина ліній</span></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>    <span class="st">'axes.titlesize'</span>: <span class="st">'small'</span>,        <span class="co"># розмір титулки над рисунком</span></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>    <span class="st">"font.family"</span>: <span class="st">"sans-serif"</span>,      <span class="co"># сімейство стилів підписів </span></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>    <span class="st">"font.serif"</span>: [<span class="st">"Times"</span>],          <span class="co"># стиль підпису</span></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>    <span class="st">'savefig.dpi'</span>: <span class="dv">300</span>                <span class="co"># якість збережених зображень</span></span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>plt.rcParams.update(params)           <span class="co"># оновлення стилю згідно налаштувань</span></span></code><button title="Копіювати" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="зчитування-даних" class="level3" data-number="12.1.3">
<h3 data-number="12.1.3" class="anchored" data-anchor-id="зчитування-даних"><span class="header-section-number">12.1.3</span> Зчитування даних</h3>
<div class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.read_csv(<span class="st">'databases\^spx_d.csv'</span>)</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>df.set_index(<span class="st">'Date'</span>, inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>df.index <span class="op">=</span> pd.to_datetime(df.index)</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> df[df.index <span class="op">&gt;=</span> <span class="st">'1950-01-01'</span>]</span></code><button title="Копіювати" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="важкі-хвости-та-чорні-понеділки" class="level3" data-number="12.1.4">
<h3 data-number="12.1.4" class="anchored" data-anchor-id="важкі-хвости-та-чорні-понеділки"><span class="header-section-number">12.1.4</span> Важкі хвости та Чорні понеділки</h3>
<p>Спочатку ми розглянемо розподіл щоденних прибутковостей індексу S&amp;P 500, починаючи з 1950 року. У клітинці нижче буде показано <a href="https://pandas.pydata.org/docs/user_guide/10min.html">Pandas dataframe</a> <code>df</code>, що містить дані OHLC з файлу (ці дані були попередньо завантажені в клітинці вище).</p>
<div class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>df</span></code><button title="Копіювати" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="5">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Open</th>
<th data-quarto-table-cell-role="th">High</th>
<th data-quarto-table-cell-role="th">Low</th>
<th data-quarto-table-cell-role="th">Close</th>
<th data-quarto-table-cell-role="th">Volume</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">Date</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">1950-01-03</td>
<td>16.66</td>
<td>16.66</td>
<td>16.66</td>
<td>16.66</td>
<td>7.000000e+05</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1950-01-04</td>
<td>16.85</td>
<td>16.85</td>
<td>16.85</td>
<td>16.85</td>
<td>1.050000e+06</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">1950-01-05</td>
<td>16.93</td>
<td>16.93</td>
<td>16.93</td>
<td>16.93</td>
<td>1.416667e+06</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1950-01-06</td>
<td>16.98</td>
<td>16.98</td>
<td>16.98</td>
<td>16.98</td>
<td>1.116667e+06</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">1950-01-07</td>
<td>17.09</td>
<td>17.09</td>
<td>17.09</td>
<td>17.09</td>
<td>1.116667e+06</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2023-04-10</td>
<td>4085.20</td>
<td>4109.50</td>
<td>4072.55</td>
<td>4109.11</td>
<td>1.951642e+09</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2023-04-11</td>
<td>4110.29</td>
<td>4124.26</td>
<td>4102.61</td>
<td>4108.94</td>
<td>2.000949e+09</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2023-04-12</td>
<td>4121.72</td>
<td>4134.37</td>
<td>4086.94</td>
<td>4091.95</td>
<td>2.249009e+09</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2023-04-13</td>
<td>4100.04</td>
<td>4150.26</td>
<td>4099.40</td>
<td>4146.22</td>
<td>2.198579e+09</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2023-04-14</td>
<td>4140.11</td>
<td>4163.19</td>
<td>4113.20</td>
<td>4137.64</td>
<td>2.088609e+09</td>
</tr>
</tbody>
</table>

<p>18527 rows × 5 columns</p>
</div>
</div>
</div>
<p>Цей історичний ряд щоденних цін містить ~ 18527 торгових днів. Замість того, щоб дивитися безпосередньо на ціни, ми розглянемо щоденні <a href="https://lucaslouca.com/Why-Use-Logarithmic-Returns-In-Time-Series-Modelling/"><em>log</em>-прибутковості</a> індексу S&amp;P 500. Пам’ятайте, що логарифмічна прибутковість <span class="math inline">\(r_t\)</span> визначається як логарифм відношення між цінами закриття <span class="math inline">\(p_t\)</span> у теперішній момент часу та попередній, <span class="math inline">\(p_{t-1}\)</span>:</p>
<p><span class="math display">\[
r_t = \log p_t - \log p_{t-1}.
\]</span></p>
<p>Логарифмічні прибутковості характеризуються симетрією, тобто якщо в один день індекс втрачає <span class="math inline">\(r_t = -0.1\)</span>, а на наступний день індекс набирає <span class="math inline">\(r_{t+1} = +0.1\)</span>, індекс знову досягає початкової ціни. Зі звичайними прибутковостями, спочатку втративши <span class="math inline">\(10\%\)</span>, а потім знову набравши <span class="math inline">\(10\%\)</span>, ви не повернетесь до початкової ціни. Ми зберігаємо прибутковості в новому фреймі даних <code>lr</code>:</p>
<div class="cell" data-execution_count="8">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>lr <span class="op">=</span> np.log(df[<span class="st">'Close'</span>]).diff().dropna()</span></code><button title="Копіювати" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="9">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>lr.plot()</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>plt.show()<span class="op">;</span></span></code><button title="Копіювати" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="lab_12_files/figure-html/cell-8-output-1.png" class="img-fluid"></p>
</div>
</div>
<p>Використовуючи вбудовані функції Pandas та Numpy, тепер ми можемо подивитись на найгірше щоденнє значення прибутковостей. Ми виявляємо, що найгірше значення становило <span class="math inline">\(-0.229\)</span>, що відповідає <span class="math inline">\(-22.9\%\)</span>, і що це сталося в понеділок, 19 жовтня 1987 року — так званий <a href="https://en.wikipedia.org/wiki/Black_Monday_(1987)"><em>Чорний понеділок</em></a>.</p>
<div class="cell" data-execution_count="10">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># найгірший щоденні прибутковості від закриття до закриття</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>lr.<span class="bu">min</span>()</span></code><button title="Копіювати" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="10">
<pre><code>-0.2289972265656708</code></pre>
</div>
</div>
<div class="cell" data-execution_count="11">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co"># відповідні арифметичні прибутковості</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>np.exp(lr.<span class="bu">min</span>()) <span class="op">-</span> <span class="dv">1</span></span></code><button title="Копіювати" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="11">
<pre><code>-0.20466926070038938</code></pre>
</div>
</div>
<div class="cell" data-execution_count="12">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co"># індекс найгіршого значення</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>np.argmin(lr)</span></code><button title="Копіювати" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="12">
<pre><code>9583</code></pre>
</div>
</div>
<div class="cell" data-execution_count="13">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>df.iloc[<span class="dv">9583</span>:<span class="dv">9585</span>]</span></code><button title="Копіювати" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="13">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Open</th>
<th data-quarto-table-cell-role="th">High</th>
<th data-quarto-table-cell-role="th">Low</th>
<th data-quarto-table-cell-role="th">Close</th>
<th data-quarto-table-cell-role="th">Volume</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">Date</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">1987-10-16</td>
<td>298.08</td>
<td>298.92</td>
<td>281.52</td>
<td>282.70</td>
<td>188055556.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1987-10-19</td>
<td>282.70</td>
<td>282.70</td>
<td>224.83</td>
<td>224.84</td>
<td>335722222.0</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>Далі ми будуємо графік вибіркового розподілу щоденних логарифмічних прибутковостей, що демонструє нам, як часто ми спостерігаємо щоденні прибутковості певного знака та величини. Зверніть увагу, що ми встановили логарифмічне масштабування для вісі Оy, щоб мати краще представлення про хвости розподілу, тобто дуже великі, але рідкісні негативні та позитивні прибутковості — крахи та підйоми:</p>
<div class="cell" data-execution_count="14">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>plt.figure()</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>plt.hist(lr, <span class="dv">100</span>, density<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>plt.yscale(<span class="st">'log'</span>)</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Розп. ймовірностей'</span>)</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Щоденні лог-прибутковості'</span>)</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>plt.xlim([<span class="op">-</span><span class="fl">0.25</span>, <span class="fl">0.125</span>])</span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>plt.ylim([<span class="fl">0.011</span>, <span class="dv">99</span>])</span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>plt.annotate(<span class="st">'Чорний понеділок (1987)'</span>, [<span class="op">-</span><span class="fl">0.226</span>, <span class="fl">0.02</span>], xytext<span class="op">=</span>[<span class="op">-</span><span class="fl">0.215</span>, <span class="fl">0.15</span>],</span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>             arrowprops<span class="op">=</span><span class="bu">dict</span>(facecolor<span class="op">=</span><span class="st">'0.4'</span>, width<span class="op">=</span><span class="dv">1</span>, headwidth<span class="op">=</span><span class="dv">6</span>, headlength<span class="op">=</span><span class="dv">6</span>),</span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>             ha<span class="op">=</span><span class="st">'left'</span>, va<span class="op">=</span><span class="st">'bottom'</span>)<span class="op">;</span></span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a>plt.show()<span class="op">;</span></span></code><button title="Копіювати" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="lab_12_files/figure-html/cell-13-output-1.png" class="img-fluid"></p>
</div>
</div>
<p>Як ми можемо описати погіршення розподілу прибутковості? За допомогою <a href="https://en.wikipedia.org/wiki/Logarithmic_scale">логарифмічного масштабування</a> осі Oy, щоб експоненціальний спад виглядав лінійно, тому ми могли би запідозрити, що при малих абсолютних значеннях прибутковості розподіл зменшується експоненціально, але в міру збільшення абсолютних значень прибутковостей ми все більше і більше відхиляємося від початкового нахилу. Насправді, ми можемо показати, що ні розповсюдженний <a href="https://en.wikipedia.org/wiki/Normal_distribution">розподіл Гауса</a> (також званий <em>нормальним</em> розподілом), ні <a href="https://en.wikipedia.org/wiki/Laplace_distribution">розподіл Лапласа</a> з його експоненціальним спадом з обох сторін точно не можуть змоделювати розподіл прибутковостей S&amp;P 500. Як розподіл Гауса, так і розподіл Лапласа недооцінюють ймовірність екстремальних подій — підйомів та крахів:</p>
<div class="cell" data-execution_count="15">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co"># підганяємо розподіл Гауса та Лапласа під дані</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>norm_loc, norm_scale <span class="op">=</span> norm.fit(lr)</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>laplace_loc, laplace_scale <span class="op">=</span> laplace.fit(lr)</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a><span class="co"># генеруємо значення (x,y) з використанням отриманих параметрів розподілів</span></span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>x_fit <span class="op">=</span> np.linspace(<span class="op">-</span><span class="fl">0.25</span>, <span class="fl">0.125</span>, <span class="dv">1000</span>)</span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>y_fit_norm <span class="op">=</span> norm(loc<span class="op">=</span>norm_loc, scale<span class="op">=</span>norm_scale).pdf(x_fit)</span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>y_fit_laplace <span class="op">=</span> laplace(loc<span class="op">=</span>laplace_loc, scale<span class="op">=</span>laplace_scale).pdf(x_fit)</span></code><button title="Копіювати" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="16">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>plt.figure()</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>plt.hist(lr, <span class="dv">100</span>, density<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>plt.plot(x_fit, y_fit_laplace, lw<span class="op">=</span><span class="dv">3</span>, c<span class="op">=</span><span class="st">'C3'</span>, alpha<span class="op">=</span><span class="fl">0.8</span>, label<span class="op">=</span><span class="st">'Розподіл Лапласа'</span>)</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>plt.plot(x_fit, y_fit_norm, lw<span class="op">=</span><span class="dv">3</span>, c<span class="op">=</span><span class="st">'0.2'</span>, alpha<span class="op">=</span><span class="fl">0.8</span>, label<span class="op">=</span><span class="st">'Розподіл Гауса'</span>)</span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>plt.yscale(<span class="st">'log'</span>)</span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Розп. ймовірностей'</span>)</span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Щоденні лог-прибутковості'</span>)</span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>plt.xlim([<span class="op">-</span><span class="fl">0.25</span>, <span class="fl">0.125</span>])</span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a>plt.ylim([<span class="fl">0.011</span>, <span class="dv">99</span>])</span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a>plt.legend()</span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a>plt.annotate(<span class="st">'Чорний понеділок (1987)'</span>, [<span class="op">-</span><span class="fl">0.226</span>, <span class="fl">0.02</span>], xytext<span class="op">=</span>[<span class="op">-</span><span class="fl">0.215</span>, <span class="fl">0.15</span>],</span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a>             arrowprops<span class="op">=</span><span class="bu">dict</span>(facecolor<span class="op">=</span><span class="st">'0.4'</span>, width<span class="op">=</span><span class="dv">1</span>, headwidth<span class="op">=</span><span class="dv">6</span>, headlength<span class="op">=</span><span class="dv">6</span>),</span>
<span id="cb17-14"><a href="#cb17-14" aria-hidden="true" tabindex="-1"></a>             ha<span class="op">=</span><span class="st">'left'</span>, va<span class="op">=</span><span class="st">'bottom'</span>)<span class="op">;</span></span>
<span id="cb17-15"><a href="#cb17-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-16"><a href="#cb17-16" aria-hidden="true" tabindex="-1"></a>plt.show()<span class="op">;</span></span></code><button title="Копіювати" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="lab_12_files/figure-html/cell-15-output-1.png" class="img-fluid"></p>
</div>
</div>
</section>
<section id="відхилення-в-23-сигма" class="level3" data-number="12.1.5">
<h3 data-number="12.1.5" class="anchored" data-anchor-id="відхилення-в-23-сигма"><span class="header-section-number">12.1.5</span> Відхилення в 23 сигма</h3>
<p>Як ми можемо бачити вище, як розподіл Гауса, так і розподіл Лапласа різко недооцінюють ймовірність дуже волатильної динаміки! Часто зазначають, що трапилась “<a href="https://en.wikipedia.org/wiki/68%E2%80%9395%E2%80%9399.7_rule">3-сигма</a> подія на ринку” або щось подібне, тому що багатьом людям подобається оцінювати індивідуальні прибутковості по <a href="https://en.wikipedia.org/wiki/Standard_deviation">стандартному відхиленню</a> (зване “сигмою”) підібраного гаусового розподілу. Однак, якщо Розподіл Гауса взагалі не відповідає розподілу вибірки, як у нашому випадку, оцінка краху в одиницях “сигма” може ввести в оману! Щоб показати це, ми спочатку перевіримо, на скільки сигм ринок змістився в Чорний понеділок 1987 року:</p>
<div class="cell" data-execution_count="17">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>np.<span class="bu">abs</span>(np.<span class="bu">min</span>(lr))<span class="op">/</span>np.std(lr, ddof<span class="op">=</span><span class="dv">1</span>)</span></code><button title="Копіювати" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="17">
<pre><code>22.969393251617504</code></pre>
</div>
</div>
<p>Виходячи з розподілу по Гауса, Чорний понеділок був би подією з “23 сигмами”! Тепер Розподіл Гауса чітко говорить нам, як часто X-сигма подія має відбуватися:</p>
<ul>
<li>1-сигма: прибл. 1 з 3 днів</li>
<li>2-сигма: прибл. 1 з 22 днів</li>
<li>3-сигма: прибл. 1 з 370 днів</li>
</ul>
<p>…</p>
<p>Ми можемо розширити цю таблицю, попрацювавши з <a href="https://en.wikipedia.org/wiki/Cumulative_distribution_function">функцією кумулятивного розподілу</a>, тісно пов’язана з <a href="https://en.wikipedia.org/wiki/Survival_function">функцією виживання</a>, і перемістивши обчислення в логарифмічний простір для чисельної стабільності, як демонструють наступні комірки коду:</p>
<div class="cell" data-execution_count="18">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co"># у середньому, як багато днів між 1-сигма подіями?</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span><span class="op">/</span>(<span class="dv">2</span><span class="op">*</span>(<span class="fl">1.</span> <span class="op">-</span> norm.cdf(<span class="fl">1.</span>)))</span></code><button title="Копіювати" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="18">
<pre><code>3.1514871875343764</code></pre>
</div>
</div>
<div class="cell" data-execution_count="19">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co"># у середньому, як багато днів між 2-сигма подіями?</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span><span class="op">/</span>(<span class="dv">2</span><span class="op">*</span>(<span class="fl">1.</span> <span class="op">-</span> norm.cdf(<span class="fl">2.</span>)))</span></code><button title="Копіювати" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="19">
<pre><code>21.97789450799283</code></pre>
</div>
</div>
<div class="cell" data-execution_count="20">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="co"># у середньому, як багато днів між 3-сигма подіями?</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span><span class="op">/</span>(<span class="dv">2</span><span class="op">*</span>(<span class="fl">1.</span> <span class="op">-</span> norm.cdf(<span class="fl">3.</span>)))</span></code><button title="Копіювати" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="20">
<pre><code>370.3983473449564</code></pre>
</div>
</div>
<div class="cell" data-execution_count="21">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="co"># те саме, що й вище, але із використанням функції виживання</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span><span class="op">/</span>(<span class="dv">2</span><span class="op">*</span>norm.sf(<span class="fl">3.</span>))</span></code><button title="Копіювати" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="21">
<pre><code>370.3983473449592</code></pre>
</div>
</div>
<div class="cell" data-execution_count="22">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="co"># те саме, що й вище, але із використанням логарифмічної функції функції виживання для чисельної стабільності</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>np.exp(<span class="op">-</span>norm.logsf(<span class="fl">3.</span>) <span class="op">-</span> np.log(<span class="fl">2.</span>))</span></code><button title="Копіювати" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="22">
<pre><code>370.398347344959</code></pre>
</div>
</div>
<div class="cell" data-execution_count="23">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="co"># те саме, що й вище, але із використанням логарифму з основою 10 для замість натурального логарифму для кращої інтерпретації</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a><span class="dv">10</span><span class="op">**</span>(<span class="op">-</span>norm.logsf(<span class="fl">3.</span>)<span class="op">/</span>np.log(<span class="dv">10</span>) <span class="op">-</span> np.log10(<span class="fl">2.</span>))</span></code><button title="Копіювати" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="23">
<pre><code>370.3983473449588</code></pre>
</div>
</div>
<div class="cell" data-execution_count="24">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="co"># як багато днів (log10 значення) між 23-сигма подіями, в середньому?</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>(<span class="op">-</span>norm.logsf(<span class="fl">23.</span>)<span class="op">/</span>np.log(<span class="dv">10</span>) <span class="op">-</span> np.log10(<span class="fl">2.</span>))</span></code><button title="Копіювати" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="24">
<pre><code>116.33149536636726</code></pre>
</div>
</div>
<p>Щоб отримати додаткову інформацію про частоту екстремальних прибутковостей, ми можемо навіть створити невеликий <a href="https://ipywidgets.readthedocs.io/en/latest/examples/Widget%20Basics.html">інтерактивний віджет</a> за допомогою повзунка, який вказує кількість “сигм”, а текст поруч із ним показує середню кількість днів між двома такими екстремальними подіями:</p>
<div class="cell" data-execution_count="25">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> ipywidgets <span class="im">import</span> IntSlider, interact</span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> years_between(X):</span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a>    log10_days <span class="op">=</span> (<span class="op">-</span>norm.logsf(X)<span class="op">/</span>np.log(<span class="dv">10</span>) <span class="op">-</span> np.log10(<span class="fl">2.</span>))</span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a>    days <span class="op">=</span> <span class="bu">int</span>(<span class="dv">10</span><span class="op">**</span>log10_days)</span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="ss">f'У сереньому, між двома X-сигма подіями, варто очікувати </span><span class="sc">{</span>days<span class="sc">}</span><span class="ss"> дні(в), (день).'</span></span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-8"><a href="#cb34-8" aria-hidden="true" tabindex="-1"></a>interact(years_between, X<span class="op">=</span>IntSlider(<span class="bu">min</span><span class="op">=</span><span class="dv">1</span>, <span class="bu">max</span><span class="op">=</span><span class="dv">23</span>, step<span class="op">=</span><span class="dv">1</span>, value<span class="op">=</span><span class="dv">1</span>))<span class="op">;</span></span></code><button title="Копіювати" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"7233a4946d9246bcab5478557767d7e0","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
</div>
<div class="cell" data-execution_count="26">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>np.log10(<span class="bu">float</span>(<span class="dv">214533622638557983431869220329015643677794364342592664885632499326649056583365324378194575664549945880382591666749440</span>))</span></code><button title="Копіювати" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="26">
<pre><code>116.33149536636726</code></pre>
</div>
</div>
<p>Ви бачите, що при переміщенні повзунка вправо кількість днів або років між двома наступними “X-сигма” подіями швидко наростає. Наша таблиця тепер виглядає наступним чином:</p>
<ul>
<li>1-сигма: прибл. 1 з 3 днів</li>
<li>2-сигма: прибл. 1 з 22 днів</li>
<li>3-сигма: прибл. 1 з 370 днів</li>
</ul>
<p>…</p>
<ul>
<li>23-сигма: приблизно 1 з <span class="math inline">\(10^{116}\)</span> днів (!!!)</li>
</ul>
<p>Внесемо ясність: виходячи з розподілу Гауса, щоденні втрати Чорної п’ятниці 1987 року повинні бути подією, яку ми очікуємо раз на <span class="math inline">\(10^{116}\)</span> днів. Це число в значній мірі незбагненно велике. Якби S&amp;P 500 почав торгуватися відразу після <a href="https://en.wikipedia.org/wiki/Age_of_the_universe">народження Всесвіту</a>, це становило б лише <span class="math inline">\(10^{13}\)</span> торгових днів. Через <span class="math inline">\(10^{116}\)</span> днів усі зірки у Всесвіті давно згорять, навіть усі <a href="https://en.wikipedia.org/wiki/Future_of_an_expanding_universe#Dark_Era_and_Photon_Age">чорні діри випаруються</a> і Всесвіт стане темним і порожнім місцем. Тож або ми повинні бути дуже щасливі, що єдина очікувана Чорна п’ятниця в історії та майбутньому Всесвіту позаду, або ви дійсно ніколи не повинні використовувати розподіл Гауса для моделювання прибутковості акцій! Незалежно від ринку та деталей, якщо хтось говорить про події з 10 сигмами або 23 сигмами, він, безумовно, використовує неправильну модель, оскільки шанс спостерігати таку подію в нашому житті незначний.</p>
<p>Отже, виникає питання: як ми справляємось із такими екстремальними значеннями? Чи слід позначати їх як <a href="https://en.wikipedia.org/wiki/Outlier">викиди</a> або артефакти, щоб наші фінансові моделі краще описували більшість значень? Звичайно, ні, оскільки результат наших інвестицій може критично залежати не від більшості менших прибутковостей, а саме від таких екстремальних подій! Далі ми познайомимося з підходом, який може пояснити та екстраполювати за межі екстремальних подій, таких як Чорний понеділок. Але ми також побачимо, що не всі способи врахування важких хвостів розподілів працюють добре, оскільки деякі моделі, такі як <a href="https://en.wikipedia.org/wiki/Autoregressive_conditional_heteroskedasticity">GARCH</a> може заколисати нас помилковим почуттям безпеки, коли ми завжди беремо до уваги минулі екстремальні події, але завжди дивуємося новим.</p>
</section>
<section id="статистика-степеневого-розподілу" class="level3" data-number="12.1.6">
<h3 data-number="12.1.6" class="anchored" data-anchor-id="статистика-степеневого-розподілу"><span class="header-section-number">12.1.6</span> Статистика степеневого розподілу</h3>
<p>Тепер, коли ми знаємо, що розподіл Гауса не є хорошим вибором, який тип розподілу насправді може описати частоту екстремальних подій, які струшують S&amp;P 500? Частота екстремально позитивні та негативні прибутковості асиметричні для більшості фінансових активів, оскільки крахи, як правило, більш сильні, ніж підйоми. Ось чому нижче ми зосередимося на лівому (негативному) хвості розподілу прибутковостей.</p>
<p>Оскільки нас цікавлять лише екстремальні події, ми розглянемо лише ті прибутковості, які менше <span class="math inline">\(-0.03\)</span> (приблизно три стандартних відхилення від середнього значення). Нижче ми візуалізуємо ці екстремально негативні показники прибутковостей в <a href="https://en.wikipedia.org/wiki/Log%E2%80%93log_plot">логарифмічному масштабі</a> (тут ми використовуємо абсолютні значення негативних прибутковостей). Як вісь Oy (яка показує частоту логарифмічних прибутковостей), так і вісь Ox (яка показує величину логарифмічних прибутковостей) масштабуються логарифмічно:</p>
<div class="cell" data-execution_count="27">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="co"># хвіст починається приблизно при трьох стандартних відхиленнях від середнього</span></span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>np.mean(lr) <span class="op">-</span> <span class="dv">3</span><span class="op">*</span>np.std(lr)</span></code><button title="Копіювати" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="27">
<pre><code>-0.029610514264246313</code></pre>
</div>
</div>
<div class="cell" data-execution_count="28">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>neg_lr <span class="op">=</span> <span class="op">-</span>lr[lr <span class="op">&lt;</span> <span class="dv">0</span>]</span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>plt.figure()</span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a>hist <span class="op">=</span> plt.hist(neg_lr, bins<span class="op">=</span>np.logspace(np.log10(<span class="fl">0.03</span>),np.log10(<span class="fl">0.3</span>), <span class="dv">20</span>), density<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a>plt.yscale(<span class="st">"log"</span>)</span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a>plt.xscale(<span class="st">"log"</span>)</span>
<span id="cb39-7"><a href="#cb39-7" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Розп. ймов.'</span>)</span>
<span id="cb39-8"><a href="#cb39-8" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Щоденні негативні абсолютні прибутковості'</span>)</span>
<span id="cb39-9"><a href="#cb39-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-10"><a href="#cb39-10" aria-hidden="true" tabindex="-1"></a>plt.ylim([<span class="fl">0.1</span>, <span class="dv">110</span>])</span>
<span id="cb39-11"><a href="#cb39-11" aria-hidden="true" tabindex="-1"></a>plt.xlim([<span class="fl">0.03</span>, <span class="fl">0.3</span>])</span>
<span id="cb39-12"><a href="#cb39-12" aria-hidden="true" tabindex="-1"></a>plt.xticks([<span class="fl">0.03</span>, <span class="fl">0.04</span>, <span class="fl">0.05</span>, <span class="fl">0.06</span>, <span class="fl">0.1</span>, <span class="fl">0.2</span>, <span class="fl">0.3</span>], [<span class="fl">0.03</span>, <span class="fl">0.04</span>, <span class="fl">0.05</span>, <span class="fl">0.06</span>, <span class="fl">0.1</span>, <span class="fl">0.2</span>, <span class="fl">0.3</span>])</span>
<span id="cb39-13"><a href="#cb39-13" aria-hidden="true" tabindex="-1"></a>plt.show()<span class="op">;</span></span></code><button title="Копіювати" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="lab_12_files/figure-html/cell-27-output-1.png" class="img-fluid"></p>
</div>
</div>
<p>Як ми бачимо, ця гістограма екстремальних абсолютних прибутків зменшується приблизно лінійно при логарифмічному масштабуванні. Щоразу, коли ви виявляєте пряму лінію на логарифмічному графіку, це вказує на так званий <a href="https://en.wikipedia.org/wiki/Power_law">степеневий розподіл</a>. Степеневе співвідношення ймовірності спостереження великих абсолютних логарифмічних прибутковостей задається у вигляді:</p>
<p><span class="math display">\[
p(|r_t|) = c \cdot |r_t|^{-\alpha}
\]</span></p>
<p>Константа <span class="math inline">\(c\)</span> на даний момент нас не надто турбує, вона просто гарантує, що ліва частина рівняння належним чином нормалізована, але показник <span class="math inline">\(\alpha\)</span> представляє для найбільший інтерес, оскільки він говорить нам, як працює степеневий закон. Якщо ви знаєте частоту даних абсолютних логарифмічних прибутковостей, то степеневий закон підкаже вам, у скільки разів менш імовірними були б логарифмічні прибутковості подвоєного розміру:</p>
<p><span class="math display">\[
p(2 \cdot |r_t|) = c \cdot (2 \cdot |r_t|)^{-\alpha} = 2^{-\alpha} \cdot c \cdot |r_t|^{-\alpha} = 2^{-\alpha} \cdot p(|r_t|)
\]</span></p>
<p>або простіше:</p>
<p><span class="math display">\[
\frac{p(2 \cdot |r_t|)}{p(|r_t|)} = \frac{1}{2^{\alpha}}
\]</span></p>
<p>Для <span class="math inline">\(\alpha = 0\)</span> всі прибутковості однаково ймовірні, для <span class="math inline">\(\alpha = 2\)</span> подвоєння прибутковостей робить їх у 4 рази менш імовірними. Оскільки це правило подвоєння вгору або вниз не залежить від значення самого <span class="math inline">\(\left| r_t \right|\)</span>, але працює для всіх значень <span class="math inline">\(\left| r_t \right|\)</span>. Степеневе співвідношення також називаються “безмасштабним” або <a href="https://en.wikipedia.org/wiki/Scale_invariance">масштабо-інваріантним</a>.</p>
<p>Як щодо показника <span class="math inline">\(\alpha\)</span> для наших надзвичайно негативних логарифмічних прибутковостей S&amp;P 500? Ми можемо легко оцінити його за даними, але є деякі тонкощі у правильному розбитті вищезазначеної гістограми, які можуть вплинути на нашу оцінку (див., наприклад, <span class="citation" data-cites="10.1890/07-1288.1">&nbsp;[<a href="references.html#ref-10.1890/07-1288.1" role="doc-biblioref">1</a>]</span>). Щоб обійти ці проблеми з розбиттям, ми можемо замість цього оцінити степенний показник <a href="https://en.wikipedia.org/wiki/Histogram#Cumulative_histogram">кумулятивної гістограми</a> логарифмічних прибутковостей, а потім відняти одиницю від отриманого нахилу:</p>
<div class="cell" data-execution_count="29">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="co"># підганяємо лінію регресії до кумулятивної гістограми (log10 для ймовірності) vs. лог-прибутковості (log10)</span></span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>sorted_neg_lr <span class="op">=</span> np.sort(neg_lr.values)</span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>cumulative_probability <span class="op">=</span> np.linspace(<span class="dv">1</span>, <span class="dv">0</span>, <span class="bu">len</span>(sorted_neg_lr)<span class="op">+</span><span class="dv">1</span>)[:<span class="op">-</span><span class="dv">1</span>]</span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a>x_min <span class="op">=</span> <span class="fl">0.03</span></span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a>mask <span class="op">=</span> sorted_neg_lr <span class="op">&gt;=</span> x_min</span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a>m, b <span class="op">=</span> np.polyfit(np.log10(sorted_neg_lr[mask]), np.log10(cumulative_probability[mask]), <span class="dv">1</span>)</span>
<span id="cb40-8"><a href="#cb40-8" aria-hidden="true" tabindex="-1"></a>alpha <span class="op">=</span> <span class="op">-</span>(m <span class="op">-</span> <span class="dv">1</span>)</span>
<span id="cb40-9"><a href="#cb40-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-10"><a href="#cb40-10" aria-hidden="true" tabindex="-1"></a>plt.figure()</span>
<span id="cb40-11"><a href="#cb40-11" aria-hidden="true" tabindex="-1"></a>plt.plot(np.log10(sorted_neg_lr[mask]), np.log10(cumulative_probability[mask]))</span>
<span id="cb40-12"><a href="#cb40-12" aria-hidden="true" tabindex="-1"></a>plt.scatter(np.log10(sorted_neg_lr[mask]), np.log10(cumulative_probability[mask]), label<span class="op">=</span><span class="st">'sample data'</span>)</span>
<span id="cb40-13"><a href="#cb40-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-14"><a href="#cb40-14" aria-hidden="true" tabindex="-1"></a>x_fit <span class="op">=</span> np.linspace(np.log10(x_min), np.log10(<span class="fl">1.1</span><span class="op">*</span>np.<span class="bu">max</span>(neg_lr)), <span class="dv">100</span>)</span>
<span id="cb40-15"><a href="#cb40-15" aria-hidden="true" tabindex="-1"></a>y_fit <span class="op">=</span> m<span class="op">*</span>x_fit <span class="op">+</span> b</span>
<span id="cb40-16"><a href="#cb40-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-17"><a href="#cb40-17" aria-hidden="true" tabindex="-1"></a>plt.plot(x_fit, y_fit, label<span class="op">=</span><span class="st">'степенева підгонка'</span>)</span>
<span id="cb40-18"><a href="#cb40-18" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="ss">f'розрахований степеневий показник $</span><span class="ch">\\</span><span class="ss">alpha=</span><span class="sc">{</span>alpha<span class="sc">:.2f}</span><span class="ss">$'</span>)</span>
<span id="cb40-19"><a href="#cb40-19" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'лог-прибутковості (log10-scaled)'</span>)</span>
<span id="cb40-20"><a href="#cb40-20" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'кумулятивна гістограма (log10-scaled)'</span>)</span>
<span id="cb40-21"><a href="#cb40-21" aria-hidden="true" tabindex="-1"></a>plt.show()<span class="op">;</span></span></code><button title="Копіювати" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="lab_12_files/figure-html/cell-28-output-1.png" class="img-fluid"></p>
</div>
</div>
<p>Виходячи з цієї оцінки, ми отримуємо степеневої показник, рівний <span class="math inline">\(\alpha \approx 3.7\)</span>. Якщо ми побудуємо гістограму наших надзвичайно негативних логарифмічних прибутковостей, то побачимо, що вона добре відображає зниження ймовірності, оскільки масштаб збоїв збільшується. Однак цей степеневий показник все ще недооцінює ймовірність настання чергового “Чорного понеділка”, оскільки лінія відповідності не ідеально підходить до цієї крайньої точки. Якби ми захотіли створити ще більш консервативну модель екстремальних подій, нам потрібно було б вручну ще більше зменшити значення <span class="math inline">\(\alpha\)</span>, щоб врахувати більшу ймовірність настання чорних понеділків за рахунок втрати точності підгонки для менших збоїв. Це перший раз, коли ми можемо побачити, як одна точка даних впливає на наші рішення щодо моделювання. На даний момент ми будемо довіряти оцінці параметра і погодимося з оцінкою <span class="math inline">\(\alpha=3.7\)</span>.</p>
<div class="cell" data-execution_count="30">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>neg_lr <span class="op">=</span> <span class="op">-</span>lr[lr <span class="op">&lt;</span> <span class="dv">0</span>]</span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a>plt.figure()</span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a>hist <span class="op">=</span> plt.hist(neg_lr, bins<span class="op">=</span>np.logspace(np.log10(<span class="fl">0.03</span>),np.log10(<span class="fl">0.3</span>), <span class="dv">20</span>), density<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a>plt.yscale(<span class="st">"log"</span>)</span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a>plt.xscale(<span class="st">"log"</span>)</span>
<span id="cb41-7"><a href="#cb41-7" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Розп. ймов.'</span>)</span>
<span id="cb41-8"><a href="#cb41-8" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Щоденні негативні абсолютні прибутковості'</span>)</span>
<span id="cb41-9"><a href="#cb41-9" aria-hidden="true" tabindex="-1"></a>plt.ylim([<span class="fl">0.1</span>, <span class="dv">110</span>])<span class="op">;</span></span>
<span id="cb41-10"><a href="#cb41-10" aria-hidden="true" tabindex="-1"></a>plt.xlim([<span class="fl">0.03</span>, <span class="fl">0.3</span>])</span>
<span id="cb41-11"><a href="#cb41-11" aria-hidden="true" tabindex="-1"></a>plt.xticks([<span class="fl">0.03</span>, <span class="fl">0.04</span>, <span class="fl">0.05</span>, <span class="fl">0.06</span>, <span class="fl">0.1</span>, <span class="fl">0.2</span>, <span class="fl">0.3</span>], [<span class="fl">0.03</span>, <span class="fl">0.04</span>, <span class="fl">0.05</span>, <span class="fl">0.06</span>, <span class="fl">0.1</span>, <span class="fl">0.2</span>, <span class="fl">0.3</span>])<span class="op">;</span></span>
<span id="cb41-12"><a href="#cb41-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-13"><a href="#cb41-13" aria-hidden="true" tabindex="-1"></a>x_fit <span class="op">=</span> np.logspace(np.log10(<span class="fl">0.03</span>),np.log10(<span class="fl">0.3</span>), <span class="dv">100</span>)</span>
<span id="cb41-14"><a href="#cb41-14" aria-hidden="true" tabindex="-1"></a>y_fit <span class="op">=</span> <span class="fl">0.00022</span><span class="op">*</span>(x_fit<span class="op">**-</span><span class="fl">3.7</span>)</span>
<span id="cb41-15"><a href="#cb41-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-16"><a href="#cb41-16" aria-hidden="true" tabindex="-1"></a>plt.plot(x_fit, y_fit, lw<span class="op">=</span><span class="dv">3</span>)</span>
<span id="cb41-17"><a href="#cb41-17" aria-hidden="true" tabindex="-1"></a>plt.show()<span class="op">;</span></span></code><button title="Копіювати" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="lab_12_files/figure-html/cell-29-output-1.png" class="img-fluid"></p>
</div>
</div>
<p>Ми можемо використовувати цей степеневий закон, щоб екстраполювати, як часто ми очікуємо настання чорного понеділка (або “події з 23 сигмами”) у довгостроковій перспективі. Виходячи з наявних у нас даних, ми можемо оцінити, що ймовірність спостереження зниження на <span class="math inline">\(-0.03\)</span> або гірше становить близько <span class="math inline">\(1.6\%\)</span>. Слідуючи нашій степеневій кривій, зниження чорного понеділка на <span class="math inline">\(-0.229\)</span>, таким чином, відбувалося б із частотою <span class="math inline">\(\left(0.229/0.03\right)^{-3.7} \approx 1/1845\)</span>. Так само часто, як зниження на <span class="math inline">\(-0.03\)</span>, яке ми спостерігаємо приблизно раз на три місяці. Це означає, що, виходячи з нашої степеневої кривої, очікується, що чорні понеділки, подібні до 1987 року, траплятимуться приблизно раз на 450 років (див. код нижче).</p>
<div class="cell" data-execution_count="29">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="co"># як часто ринок знижується більш ніж на -0.03</span></span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>(neg_lr <span class="op">&gt;</span> <span class="fl">0.03</span>).mean()</span></code><button title="Копіювати" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="29">
<pre><code>0.016091417910447763</code></pre>
</div>
</div>
<div class="cell" data-execution_count="30">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="co"># у середньому, як багато днів між цима трьома подіями</span></span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a><span class="fl">1.</span><span class="op">/</span>(neg_lr <span class="op">&gt;</span> <span class="fl">0.03</span>).mean()</span></code><button title="Копіювати" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="30">
<pre><code>62.144927536231876</code></pre>
</div>
</div>
<div class="cell" data-execution_count="31">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="co"># у скільки разів менше відбувається подій "Чорного понеділка" в порівнянні зі зниженням на -0.03?</span></span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>(np.<span class="bu">max</span>(neg_lr)<span class="op">/</span><span class="fl">0.03</span>)<span class="op">**</span><span class="fl">3.7</span></span></code><button title="Копіювати" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="31">
<pre><code>1845.1139014672306</code></pre>
</div>
</div>
<div class="cell" data-execution_count="32">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>np.<span class="bu">max</span>(neg_lr)</span></code><button title="Копіювати" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="32">
<pre><code>0.2289972265656708</code></pre>
</div>
</div>
<div class="cell" data-execution_count="33">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="co"># скільки років пройшло між двома подіями "Чорного понеділка",</span></span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a><span class="co"># виходячи з припущення, що подія -0.03 відбувається один раз у 63 дня?</span></span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a>(<span class="fl">1.</span><span class="op">/</span>((<span class="dv">1</span><span class="op">/</span><span class="dv">62</span>)<span class="op">*</span><span class="dv">1</span><span class="op">/</span><span class="dv">1845</span>))<span class="op">/</span><span class="dv">252</span></span></code><button title="Копіювати" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="33">
<pre><code>453.92857142857144</code></pre>
</div>
</div>
<p>Якби ми включили більше даних, що містять інші приклади екстремальних подій, наприклад, з <a href="https://en.wikipedia.org/wiki/Great_Depression">Великої депресії</a>, ця оцінка може стати ще меншою. Аналогічно, якби ми скоригували степеневий показник так, щоб він був більш консервативним, ніж передбачає наш простий метод оцінки, ми також отримали б коротший період. Хоча 460 років все ще є дуже великим періодом, це набагато більш реалістична оцінка порівняно з <span class="math inline">\(10^{114}\)</span> роками, які ми отримали, використовуючи розподіл Гауса. Однією з переваг степеневої моделі є її здатність до екстраполяції: використовуючи степеневу оцінку <span class="math inline">\(\alpha\)</span> та частоту менших прибутковостей, щодо яких ми маємо достовірні дані, ми можемо оцінити частоту майбутніх серйозних збоїв, щодо яких ми ще не отримали жодних даних. Ще про одну перевагу оцінки <span class="math inline">\(\alpha\)</span> ми розглянемо далі.</p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
ПРИМІТКА
</div>
</div>
<div class="callout-body-container callout-body">
<p>Не існує такого поняття, як “подія з 10 сигмами”! Справжня подія з 10 сигмами настільки неймовірно рідкісна, що пережити її протягом нашого життя — мізерно мало. Екстремальні події, безумовно, трапляються, але вони не можуть бути описані за допомогою “сигм”, їх потрібно враховувати і екстраполювати з використанням степеневих законів. Завжди будьте обережні, коли аналітики виправдовують себе за те, що вони не були готові до “події з 10 сигмами”, оскільки це вказує на те, що їх моделі ризиків вкрай недосконалі</p>
</div>
</div>
</section>
<section id="статистичні-моменти-під-впливом-важких-хвостів" class="level3" data-number="12.1.7">
<h3 data-number="12.1.7" class="anchored" data-anchor-id="статистичні-моменти-під-впливом-важких-хвостів"><span class="header-section-number">12.1.7</span> Статистичні моменти під впливом важких хвостів</h3>
<p>Чому все це так важливо? Степенневий показник <span class="math inline">\(\alpha\)</span> насправді багато говорить нам про стабільність і збіжність <a href="https://en.wikipedia.org/wiki/Moment_(mathematics)">моментів розподілу ймовірностей</a>, і це, в свою чергу, має значення для деяких найбільш часто використовуваних моделей у фінансах. Перші чотири центральні моменти — це:</p>
<ul>
<li><strong><a href="https://en.wikipedia.org/wiki/Expected_value">Середнє</a></strong>: очікуване значення розподілу</li>
<li><strong><a href="https://en.wikipedia.org/wiki/Variance">Дисперсія</a></strong>: Квадрат стандартного відхилення, який часто використовується для оцінки волатильності на основі розподілу прибутковості.</li>
<li><strong><a href="https://en.wikipedia.org/wiki/Skewness">Асиметрія</a></strong>: вимірює зміщення розподілу. Розподіл прибутковостей, як правило, має негативну асиметрію, оскільки збої є більш стрімкими, ніж підйоми.</li>
<li><strong><a href="https://en.wikipedia.org/wiki/Kurtosis">Ексцес</a></strong>: вимірює тяжкість хвостів розподілу. Розподіли прибутковостей зазвичай мають ексцес більший ніж у розподілі Гауса, тобто екстремальні події відбуваються частіше, ніж очікувалося в гаусовій моделі.</li>
</ul>
<p>Ексцес Гаусового розподілу дорівнює 3 (використовуючи визначення Пірсона, з визначенням Фішера <a href="https://en.wikipedia.org/wiki/Kurtosis#Excess_kurtosis">надлишкового ексцесу</a> це 0), але наша вибірка щоденних логарифмічних прибутковостей S&amp;P 500 має ексцес <span class="math inline">\(28.6\)</span>, що знову вказує на те, що екстремальні події набагато більш вірогідні, що суперечить Гаусовому розподілу.</p>
<div class="cell" data-execution_count="34">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="co"># обчислюємо ексцес лог-прибутковостей</span></span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> scipy.stats <span class="im">import</span> kurtosis</span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true" tabindex="-1"></a>kurtosis(lr, fisher<span class="op">=</span><span class="va">False</span>, bias<span class="op">=</span><span class="va">False</span>)</span></code><button title="Копіювати" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="34">
<pre><code>28.610931957080663</code></pre>
</div>
</div>
<p>Тепер ми дійшли до того моменту, коли ми могли б запитати: наскільки сильно одна точка впливає на нашу оцінку ексцесу? Якщо ми перерахуємо ексцес всіх щоденних прибутків S&amp;P 500 з 1950 року і виключимо тільки чорний понеділок 1987 року, ми отримаємо значення <span class="math inline">\(14.3\)</span>, майже половину від значення, яке ми отримуємо, коли використовуємо всі значення! Видалення подальших найгірших днів, звичайно, ще більше зменшує ексцес, але ефект значно менший.</p>
<div class="cell" data-execution_count="35">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="co"># обчислюємо ексцес лог-прибутковостей після видалення Чорного понеділка 1987</span></span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a>kurtosis(lr[lr <span class="op">&gt;</span> np.<span class="bu">min</span>(lr)], fisher<span class="op">=</span><span class="va">False</span>, bias<span class="op">=</span><span class="va">False</span>)</span></code><button title="Копіювати" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="35">
<pre><code>14.3083633314701</code></pre>
</div>
</div>
<div class="cell" data-execution_count="36">
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a>lr_sorted <span class="op">=</span> lr.sort_values()</span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a>kurt <span class="op">=</span> [kurtosis(lr_sorted.iloc[i:], fisher<span class="op">=</span><span class="va">False</span>, bias<span class="op">=</span><span class="va">False</span>) <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">10</span>)]</span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-4"><a href="#cb56-4" aria-hidden="true" tabindex="-1"></a>plt.figure()</span>
<span id="cb56-5"><a href="#cb56-5" aria-hidden="true" tabindex="-1"></a>plt.plot(np.arange(<span class="dv">10</span>), kurt, c<span class="op">=</span><span class="st">'C3'</span>, lw<span class="op">=</span><span class="dv">2</span>, zorder<span class="op">=</span><span class="dv">2</span>)</span>
<span id="cb56-6"><a href="#cb56-6" aria-hidden="true" tabindex="-1"></a>plt.scatter(np.arange(<span class="dv">10</span>), kurt, s<span class="op">=</span><span class="dv">120</span>, lw<span class="op">=</span><span class="fl">0.75</span>, edgecolor<span class="op">=</span><span class="st">'k'</span>, facecolor<span class="op">=</span><span class="st">'C3'</span>, zorder<span class="op">=</span><span class="dv">3</span>)</span>
<span id="cb56-7"><a href="#cb56-7" aria-hidden="true" tabindex="-1"></a>plt.grid()</span>
<span id="cb56-8"><a href="#cb56-8" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'кіль-ть виключених найгірших днів'</span>)</span>
<span id="cb56-9"><a href="#cb56-9" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Ексцес щоденних лог-прибутковостей'</span>)</span>
<span id="cb56-10"><a href="#cb56-10" aria-hidden="true" tabindex="-1"></a>plt.ylim([<span class="dv">0</span>, <span class="dv">32</span>])</span>
<span id="cb56-11"><a href="#cb56-11" aria-hidden="true" tabindex="-1"></a>plt.show()<span class="op">;</span></span></code><button title="Копіювати" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="lab_12_files/figure-html/cell-37-output-1.png" class="img-fluid"></p>
</div>
</div>
<p>Більш радикальний погляд на цю проблему досягається, якщо ми будуємо графік ексцесу в покроковому режимі, тобто для кожного дня ми будуємо розрахунковий ексцес, використовуючи всі минулі логарифмічні дані до цього моменту часу. Як ви можете бачити нижче, до “Чорного понеділка” ексцес ніколи не перевищував <span class="math inline">\(15\)</span>, проте навіть через 35 років після “Чорного понеділка” ексцес ще не “оговтався” від цієї події і залишається на позначці 30. Чи означає це, що ми повинні просто ігнорувати Чорний понеділок як викид і продовжувати використовувати нашу “чисту” оцінку в <span class="math inline">\(14.6\)</span>? Ні, точно ні! Як ми побачимо незабаром, ми скоріше повинні запитати себе, чи є сенс у тому, щоб оцінювати ексцес!</p>
<div class="cell" data-execution_count="37">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a>kurt <span class="op">=</span> [kurtosis(lr.iloc[:i], fisher<span class="op">=</span><span class="va">False</span>, bias<span class="op">=</span><span class="va">False</span>) <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">1000</span>, <span class="bu">len</span>(lr))]</span></code><button title="Копіювати" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="38">
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a>plt.figure()</span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a>plt.plot(lr.index[<span class="dv">1000</span>:], kurt, c<span class="op">=</span><span class="st">'C3'</span>, lw<span class="op">=</span><span class="dv">3</span>, zorder<span class="op">=</span><span class="dv">2</span>)</span>
<span id="cb58-3"><a href="#cb58-3" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Ексцес щоденних лог-прибутковостей'</span>)</span>
<span id="cb58-4"><a href="#cb58-4" aria-hidden="true" tabindex="-1"></a>plt.show()<span class="op">;</span></span></code><button title="Копіювати" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="lab_12_files/figure-html/cell-39-output-1.png" class="img-fluid"></p>
</div>
</div>
<p>Той факт, що одна точка даних може настільки сильно змінити нашу оцінку ексцесу, і, схоже, вона більше не сходиться, коли додаються нові точки даних, є чітким свідченням того, що ексцес базового розподілу ймовірностей насправді нескінченний! Проблема полягає в тому, що для кінцевої вибірки даних (а всі набори даних скінченні) ми завжди зможемо оцінити скінчене значення ексцесу. <code>scipy.stats.kurtosis</code> не може повернути <span class="math inline">\(\infty\)</span>, він завжди повідомлятиме про скінченний ексцес <em>вибірки</em>. Але ця кінцева оцінка не допоможе нам нічого сказати про майбутню поведінку ринку, оскільки ексцес продовжуватиме переходити до ще більших значень до наступного чорного понеділка, іншого чорного вівторка … у більш-менш віддаленому майбутньому.</p>
<p>Однак опис частоти екстремальних подій згідно степеневого закону, який ми представили вище, може допомогти нам вирішити, чи є ексцес кінцевим, так що, переглянувши достатню кількість точок даних, ми зможемо вирішити, чи слід прийняти той факт, що ексцес не піддається оцінці і справді нескінченний. Щоб побачити це, нам потрібно ввести ще один розподіл ймовірностей, <a href="https://en.wikipedia.org/wiki/Student%27s_t-distribution">t-розподіл Стьюдента</a>. Це колоколообразний симетричний розподіл зі степеневими хвостами. Його додатковий параметр <span class="math inline">\(\nu\)</span> визначає показник степеневого закону <span class="math inline">\(\alpha=(\nu+1)\)</span>. Нижче ми підганяємо t-розподіл до наших логарифмічних прибутковостей S&amp;P 500, зберігаючи при цьому степеневий показник <span class="math inline">\(\alpha=3.7\)</span> (відповідний <span class="math inline">\(\nu = 2.7\)</span>), який ми підганяли раніше:</p>
<div class="cell" data-execution_count="39">
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> scipy.stats <span class="im">import</span> t</span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a>fit_params <span class="op">=</span> t.fit(lr, fix_df<span class="op">=</span><span class="fl">2.7</span>)</span>
<span id="cb59-4"><a href="#cb59-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-5"><a href="#cb59-5" aria-hidden="true" tabindex="-1"></a>x_fit <span class="op">=</span> np.linspace(<span class="op">-</span><span class="fl">0.25</span>, <span class="fl">0.125</span>, <span class="dv">1000</span>)</span>
<span id="cb59-6"><a href="#cb59-6" aria-hidden="true" tabindex="-1"></a>y_fit_t <span class="op">=</span> t(<span class="op">*</span>fit_params).pdf(x_fit)</span></code><button title="Копіювати" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="40">
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a>plt.figure()</span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a>plt.hist(lr, <span class="dv">100</span>, density<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb60-3"><a href="#cb60-3" aria-hidden="true" tabindex="-1"></a>plt.plot(x_fit, y_fit_t, lw<span class="op">=</span><span class="dv">3</span>, c<span class="op">=</span><span class="st">'C3'</span>, alpha<span class="op">=</span><span class="fl">0.8</span>, label<span class="op">=</span><span class="st">"Підігнаний t-розподіл"</span>)</span>
<span id="cb60-4"><a href="#cb60-4" aria-hidden="true" tabindex="-1"></a>plt.yscale(<span class="st">'log'</span>)</span>
<span id="cb60-5"><a href="#cb60-5" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Розп. ймов.'</span>)</span>
<span id="cb60-6"><a href="#cb60-6" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Щоденні лог-прибутковості'</span>)</span>
<span id="cb60-7"><a href="#cb60-7" aria-hidden="true" tabindex="-1"></a>plt.xlim([<span class="op">-</span><span class="fl">0.25</span>, <span class="fl">0.125</span>])</span>
<span id="cb60-8"><a href="#cb60-8" aria-hidden="true" tabindex="-1"></a>plt.ylim([<span class="fl">0.0011</span>, <span class="dv">99</span>])</span>
<span id="cb60-9"><a href="#cb60-9" aria-hidden="true" tabindex="-1"></a>plt.legend()</span>
<span id="cb60-10"><a href="#cb60-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-11"><a href="#cb60-11" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="ss">f'Підігнаний степеневий показник: $</span><span class="ch">\\</span><span class="ss">alpha = </span><span class="sc">{</span>(fit_params[<span class="dv">0</span>]<span class="op">+</span><span class="dv">1</span>)<span class="sc">:.2f}</span><span class="ss">$'</span>)</span>
<span id="cb60-12"><a href="#cb60-12" aria-hidden="true" tabindex="-1"></a>plt.show()<span class="op">;</span></span></code><button title="Копіювати" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="lab_12_files/figure-html/cell-41-output-1.png" class="img-fluid"></p>
</div>
</div>
<p>Звичайно, можна поставити під сумнів, чи дійсно t-розподіл Стьюдента добре відповідає нашим логарифмічним прибутковостям, оскільки він переоцінює частоту абсолютних прибутковостей і все ще недооцінює ймовірність настання Чорного понеділка. На даний момент ми ігноруємо ці деталі та зосереджуємось на ексцесі t-розподілу Стьюдента та зв’язку зі степеневим показником <span class="math inline">\(\alpha\)</span>:</p>
<ul>
<li><span class="math inline">\(\text{Kurt} = 6/(\nu-4) + 3~\)</span> для <span class="math inline">\(~\nu &gt; 4~\)</span> або <span class="math inline">\(~\alpha &gt; 5\)</span></li>
<li><span class="math inline">\(\text{Kurt} = \infty~~~~~~~~~~\,\)</span> для <span class="math inline">\(~2 &lt; \nu \leq 4~\)</span> або <span class="math inline">\(~3 &lt; \alpha \leq 5\)</span></li>
<li>інакше невизначено</li>
</ul>
<p>Це підтверджує наше початкове припущення про те, що при степеневому показнику, рівному <span class="math inline">\(\alpha \approx 3.7\)</span>, ексцес дійсно нескінченний, і немає сенсу оцінювати його по скінченій вибірці, оскільки оціночне значення буде зберігатися тільки до наступної екстремальної події, яка підштовхне його ще вище. Ми можемо легко змоделювати цей ефект, витягуючи випадкові вибірки з t-розподілів Стьюдента з різними степеневими показниками, які відповідають трьом режимам, зазначеним вище. Нижче ми витягуємо 100 000 випадкових значень з t-розподілів з <span class="math inline">\(\alpha = 2\)</span>, <span class="math inline">\(\alpha = 3.7\)</span>, <span class="math inline">\(\alpha = 6\)</span>, а потім обчислюємо ексцес поетапно, як і раніше, щоб побачити, як еволюціонує передбачуваний ексцес вибірки з часом у трьох різних випадках:</p>
<div class="cell" data-execution_count="41">
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a>np.random.seed(<span class="dv">1</span>)</span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a>samples_alpha_20 <span class="op">=</span> t(<span class="fl">1.0</span>, <span class="fl">0.</span>, <span class="fl">1.</span>).rvs(<span class="dv">100000</span>)</span>
<span id="cb61-3"><a href="#cb61-3" aria-hidden="true" tabindex="-1"></a>samples_alpha_37 <span class="op">=</span> t(<span class="fl">2.7</span>, <span class="fl">0.</span>, <span class="fl">1.</span>).rvs(<span class="dv">100000</span>)</span>
<span id="cb61-4"><a href="#cb61-4" aria-hidden="true" tabindex="-1"></a>samples_alpha_60 <span class="op">=</span> t(<span class="fl">5.0</span>, <span class="fl">0.</span>, <span class="fl">1.</span>).rvs(<span class="dv">100000</span>)</span></code><button title="Копіювати" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="42">
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a>m <span class="op">=</span> np.arange(<span class="dv">1000</span>, <span class="dv">100000</span>, <span class="dv">50</span>)</span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a>kurt_alpha_20 <span class="op">=</span> [kurtosis(samples_alpha_20[:i], fisher<span class="op">=</span><span class="va">False</span>, bias<span class="op">=</span><span class="va">False</span>) <span class="cf">for</span> i <span class="kw">in</span> m]</span>
<span id="cb62-3"><a href="#cb62-3" aria-hidden="true" tabindex="-1"></a>kurt_alpha_37 <span class="op">=</span> [kurtosis(samples_alpha_37[:i], fisher<span class="op">=</span><span class="va">False</span>, bias<span class="op">=</span><span class="va">False</span>) <span class="cf">for</span> i <span class="kw">in</span> m]</span>
<span id="cb62-4"><a href="#cb62-4" aria-hidden="true" tabindex="-1"></a>kurt_alpha_60 <span class="op">=</span> [kurtosis(samples_alpha_60[:i], fisher<span class="op">=</span><span class="va">False</span>, bias<span class="op">=</span><span class="va">False</span>) <span class="cf">for</span> i <span class="kw">in</span> m]</span></code><button title="Копіювати" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="43">
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a>plt.figure()</span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-3"><a href="#cb63-3" aria-hidden="true" tabindex="-1"></a>plt.subplot(<span class="dv">311</span>)</span>
<span id="cb63-4"><a href="#cb63-4" aria-hidden="true" tabindex="-1"></a>plt.plot(m, kurt_alpha_60, c<span class="op">=</span><span class="st">'C2'</span>, lw<span class="op">=</span><span class="dv">3</span>, zorder<span class="op">=</span><span class="dv">2</span>)</span>
<span id="cb63-5"><a href="#cb63-5" aria-hidden="true" tabindex="-1"></a>plt.axhline(<span class="dv">6</span><span class="op">/</span>(<span class="dv">5</span><span class="op">-</span><span class="dv">4</span>) <span class="op">+</span> <span class="dv">3</span>, lw<span class="op">=</span><span class="dv">1</span>, ls<span class="op">=</span><span class="st">'--'</span>, c<span class="op">=</span><span class="st">'k'</span>)</span>
<span id="cb63-6"><a href="#cb63-6" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Ексцес'</span>)</span>
<span id="cb63-7"><a href="#cb63-7" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Кількість значень'</span>)</span>
<span id="cb63-8"><a href="#cb63-8" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Степеневий показник $</span><span class="ch">\\</span><span class="st">alpha=6$'</span>)</span>
<span id="cb63-9"><a href="#cb63-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-10"><a href="#cb63-10" aria-hidden="true" tabindex="-1"></a>plt.subplot(<span class="dv">312</span>)</span>
<span id="cb63-11"><a href="#cb63-11" aria-hidden="true" tabindex="-1"></a>plt.plot(m, kurt_alpha_37, c<span class="op">=</span><span class="st">'C1'</span>, lw<span class="op">=</span><span class="dv">3</span>, zorder<span class="op">=</span><span class="dv">2</span>)</span>
<span id="cb63-12"><a href="#cb63-12" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Ексцес'</span>)</span>
<span id="cb63-13"><a href="#cb63-13" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Кількість значень'</span>)</span>
<span id="cb63-14"><a href="#cb63-14" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Степеневий показник $</span><span class="ch">\\</span><span class="st">alpha=3.7$'</span>)</span>
<span id="cb63-15"><a href="#cb63-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-16"><a href="#cb63-16" aria-hidden="true" tabindex="-1"></a>plt.subplot(<span class="dv">313</span>)</span>
<span id="cb63-17"><a href="#cb63-17" aria-hidden="true" tabindex="-1"></a>plt.plot(m, kurt_alpha_20, c<span class="op">=</span><span class="st">'C3'</span>, lw<span class="op">=</span><span class="dv">3</span>, zorder<span class="op">=</span><span class="dv">2</span>)</span>
<span id="cb63-18"><a href="#cb63-18" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Ексцес'</span>)</span>
<span id="cb63-19"><a href="#cb63-19" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Кількість значень'</span>)</span>
<span id="cb63-20"><a href="#cb63-20" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Степеневий показник $</span><span class="ch">\\</span><span class="st">alpha=2$'</span>)</span>
<span id="cb63-21"><a href="#cb63-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-22"><a href="#cb63-22" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb63-23"><a href="#cb63-23" aria-hidden="true" tabindex="-1"></a>plt.show()<span class="op">;</span></span></code><button title="Копіювати" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="lab_12_files/figure-html/cell-44-output-1.png" class="img-fluid"></p>
</div>
</div>
<p>У випадку <span class="math inline">\(\alpha=6\)</span> (<span class="math inline">\(\nu=5\)</span>) ексцес скінченний і повинен приймати значення <span class="math inline">\(6/(\nu - 4)+3=9\)</span>. Хоча ми бачимо деякі коливання, оціночне значення ексцесу повільно наближається до справжнього значення. Для прикладу, який відповідає степеневому показнику індексу S&amp;P 500 з <span class="math inline">\(\alpha = 3.7\)</span>, моделювання показує таку ж поведінку, що і для реальних даних: збіжність не може бути виявлена, скоріше кожна екстремальна подія збільшує ексцес; при нескінченних вибірках ми би досягли нескінченного ексцесу. У третьому випадку з <span class="math inline">\(\alpha = 2\)</span> ексцес t-розподілу Стьюдента навіть не визначений належним чином, і ми можемо побачити інший тип поведінки моделювання: зараз більшість точок даних збільшують оцінку ексцесу, а не лише кілька окремих екстремальних зразків. При такому повільно спадаючому статечному законі екстремальні значення зустрічаються повсюдно, що призводить до збільшення ексцесу при моделюванні.</p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Примітка
</div>
</div>
<div class="callout-body-container callout-body">
<p>Навіть якщо певні властивості розподілу ймовірностей нескінченні, ми завжди знайдемо кінцеві вибіркові оцінки при перегляді даного набору даних просто тому, що набір даних містить лише кінцеву кількість точок. Однак, якщо теорія степеневого закону чітко говорить нам, що певна властивість нескінченна, ми не повинні ніде використовувати кінцеві оцінки і ми не повинні використовувати моделі, які вимагають, щоб ця властивість була кінцевою! Якщо ми все одно це зробимо, це в кращому випадку буде працювати лише до наступної екстремальної події, яка анулює наші минулі оцінки і — у випадку фінансових моделей — може збанкрутувати нас!</p>
</div>
</div>
</section>
<section id="як-ексцес-дестабілізує-розрахунки-волатильності" class="level3" data-number="12.1.8">
<h3 data-number="12.1.8" class="anchored" data-anchor-id="як-ексцес-дестабілізує-розрахунки-волатильності"><span class="header-section-number">12.1.8</span> Як ексцес дестабілізує розрахунки волатильності</h3>
<p>Оскільки ексцес збільшується — або стає нескінченним — це також впливає на нижчі моменти, найголовніше, на дисперсію. Квадратний корінь дисперсії — це стандартне відхилення, або <a href="https://en.wikipedia.org/wiki/Volatility_(finance)">волатильність</a>, як це називається у фінансах. Волатильність є розповсюдженним параметром при оптимізації портфеля і практично в кожній фінансовій моделі, оскільки в кінцевому підсумку вона стала найбільш часто використовуваним показником “ризику”. Щоб побачити, як ексцес впливає на оцінку волатильності, ми проводимо простий експеримент <a href="https://en.wikipedia.org/wiki/Monte_Carlo_method">Монте-Карло</a>: ми витягуємо щоденну прибутковість за 50 років з розподілу ймовірностей за нашим вибором (ми будемо використовувати Гаусовий і t-розподіл Стьюдента) і обчислюємо оцінку волатильності, використовуючи вибіркове стандартне відхилення. Ми робимо це не тільки один раз, але і 10000 разів, кожен раз, коли ми розраховуємо нову гіпотетичну щоденну прибутковість за 50 років і обчислюємо відповідну оцінку волатильності. Звичайно, не всі ці оцінки будуть однаковими, але коливатимуться навколо справжньої волатильності, оскільки ми маємо лише кінцеву кількість даних. Оскільки ми знаємо справжній розподіл ймовірностей, який ми використовуємо для моделювання, ми також знаємо справжню волатильність. Щоб побачити, наскільки точно ми можемо оцінити волатильність на основі даних за 50 років, ми обчислюємо відносну похибку між оцінками волатильності та справжньою волатильністю.</p>
<div class="cell" data-execution_count="44">
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a>n_sim <span class="op">=</span> <span class="dv">10000</span></span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-3"><a href="#cb64-3" aria-hidden="true" tabindex="-1"></a>true_var <span class="op">=</span> <span class="fl">1.</span></span>
<span id="cb64-4"><a href="#cb64-4" aria-hidden="true" tabindex="-1"></a>true_vol <span class="op">=</span> np.sqrt(true_var)</span>
<span id="cb64-5"><a href="#cb64-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-6"><a href="#cb64-6" aria-hidden="true" tabindex="-1"></a>rand_vol <span class="op">=</span> np.array([np.std(norm(<span class="fl">0.</span>, <span class="fl">1.</span>).rvs(<span class="dv">50</span><span class="op">*</span><span class="dv">252</span>), ddof<span class="op">=</span><span class="dv">1</span>) <span class="cf">for</span> i <span class="kw">in</span> tqdm(<span class="bu">range</span>(n_sim))])</span>
<span id="cb64-7"><a href="#cb64-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-8"><a href="#cb64-8" aria-hidden="true" tabindex="-1"></a><span class="dv">100</span><span class="op">*</span>np.mean(np.<span class="bu">abs</span>(rand_vol <span class="op">-</span> true_vol))<span class="op">/</span>true_vol</span></code><button title="Копіювати" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>100%|██████████| 10000/10000 [00:08&lt;00:00, 1125.24it/s]</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="44">
<pre><code>0.5039568642168273</code></pre>
</div>
</div>
<div class="cell" data-execution_count="45">
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a>n_sim <span class="op">=</span> <span class="dv">10000</span></span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-3"><a href="#cb67-3" aria-hidden="true" tabindex="-1"></a>alpha <span class="op">=</span> <span class="fl">6.0</span></span>
<span id="cb67-4"><a href="#cb67-4" aria-hidden="true" tabindex="-1"></a>nu <span class="op">=</span> alpha <span class="op">-</span> <span class="dv">1</span></span>
<span id="cb67-5"><a href="#cb67-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-6"><a href="#cb67-6" aria-hidden="true" tabindex="-1"></a>true_var <span class="op">=</span> nu<span class="op">/</span>(nu<span class="op">-</span><span class="dv">2</span>)</span>
<span id="cb67-7"><a href="#cb67-7" aria-hidden="true" tabindex="-1"></a>true_vol <span class="op">=</span> np.sqrt(true_var)</span>
<span id="cb67-8"><a href="#cb67-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-9"><a href="#cb67-9" aria-hidden="true" tabindex="-1"></a>rand_vol <span class="op">=</span> np.array([np.std(t(nu, <span class="fl">0.</span>, <span class="fl">1.</span>).rvs(<span class="dv">50</span><span class="op">*</span><span class="dv">252</span>), ddof<span class="op">=</span><span class="dv">1</span>) <span class="cf">for</span> i <span class="kw">in</span> tqdm(<span class="bu">range</span>(n_sim))])</span>
<span id="cb67-10"><a href="#cb67-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-11"><a href="#cb67-11" aria-hidden="true" tabindex="-1"></a><span class="dv">100</span><span class="op">*</span>np.mean(np.<span class="bu">abs</span>(rand_vol <span class="op">-</span> true_vol))<span class="op">/</span>true_vol</span></code><button title="Копіювати" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>100%|██████████| 10000/10000 [00:13&lt;00:00, 728.17it/s]</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="45">
<pre><code>0.9616583563963519</code></pre>
</div>
</div>
<div class="cell" data-execution_count="46">
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a>n_sim <span class="op">=</span> <span class="dv">10000</span></span>
<span id="cb70-2"><a href="#cb70-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-3"><a href="#cb70-3" aria-hidden="true" tabindex="-1"></a>alpha <span class="op">=</span> <span class="fl">4.0</span></span>
<span id="cb70-4"><a href="#cb70-4" aria-hidden="true" tabindex="-1"></a>nu <span class="op">=</span> alpha <span class="op">-</span> <span class="dv">1</span></span>
<span id="cb70-5"><a href="#cb70-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-6"><a href="#cb70-6" aria-hidden="true" tabindex="-1"></a>true_var <span class="op">=</span> nu<span class="op">/</span>(nu<span class="op">-</span><span class="dv">2</span>)</span>
<span id="cb70-7"><a href="#cb70-7" aria-hidden="true" tabindex="-1"></a>true_vol <span class="op">=</span> np.sqrt(true_var)</span>
<span id="cb70-8"><a href="#cb70-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-9"><a href="#cb70-9" aria-hidden="true" tabindex="-1"></a>rand_vol <span class="op">=</span> np.array([np.std(t(nu, <span class="fl">0.</span>, <span class="fl">1.</span>).rvs(<span class="dv">50</span><span class="op">*</span><span class="dv">252</span>), ddof<span class="op">=</span><span class="dv">1</span>) <span class="cf">for</span> i <span class="kw">in</span> tqdm(<span class="bu">range</span>(n_sim))])</span>
<span id="cb70-10"><a href="#cb70-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-11"><a href="#cb70-11" aria-hidden="true" tabindex="-1"></a><span class="dv">100</span><span class="op">*</span>np.mean(np.<span class="bu">abs</span>(rand_vol <span class="op">-</span> true_vol))<span class="op">/</span>true_vol</span></code><button title="Копіювати" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>100%|██████████| 10000/10000 [00:14&lt;00:00, 700.76it/s]</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="46">
<pre><code>3.8082666425995932</code></pre>
</div>
</div>
<div class="cell" data-execution_count="47">
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a>n_sim <span class="op">=</span> <span class="dv">10000</span></span>
<span id="cb73-2"><a href="#cb73-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-3"><a href="#cb73-3" aria-hidden="true" tabindex="-1"></a>alpha <span class="op">=</span> <span class="fl">3.7</span></span>
<span id="cb73-4"><a href="#cb73-4" aria-hidden="true" tabindex="-1"></a>nu <span class="op">=</span> alpha <span class="op">-</span> <span class="dv">1</span></span>
<span id="cb73-5"><a href="#cb73-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-6"><a href="#cb73-6" aria-hidden="true" tabindex="-1"></a>true_var <span class="op">=</span> nu<span class="op">/</span>(nu<span class="op">-</span><span class="dv">2</span>)</span>
<span id="cb73-7"><a href="#cb73-7" aria-hidden="true" tabindex="-1"></a>true_vol <span class="op">=</span> np.sqrt(true_var)</span>
<span id="cb73-8"><a href="#cb73-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-9"><a href="#cb73-9" aria-hidden="true" tabindex="-1"></a>rand_vol <span class="op">=</span> np.array([np.std(t(nu, <span class="fl">0.</span>, <span class="fl">1.</span>).rvs(<span class="dv">50</span><span class="op">*</span><span class="dv">252</span>), ddof<span class="op">=</span><span class="dv">1</span>) <span class="cf">for</span> i <span class="kw">in</span> tqdm(<span class="bu">range</span>(n_sim))])</span>
<span id="cb73-10"><a href="#cb73-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-11"><a href="#cb73-11" aria-hidden="true" tabindex="-1"></a><span class="dv">100</span><span class="op">*</span>np.mean(np.<span class="bu">abs</span>(rand_vol <span class="op">-</span> true_vol))<span class="op">/</span>true_vol</span></code><button title="Копіювати" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>100%|██████████| 10000/10000 [00:14&lt;00:00, 709.36it/s]</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="47">
<pre><code>6.115969986022528</code></pre>
</div>
</div>
<div class="cell" data-execution_count="48">
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a>n_sim <span class="op">=</span> <span class="dv">10000</span></span>
<span id="cb76-2"><a href="#cb76-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-3"><a href="#cb76-3" aria-hidden="true" tabindex="-1"></a>alpha <span class="op">=</span> <span class="fl">3.1</span></span>
<span id="cb76-4"><a href="#cb76-4" aria-hidden="true" tabindex="-1"></a>nu <span class="op">=</span> alpha <span class="op">-</span> <span class="dv">1</span></span>
<span id="cb76-5"><a href="#cb76-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-6"><a href="#cb76-6" aria-hidden="true" tabindex="-1"></a>true_var <span class="op">=</span> nu<span class="op">/</span>(nu<span class="op">-</span><span class="dv">2</span>)</span>
<span id="cb76-7"><a href="#cb76-7" aria-hidden="true" tabindex="-1"></a>true_vol <span class="op">=</span> np.sqrt(true_var)</span>
<span id="cb76-8"><a href="#cb76-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-9"><a href="#cb76-9" aria-hidden="true" tabindex="-1"></a>rand_vol <span class="op">=</span> np.array([np.std(t(nu, <span class="fl">0.</span>, <span class="fl">1.</span>).rvs(<span class="dv">50</span><span class="op">*</span><span class="dv">252</span>), ddof<span class="op">=</span><span class="dv">1</span>) <span class="cf">for</span> i <span class="kw">in</span> tqdm(<span class="bu">range</span>(n_sim))])</span>
<span id="cb76-10"><a href="#cb76-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-11"><a href="#cb76-11" aria-hidden="true" tabindex="-1"></a><span class="dv">100</span><span class="op">*</span>np.mean(np.<span class="bu">abs</span>(rand_vol <span class="op">-</span> true_vol))<span class="op">/</span>true_vol</span></code><button title="Копіювати" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>100%|██████████| 10000/10000 [00:13&lt;00:00, 718.23it/s]</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="48">
<pre><code>38.47707859009605</code></pre>
</div>
</div>
<p>Ми отримуємо наступні відносні похибки для різних розподілів та їх параметрів: - Гаусовий розподіл; відн. похиб. <span class="math inline">\(\approx 0.5\%\)</span> - t-розподіл Стьюдента з <span class="math inline">\(\alpha=6.0\)</span> (<span class="math inline">\(\nu=5.0\)</span>); відн. похиб. <span class="math inline">\(\approx 1.0\%\)</span> - t-розподіл Стьюдента з <span class="math inline">\(\alpha=4.0\)</span> (<span class="math inline">\(\nu=3.0\)</span>); відн. похиб. <span class="math inline">\(\approx 3.8\%\)</span> - t-розподіл Стьюдента з <span class="math inline">\(\alpha=3.7\)</span> (<span class="math inline">\(\nu=2.7\)</span>); відн. похиб. <span class="math inline">\(\approx 6.1\%\)</span></p>
<p>При степеневому показнику <span class="math inline">\(\alpha= 3.7\)</span> (що відповідає <span class="math inline">\(\nu = 2.7\)</span>; як ми підрахували для S&amp;P 500, щоб пояснити Чорний понеділок), щоденна прибутковість за 50 років все ще призводить до помилки оцінки волатильності більш ніж на <span class="math inline">\(6%\)</span>! Зверніть увагу, що ця велика помилка оцінки зростатиме ще швидше, коли вона наближається до <span class="math inline">\(\alpha = 3.0\)</span>, оскільки дисперсія стає нескінченною для t-розподілу Стьюдента при <span class="math inline">\(\alpha = 3.0\)</span> (<span class="math inline">\(\nu = 2.0\)</span>). Виходячи з t-розподілу прибутковостей S&amp;P 500, похибка оцінки волатильності зросла в 12 разів (!) порівняно з тим, що ми очікували б, припускаючи, що прибутковості розподілені за Гаусом.</p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Примітка
</div>
</div>
<div class="callout-body-container callout-body">
<p>Чим важчі хвости розподілу прибутковостей, тим більше точок даних необхідно для досягнення необхідної достовірності оцінок певних параметрів. Пам’ятайте про це щоразу, коли ви намагаєтеся оцінити ризик інвестування у відносно новий фінансовий актив, який має дані лише за кілька років</p>
</div>
</div>
</section>
<section id="наслідки-для-моделювання-та-прогнозування" class="level3" data-number="12.1.9">
<h3 data-number="12.1.9" class="anchored" data-anchor-id="наслідки-для-моделювання-та-прогнозування"><span class="header-section-number">12.1.9</span> Наслідки для моделювання та прогнозування</h3>
<p>Той факт, що більш високі моменти розподілу прибутковості можуть бути нескінченними і що оцінка нижчих моментів, таких як дисперсія, дестабілізується за наявності “товстих хвостів”, має суттєві наслідки для деяких найбільш використовуваних моделей у фінансах. Ми коротко розглянемо дві з них, щоб проілюструвати проблему.</p>
</section>
<section id="марковіц-і-стабільність-волатильності" class="level3" data-number="12.1.10">
<h3 data-number="12.1.10" class="anchored" data-anchor-id="марковіц-і-стабільність-волатильності"><span class="header-section-number">12.1.10</span> Марковіц і стабільність волатильності</h3>
<p>У 1954 році <a href="https://en.wikipedia.org/wiki/Harry_Markowitz">Гаррі Марковіц</a> отримав ступінь доктора економічних наук за роботу з теорії фінансових портфелів. Його робота стала наріжним каменем <a href="https://en.wikipedia.org/wiki/Modern_portfolio_theory">сучасної портфельної теорії</a> і тоді це було настільки новим, що під час захисту докторської дисертації Мілтон Фрідман стверджував, що ця робота насправді не стосується галузі економіки (як пояснив Марковіц у своїй <a href="http://nobelprize.org/nobel_prizes/economics/laureates/1990/markowitz-lecture.html">Нобелівській лекції</a> у 1990 році). Марковіц стверджував, що при заданому рівні волатильності існує набір вагових коефіцієнтів розподілу активів у портфелі, які дають максимальну надлишкову прибутковість портфеля (порівняно з безризиковим активом). Якщо ви переглянете діапазон значень волатильності та обчислите максимальну віддачу портфеля, отримавши оптимальні ваги розподілу, Ви отримаєте набір <em>ефективних</em> портфелів, який також називають <a href="https://en.wikipedia.org/wiki/Efficient_frontier">межею ефективності</a>. Одна точка на цій межі в багатьох випадках представляє особливий інтерес, — це точка максимуму <a href="https://en.wikipedia.org/wiki/Sharpe_ratio">коефіцієнта Шарпа</a>.</p>
<p>Коефіцієнт Шарпа — це часто критикуваний, але також часто використовуваний показник для оцінки ефективності портфеля або фінансових активів загалом, таких як гедж-фонди або ETF. Він визначається як:</p>
<p><span class="math display">\[
S = \frac{\mu - \mu_{\text{rf}}}{\sigma}.
\]</span></p>
<p>Тут <span class="math inline">\(\mu\)</span> позначає річну прибутковість портфеля, <span class="math inline">\(\mu_{\text{rf}}\)</span> позначає річну безризикову прибутковість, а <span class="math inline">\(\sigma\)</span> позначає річну волатильність портфеля. Припускаючи нульову безризикову ставку (<span class="math inline">\(\mu_{\text{rf}} = 0\)</span>), коефіцієнт Шарпа можна інтерпретувати як <a href="https://en.wikipedia.org/wiki/Signal-to-noise_ratio">співвідношення сигнал/шум</a>, відомий у фізиці та інженерії: максимізуючи коефіцієнт Шарпа, ми знаходимо найкращий компромісне значення, що максимізує наші прибутковості (сигнал) та мінімізує волатильності (шум).</p>
<p>Якщо наш портфель складається з <span class="math inline">\(n\)</span> фінансових активів з очікуваною прибутковістю <span class="math inline">\(\vec{\mu} = (\mu_{1},...,\mu_{n})\)</span>, з коваріаційною матрицею <span class="math inline">\(\Sigma\)</span>, яка містить інформацію про волатильність і кореляції між активами, і з вектором ваги розподілу <span class="math inline">\(\vec{w} = (w_1,...,w_n)\)</span> (нормалізовано до одиниці: <span class="math inline">\(\sum_{i=1}^n w_i = 1\)</span>), тоді коефіцієнт Шарпа у контексті сучасної теорії портфеля можна обчислити наступним чином:</p>
<p><span class="math display">\[
S(\vec{w}) = \frac{\vec{w}\cdot\vec{\mu}}{\sqrt{\vec{w}\Sigma\vec{w}^T}}.
\]</span></p>
<p>Зверніть увагу, що з цього моменту ми завжди припускаємо, що <span class="math inline">\(\mu_{\text{rf}} = 0\)</span>.</p>
<p>Щоб максимізувати прибутковість відносно волатильності та отримати портфель з максимальним коефіцієнтом Шарпа, ми змінюємо ваги розподілу, поки не знайдемо набір ваг <span class="math inline">\(\vec{w}^*\)</span> з максимальним коефіцієнтом Шарпа:</p>
<p><span class="math display">\[
\vec{w}^* = \text{argmax}_{\vec{w}} ~ S(\vec{w})
\]</span></p>
<p>Основне припущення, що лежить в основі сучасної теорії портфеля, полягає в тому, що об’єднаний розподіл логарифмічних прибутковостей всіх активів у портфелі може бути повністю охарактеризований мультиваріативним розподілом Гауса. Після попередніх частин цієї лабораторної ми дуже добре розуміємо цю помилку, і сучасна теорія портфеля по праву зазнала жорсткої критики за відсутність врахування “важких хвостів”, наприклад, з боку Нассіма Талеба:</p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Нассім Талеб у <em>Чорний лебідь: Про (не)ймовірне в реальному житті</em> (ст. 277)
</div>
</div>
<div class="callout-body-container callout-body">
<p>Після краху фондового ринку (у 1987 році) вони нагородили двох теоретиків, Гаррі Марковіца та Вільяма Шарпа, які побудували прекрасні платонівські моделі на гаусовій основі, сприяючи тому, що називається сучасною теорією портфеля. Простіше кажучи, якщо ви видалите їх гаусові припущення і розглядаєте ціни як масштабо-інваріантні, у вас залишиться гаряче повітря. Нобелівський комітет міг би протестувати моделі Шарпа і Марковіца — вони працюють як шарлатанські ліки, що продаються в Інтернеті, — але ніхто в Стокгольмі, схоже, про це не подумав.</p>
</div>
</div>
<p>Тут ми просто хочемо проілюструвати наслідки припущення гаусовости, змоделювавши прибутковість двох гіпотетичних акцій і спробувавши знайти ваги розподілу по максимуму Шарпа. Як ми побачимо, великі хвости в модельованих розподілах прибутковостей вносять істотну невизначеність в розрахункові ваги розподілу — прямий наслідок нестабільності дисперсії.</p>
<p>Спочатку ми генеруємо випадкові числа з Гаусового розподілу, достатнього для моделювання щоденної прибутковості двох гіпотетичних акцій за 10 років. Ми присвоюємо їм різну позитивну очікувану прибутковість і волатильність. Для простоти ми припускаємо, що кореляція між двома активами є нульовою:</p>
<div class="cell" data-execution_count="49">
<div class="sourceCode cell-code" id="cb79"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a>np.random.seed(<span class="dv">1234</span>)</span>
<span id="cb79-2"><a href="#cb79-2" aria-hidden="true" tabindex="-1"></a>n_years <span class="op">=</span> <span class="dv">10</span></span>
<span id="cb79-3"><a href="#cb79-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-4"><a href="#cb79-4" aria-hidden="true" tabindex="-1"></a>log_ret_1 <span class="op">=</span> <span class="fl">0.0025</span><span class="op">*</span>norm.rvs(size<span class="op">=</span>n_years<span class="op">*</span><span class="dv">252</span>) <span class="op">+</span> <span class="fl">0.0005</span></span>
<span id="cb79-5"><a href="#cb79-5" aria-hidden="true" tabindex="-1"></a>log_ret_2 <span class="op">=</span> <span class="fl">0.0050</span><span class="op">*</span>norm.rvs(size<span class="op">=</span>n_years<span class="op">*</span><span class="dv">252</span>) <span class="op">+</span> <span class="fl">0.0010</span></span>
<span id="cb79-6"><a href="#cb79-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-7"><a href="#cb79-7" aria-hidden="true" tabindex="-1"></a>plt.figure()</span>
<span id="cb79-8"><a href="#cb79-8" aria-hidden="true" tabindex="-1"></a>plt.plot(np.exp(np.cumsum(log_ret_1)), label<span class="op">=</span><span class="st">'Акція 1'</span>)</span>
<span id="cb79-9"><a href="#cb79-9" aria-hidden="true" tabindex="-1"></a>plt.plot(np.exp(np.cumsum(log_ret_2)), label<span class="op">=</span><span class="st">'Акція 2'</span>)</span>
<span id="cb79-10"><a href="#cb79-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-11"><a href="#cb79-11" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Ціна акції'</span>)</span>
<span id="cb79-12"><a href="#cb79-12" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Торговий день'</span>)</span>
<span id="cb79-13"><a href="#cb79-13" aria-hidden="true" tabindex="-1"></a>plt.legend()</span>
<span id="cb79-14"><a href="#cb79-14" aria-hidden="true" tabindex="-1"></a>plt.yscale(<span class="st">'log'</span>)</span>
<span id="cb79-15"><a href="#cb79-15" aria-hidden="true" tabindex="-1"></a>plt.show()<span class="op">;</span></span></code><button title="Копіювати" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="lab_12_files/figure-html/cell-50-output-1.png" class="img-fluid"></p>
</div>
</div>
<p>Звичайно, насправді ми не знаємо <em>справжньої</em> очікуваної прибутковості або значень волатильності кореляцій між активами. Таким чином, ми повинні оцінити очікувану прибутковість за середнім значенням вибірки та матрицю коваріації за матрицею коваріації вибірки. Зверніть увагу, що існують більш складні способи оцінки цих параметрів на основі історичних даних, таких як <a href="http://www.ledoit.net/honey.pdf">оцінки усадки</a> для коваріаційної матриці або <a href="https://sci-hub.mksa.top/10.3905/jfi.1991.408013">моделі розподілу Блека-Літтермана</a>. Ці методи, безумовно, покращують вибіркові оцінки, але загальний недолік сучасної теорії портфеля через наявність “важких хвостів” залишається. Щоб вивчити та протестувати різні методи оптимізації портфеля, рекомендуємо розглянути бібліотеку <a href="https://pyportfolioopt.readthedocs.io/en/latest/index.html">PyPortfolioOpt</a>, що представляє собою добре задокументований пакет Python, який реалізує як основні, так і складні методи оптимізації портфеля та дозволяє легко тестувати ці методи на реальних даних. Поки ми дотримуємося вибіркових оцінок (і використовуємо коефіцієнт 252 — середню кількість торгових днів на рік для отримання очікуваної прибутковості в річному обчисленні і коваріації за щоденними оцінками):</p>
<div class="cell" data-execution_count="50">
<div class="sourceCode cell-code" id="cb80"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a>exp_returns <span class="op">=</span> np.array([np.mean(log_ret_1), np.mean(log_ret_2)])<span class="op">*</span><span class="dv">252</span></span>
<span id="cb80-2"><a href="#cb80-2" aria-hidden="true" tabindex="-1"></a>cov_matrix <span class="op">=</span> np.cov([log_ret_1, log_ret_2])<span class="op">*</span><span class="dv">252</span></span></code><button title="Копіювати" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Далі ми визначаємо функцію, яка приймає ваги розподілу кандидатів, розрахункову очікувану прибутковість і коваріаційну матрицю і виводить коефіцієнт Шарпа портфеля:</p>
<div class="cell" data-execution_count="51">
<div class="sourceCode cell-code" id="cb81"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> sharpe(weights, exp_returns, cov_matrix):</span>
<span id="cb81-2"><a href="#cb81-2" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> weights.dot(exp_returns) <span class="op">/</span> np.sqrt(weights.dot(cov_matrix).dot(weights.T))</span>
<span id="cb81-3"><a href="#cb81-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-4"><a href="#cb81-4" aria-hidden="true" tabindex="-1"></a>sharpe(np.array([<span class="fl">0.5</span>, <span class="fl">0.5</span>]), exp_returns, cov_matrix)</span></code><button title="Копіювати" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="51">
<pre><code>4.810679451759804</code></pre>
</div>
</div>
<p>Замість того, щоб використовувати реальний оптимізатор для пошуку ваг розподілу, які максимізують коефіцієнт Шарпа, ми просто переглядаємо всі можливі комбінації ваг з інтервалом <span class="math inline">\(1\%\)</span>. Звичайно, це розумний підхід лише для двох активів, і він швидко стає нерозв’язним, використовуючи більше двох активів.</p>
<div class="cell" data-execution_count="52">
<div class="sourceCode cell-code" id="cb83"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a>candidate_weights <span class="op">=</span> np.array([np.linspace(<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">101</span>), <span class="fl">1.</span> <span class="op">-</span> np.linspace(<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">101</span>)]).T</span>
<span id="cb83-2"><a href="#cb83-2" aria-hidden="true" tabindex="-1"></a>candidate_weights[:<span class="dv">5</span>]</span></code><button title="Копіювати" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="52">
<pre><code>array([[0.  , 1.  ],
       [0.01, 0.99],
       [0.02, 0.98],
       [0.03, 0.97],
       [0.04, 0.96]])</code></pre>
</div>
</div>
<p>Тепер ми можемо перебрати всі наші ваги-кандидати, обчислити коефіцієнт Шарпа портфеля для всіх з них, а потім вибрати оптимальний набір ваг.</p>
<div class="cell" data-execution_count="53">
<div class="sourceCode cell-code" id="cb85"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a>candidate_sharpe <span class="op">=</span> [sharpe(weights, exp_returns, cov_matrix) <span class="cf">for</span> weights <span class="kw">in</span> candidate_weights]</span>
<span id="cb85-2"><a href="#cb85-2" aria-hidden="true" tabindex="-1"></a>opt_weights <span class="op">=</span> candidate_weights[np.argmax(candidate_sharpe)]</span>
<span id="cb85-3"><a href="#cb85-3" aria-hidden="true" tabindex="-1"></a>opt_weights</span></code><button title="Копіювати" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="53">
<pre><code>array([0.7, 0.3])</code></pre>
</div>
</div>
<p>Щоб отримати уявлення про те, наскільки точно ми можемо оцінити ваги розподілу на основі гіпотетичної щоденної прибутковості за 10 років, ми зараз повторюємо цей експеримент, повторно генеруємо нові випадкові прибутковості, повторно оцінюємо очікувані прибутковості та матрицю коваріації та знаходимо оптимальні ваги. Ми робимо це 10000 разів. Зверніть увагу, що ми реєструємо лише першу вагу розподілу <span class="math inline">\(w_1\)</span> для кожного запуску без втрати інформації, оскільки друга вага безпосередньо випливає з нормалізації <span class="math inline">\(w_2 = 1 - w_1\)</span>.</p>
<div class="cell" data-execution_count="54">
<div class="sourceCode cell-code" id="cb87"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a>np.random.seed(<span class="dv">1234</span>)</span>
<span id="cb87-2"><a href="#cb87-2" aria-hidden="true" tabindex="-1"></a>opt_weight_gaussian <span class="op">=</span> []</span>
<span id="cb87-3"><a href="#cb87-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-4"><a href="#cb87-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> tqdm(<span class="bu">range</span>(<span class="dv">10000</span>)):</span>
<span id="cb87-5"><a href="#cb87-5" aria-hidden="true" tabindex="-1"></a>    log_ret_1 <span class="op">=</span> <span class="fl">0.0025</span><span class="op">*</span>norm.rvs(size<span class="op">=</span>n_years<span class="op">*</span><span class="dv">252</span>) <span class="op">+</span> <span class="fl">0.0005</span></span>
<span id="cb87-6"><a href="#cb87-6" aria-hidden="true" tabindex="-1"></a>    log_ret_2 <span class="op">=</span> <span class="fl">0.0050</span><span class="op">*</span>norm.rvs(size<span class="op">=</span>n_years<span class="op">*</span><span class="dv">252</span>) <span class="op">+</span> <span class="fl">0.0010</span></span>
<span id="cb87-7"><a href="#cb87-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-8"><a href="#cb87-8" aria-hidden="true" tabindex="-1"></a>    exp_returns <span class="op">=</span> [np.mean(log_ret_1), np.mean(log_ret_2)]</span>
<span id="cb87-9"><a href="#cb87-9" aria-hidden="true" tabindex="-1"></a>    cov_matrix <span class="op">=</span> np.cov([log_ret_1, log_ret_2])</span>
<span id="cb87-10"><a href="#cb87-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-11"><a href="#cb87-11" aria-hidden="true" tabindex="-1"></a>    candidate_sharpe <span class="op">=</span> [sharpe(weights, exp_returns, cov_matrix) <span class="cf">for</span> weights <span class="kw">in</span> candidate_weights]</span>
<span id="cb87-12"><a href="#cb87-12" aria-hidden="true" tabindex="-1"></a>    opt_weights <span class="op">=</span> candidate_weights[np.argmax(candidate_sharpe)]</span>
<span id="cb87-13"><a href="#cb87-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-14"><a href="#cb87-14" aria-hidden="true" tabindex="-1"></a>    opt_weight_gaussian.append(opt_weights[<span class="dv">0</span>])</span></code><button title="Копіювати" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>100%|██████████| 10000/10000 [00:07&lt;00:00, 1358.21it/s]</code></pre>
</div>
</div>
<p>Нарешті, ми можемо побудувати гістограму всіх 10000 значень, які ми отримуємо для <span class="math inline">\(w_1\)</span></p>
<div class="cell" data-execution_count="55">
<div class="sourceCode cell-code" id="cb89"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a>plt.figure()</span>
<span id="cb89-2"><a href="#cb89-2" aria-hidden="true" tabindex="-1"></a>plt.hist(opt_weight_gaussian, <span class="dv">10</span>, density<span class="op">=</span><span class="va">True</span>)<span class="op">;</span></span>
<span id="cb89-3"><a href="#cb89-3" aria-hidden="true" tabindex="-1"></a>plt.xlim([<span class="dv">0</span>, <span class="dv">1</span>])</span>
<span id="cb89-4"><a href="#cb89-4" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Вага $w_1$ для портфеля з максимальним коеф. Шарпа'</span>)</span>
<span id="cb89-5"><a href="#cb89-5" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Розп. ймов.'</span>)</span>
<span id="cb89-6"><a href="#cb89-6" aria-hidden="true" tabindex="-1"></a>plt.show()<span class="op">;</span></span></code><button title="Копіювати" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="lab_12_files/figure-html/cell-56-output-1.png" class="img-fluid"></p>
</div>
</div>
<p>Як ми бачимо, розподіл для першої акції коливається приблизно від <span class="math inline">\(60%\)</span> до <span class="math inline">\(70%\)</span> на основі історичних даних за 10 років. Ми можемо додатково оцінити це кількісно, обчисливши 5-й і 95-й процентилі всіх значень <span class="math inline">\(w_1\)</span>. Таким чином, з упевненістю в <span class="math inline">\(90%\)</span> ми отримаємо розподіл між <span class="math inline">\(61%\)</span> і <span class="math inline">\(72%\)</span>:</p>
<div class="cell" data-execution_count="56">
<div class="sourceCode cell-code" id="cb90"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb90-1"><a href="#cb90-1" aria-hidden="true" tabindex="-1"></a>np.percentile(opt_weight_gaussian, <span class="dv">5</span>), np.percentile(opt_weight_gaussian, <span class="dv">95</span>)</span></code><button title="Копіювати" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="56">
<pre><code>(0.61, 0.72)</code></pre>
</div>
</div>
<p>Тепер давайте повторимо цей експеримент, але цього разу ми замінимо розподіл Гауса на розподіл Стьюдента зі степеневим показником <span class="math inline">\(\alpha=3.7\)</span> (що відповідає кількості ступенів свободи <span class="math inline">\(\nu=2.7\)</span>). Ми залишаємо очікувану прибутковість і волатильність (виміряні стандартним відхиленням розподілу) точно такими ж. Зверніть увагу, що стандартне відхилення стандартного t-розподілу визначається як <span class="math inline">\(\sqrt{\frac{\nu}{\nu-2}}\)</span> в нашому випадку, тому ми повинні внести поправку на цей коефіцієнт маштабування при вилученні випадкових значень зі стандартного t-розподілу. Нижче ви можете побачити пряме порівняння розподілів Гауса, використаних у наведеному вище моделюванні, та t-розподілів із відповідним середнім значенням та стандартним відхиленням.</p>
<div class="cell" data-execution_count="57">
<div class="sourceCode cell-code" id="cb92"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb92-1"><a href="#cb92-1" aria-hidden="true" tabindex="-1"></a>scale_correction <span class="op">=</span> np.sqrt(<span class="fl">2.7</span><span class="op">/</span>(<span class="fl">2.7</span><span class="op">-</span><span class="fl">2.</span>))</span></code><button title="Копіювати" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="58">
<div class="sourceCode cell-code" id="cb93"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb93-1"><a href="#cb93-1" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> np.linspace(<span class="op">-</span><span class="fl">0.025</span>, <span class="fl">0.025</span>, <span class="dv">10000</span>)</span>
<span id="cb93-2"><a href="#cb93-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-3"><a href="#cb93-3" aria-hidden="true" tabindex="-1"></a>y1_norm <span class="op">=</span> norm(loc<span class="op">=</span><span class="fl">0.0005</span>, scale<span class="op">=</span><span class="fl">0.0025</span>).pdf(x)</span>
<span id="cb93-4"><a href="#cb93-4" aria-hidden="true" tabindex="-1"></a>y1_t <span class="op">=</span> t(loc<span class="op">=</span><span class="fl">0.0005</span>, scale<span class="op">=</span><span class="fl">0.0025</span><span class="op">/</span>scale_correction, df<span class="op">=</span><span class="fl">2.7</span>).pdf(x)</span>
<span id="cb93-5"><a href="#cb93-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-6"><a href="#cb93-6" aria-hidden="true" tabindex="-1"></a>y2_norm <span class="op">=</span> norm(loc<span class="op">=</span><span class="fl">0.001</span>, scale<span class="op">=</span><span class="fl">0.005</span>).pdf(x)</span>
<span id="cb93-7"><a href="#cb93-7" aria-hidden="true" tabindex="-1"></a>y2_t <span class="op">=</span> t(loc<span class="op">=</span><span class="fl">0.001</span>, scale<span class="op">=</span><span class="fl">0.005</span><span class="op">/</span>scale_correction, df<span class="op">=</span><span class="fl">2.7</span>).pdf(x)</span>
<span id="cb93-8"><a href="#cb93-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-9"><a href="#cb93-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-10"><a href="#cb93-10" aria-hidden="true" tabindex="-1"></a>plt.figure()</span>
<span id="cb93-11"><a href="#cb93-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-12"><a href="#cb93-12" aria-hidden="true" tabindex="-1"></a>plt.subplot(<span class="dv">121</span>)</span>
<span id="cb93-13"><a href="#cb93-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-14"><a href="#cb93-14" aria-hidden="true" tabindex="-1"></a>plt.fill_between(x, <span class="fl">0.</span>, y1_norm, facecolor<span class="op">=</span><span class="st">'C0'</span>, alpha<span class="op">=</span><span class="fl">0.7</span>)</span>
<span id="cb93-15"><a href="#cb93-15" aria-hidden="true" tabindex="-1"></a>plt.fill_between(x, <span class="fl">0.</span>, y1_t, facecolor<span class="op">=</span><span class="st">'C3'</span>, alpha<span class="op">=</span><span class="fl">0.5</span>)</span>
<span id="cb93-16"><a href="#cb93-16" aria-hidden="true" tabindex="-1"></a>plt.ylim([<span class="dv">0</span>, <span class="dv">300</span>])</span>
<span id="cb93-17"><a href="#cb93-17" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Розп. ймов.'</span>)</span>
<span id="cb93-18"><a href="#cb93-18" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Акція 1'</span>)</span>
<span id="cb93-19"><a href="#cb93-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-20"><a href="#cb93-20" aria-hidden="true" tabindex="-1"></a>plt.subplot(<span class="dv">122</span>)</span>
<span id="cb93-21"><a href="#cb93-21" aria-hidden="true" tabindex="-1"></a>plt.fill_between(x, <span class="fl">0.</span>, y2_norm, facecolor<span class="op">=</span><span class="st">'C0'</span>, alpha<span class="op">=</span><span class="fl">0.7</span>, label<span class="op">=</span><span class="st">'Гаус'</span>)</span>
<span id="cb93-22"><a href="#cb93-22" aria-hidden="true" tabindex="-1"></a>plt.fill_between(x, <span class="fl">0.</span>, y2_t, facecolor<span class="op">=</span><span class="st">'C3'</span>, alpha<span class="op">=</span><span class="fl">0.5</span>, label<span class="op">=</span><span class="st">"Стьюдент"</span>)</span>
<span id="cb93-23"><a href="#cb93-23" aria-hidden="true" tabindex="-1"></a>plt.ylim([<span class="dv">0</span>, <span class="dv">300</span>])</span>
<span id="cb93-24"><a href="#cb93-24" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Розп. ймов.'</span>)</span>
<span id="cb93-25"><a href="#cb93-25" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Акція 2'</span>)</span>
<span id="cb93-26"><a href="#cb93-26" aria-hidden="true" tabindex="-1"></a>plt.legend()</span>
<span id="cb93-27"><a href="#cb93-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-28"><a href="#cb93-28" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb93-29"><a href="#cb93-29" aria-hidden="true" tabindex="-1"></a>plt.show()<span class="op">;</span> </span></code><button title="Копіювати" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="lab_12_files/figure-html/cell-59-output-1.png" class="img-fluid"></p>
</div>
</div>
<p>Як ми можемо легко бачити, узгоджені t-розподіли Стьюдента насправді дають менші значення прибутковостей. Однак вони також дають набагато більш екстремальні значення, але ми не можемо легко побачити це, оскільки значення щільності ймовірності в хвостах дуже малі! Якщо ми перейдемо до логарифмічного масштабування вісі Oy, картина стане більш чіткою:</p>
<div class="cell" data-execution_count="59">
<div class="sourceCode cell-code" id="cb94"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb94-1"><a href="#cb94-1" aria-hidden="true" tabindex="-1"></a>plt.figure()</span>
<span id="cb94-2"><a href="#cb94-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-3"><a href="#cb94-3" aria-hidden="true" tabindex="-1"></a>plt.subplot(<span class="dv">121</span>)</span>
<span id="cb94-4"><a href="#cb94-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-5"><a href="#cb94-5" aria-hidden="true" tabindex="-1"></a>plt.plot(x, y1_norm, c<span class="op">=</span><span class="st">'C0'</span>, lw<span class="op">=</span><span class="dv">3</span>)</span>
<span id="cb94-6"><a href="#cb94-6" aria-hidden="true" tabindex="-1"></a>plt.plot(x, y1_t, c<span class="op">=</span><span class="st">'C3'</span>, lw<span class="op">=</span><span class="dv">3</span>)</span>
<span id="cb94-7"><a href="#cb94-7" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Розп. ймов.'</span>)</span>
<span id="cb94-8"><a href="#cb94-8" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Акція 1'</span>)</span>
<span id="cb94-9"><a href="#cb94-9" aria-hidden="true" tabindex="-1"></a>plt.yscale(<span class="st">'log'</span>)</span>
<span id="cb94-10"><a href="#cb94-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-11"><a href="#cb94-11" aria-hidden="true" tabindex="-1"></a>plt.subplot(<span class="dv">122</span>)</span>
<span id="cb94-12"><a href="#cb94-12" aria-hidden="true" tabindex="-1"></a>plt.plot(x, y2_norm, c<span class="op">=</span><span class="st">'C0'</span>, lw<span class="op">=</span><span class="dv">3</span>, label<span class="op">=</span><span class="st">'Гаус'</span>)</span>
<span id="cb94-13"><a href="#cb94-13" aria-hidden="true" tabindex="-1"></a>plt.plot(x, y2_t, c<span class="op">=</span><span class="st">'C3'</span>, lw<span class="op">=</span><span class="dv">3</span>, label<span class="op">=</span><span class="st">"Стьюдент"</span>)</span>
<span id="cb94-14"><a href="#cb94-14" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Розп. ймов.'</span>)</span>
<span id="cb94-15"><a href="#cb94-15" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Акція 2'</span>)</span>
<span id="cb94-16"><a href="#cb94-16" aria-hidden="true" tabindex="-1"></a>plt.yscale(<span class="st">'log'</span>)</span>
<span id="cb94-17"><a href="#cb94-17" aria-hidden="true" tabindex="-1"></a>plt.legend()</span>
<span id="cb94-18"><a href="#cb94-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-19"><a href="#cb94-19" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb94-20"><a href="#cb94-20" aria-hidden="true" tabindex="-1"></a>plt.show()<span class="op">;</span></span></code><button title="Копіювати" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="lab_12_files/figure-html/cell-60-output-1.png" class="img-fluid"></p>
</div>
</div>
<p>Тепер ми чітко бачимо, що, наприклад, ймовірність щоденних логарифмічних прибутковостей <span class="math inline">\(-0.02\)</span> для акції 1 в <span class="math inline">\(10^{10}\)</span> разів вища за умови t-розподілу порівняно з відповідним розподілом Гауса! Завжди дивіться на розподіли з логарифмічною шкалою щільності ймовірності, щоб отримати чітке уявлення про хвости. Використовуючи наші узгоджені t-розподіли, ми діємо, як і раніше, і моделюємо гіпотетичні 10-річні історичні показники для наших двох некорельованих акцій. Нижче ви можете побачити приклад. Тільки при уважному розгляді ви можете помітити, що ці криві сукупної прибутковості насправді трохи більш нерівні в порівнянні з тими, які були побудовані вище з гаусовими прибутковостями. Але різниця невловима, якщо дивитися на таку “наближену” діаграму десятирічного періоду:</p>
<div class="cell" data-execution_count="60">
<div class="sourceCode cell-code" id="cb95"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb95-1"><a href="#cb95-1" aria-hidden="true" tabindex="-1"></a>np.random.seed(<span class="dv">1234</span>)</span>
<span id="cb95-2"><a href="#cb95-2" aria-hidden="true" tabindex="-1"></a>n_years <span class="op">=</span> <span class="dv">10</span></span>
<span id="cb95-3"><a href="#cb95-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-4"><a href="#cb95-4" aria-hidden="true" tabindex="-1"></a>log_ret_1 <span class="op">=</span> (<span class="fl">0.0025</span><span class="op">/</span>scale_correction)<span class="op">*</span>t.rvs(df<span class="op">=</span><span class="fl">2.7</span>, size<span class="op">=</span>n_years<span class="op">*</span><span class="dv">252</span>) <span class="op">+</span> <span class="fl">0.0005</span></span>
<span id="cb95-5"><a href="#cb95-5" aria-hidden="true" tabindex="-1"></a>log_ret_2 <span class="op">=</span> (<span class="fl">0.0050</span><span class="op">/</span>scale_correction)<span class="op">*</span>t.rvs(df<span class="op">=</span><span class="fl">2.7</span>, size<span class="op">=</span>n_years<span class="op">*</span><span class="dv">252</span>) <span class="op">+</span> <span class="fl">0.0010</span></span>
<span id="cb95-6"><a href="#cb95-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-7"><a href="#cb95-7" aria-hidden="true" tabindex="-1"></a>plt.figure()</span>
<span id="cb95-8"><a href="#cb95-8" aria-hidden="true" tabindex="-1"></a>plt.plot(np.exp(np.cumsum(log_ret_1)), label<span class="op">=</span><span class="st">'Акція 1'</span>)</span>
<span id="cb95-9"><a href="#cb95-9" aria-hidden="true" tabindex="-1"></a>plt.plot(np.exp(np.cumsum(log_ret_2)), label<span class="op">=</span><span class="st">'Акція 2'</span>)</span>
<span id="cb95-10"><a href="#cb95-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-11"><a href="#cb95-11" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Ціна акції'</span>)</span>
<span id="cb95-12"><a href="#cb95-12" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Торговий день'</span>)</span>
<span id="cb95-13"><a href="#cb95-13" aria-hidden="true" tabindex="-1"></a>plt.legend()</span>
<span id="cb95-14"><a href="#cb95-14" aria-hidden="true" tabindex="-1"></a>plt.yscale(<span class="st">'log'</span>)</span>
<span id="cb95-15"><a href="#cb95-15" aria-hidden="true" tabindex="-1"></a>plt.show()<span class="op">;</span></span></code><button title="Копіювати" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="lab_12_files/figure-html/cell-61-output-1.png" class="img-fluid"></p>
</div>
</div>
<p>Нарешті, щоб візуалізувати вплив t-розподілу на оцінку ваги розподілу, ми повторюємо наш експеримент Монте-Карло з моделювання 10000 різних 10-річних історичних значень та оцінюємо ваги розподілу в кожному з цих 10000 випадків. Потім ми будуємо графік розподілу <span class="math inline">\(w_1\)</span> і порівнюємо цей розподіл з розподілом, отриманим в результаті моделювання на основі Гауса.</p>
<div class="cell" data-execution_count="61">
<div class="sourceCode cell-code" id="cb96"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb96-1"><a href="#cb96-1" aria-hidden="true" tabindex="-1"></a>np.random.seed(<span class="dv">1234</span>)</span>
<span id="cb96-2"><a href="#cb96-2" aria-hidden="true" tabindex="-1"></a>opt_weight_t <span class="op">=</span> []</span>
<span id="cb96-3"><a href="#cb96-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-4"><a href="#cb96-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> tqdm(<span class="bu">range</span>(<span class="dv">10000</span>)):</span>
<span id="cb96-5"><a href="#cb96-5" aria-hidden="true" tabindex="-1"></a>    log_ret_1 <span class="op">=</span> (<span class="fl">0.0025</span><span class="op">/</span>scale_correction)<span class="op">*</span>t.rvs(df<span class="op">=</span><span class="fl">2.7</span>, size<span class="op">=</span>n_years<span class="op">*</span><span class="dv">252</span>) <span class="op">+</span> <span class="fl">0.0005</span></span>
<span id="cb96-6"><a href="#cb96-6" aria-hidden="true" tabindex="-1"></a>    log_ret_2 <span class="op">=</span> (<span class="fl">0.0050</span><span class="op">/</span>scale_correction)<span class="op">*</span>t.rvs(df<span class="op">=</span><span class="fl">2.7</span>, size<span class="op">=</span>n_years<span class="op">*</span><span class="dv">252</span>) <span class="op">+</span> <span class="fl">0.0010</span></span>
<span id="cb96-7"><a href="#cb96-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-8"><a href="#cb96-8" aria-hidden="true" tabindex="-1"></a>    exp_returns <span class="op">=</span> [np.mean(log_ret_1), np.mean(log_ret_2)]</span>
<span id="cb96-9"><a href="#cb96-9" aria-hidden="true" tabindex="-1"></a>    cov_matrix <span class="op">=</span> np.cov([log_ret_1, log_ret_2])</span>
<span id="cb96-10"><a href="#cb96-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-11"><a href="#cb96-11" aria-hidden="true" tabindex="-1"></a>    candidate_sharpe <span class="op">=</span> [sharpe(weights, exp_returns, cov_matrix) <span class="cf">for</span> weights <span class="kw">in</span> candidate_weights]</span>
<span id="cb96-12"><a href="#cb96-12" aria-hidden="true" tabindex="-1"></a>    opt_weights <span class="op">=</span> candidate_weights[np.argmax(candidate_sharpe)]</span>
<span id="cb96-13"><a href="#cb96-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-14"><a href="#cb96-14" aria-hidden="true" tabindex="-1"></a>    opt_weight_t.append(opt_weights[<span class="dv">0</span>])</span></code><button title="Копіювати" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>100%|██████████| 10000/10000 [00:09&lt;00:00, 1037.43it/s]</code></pre>
</div>
</div>
<div class="cell" data-execution_count="62">
<div class="sourceCode cell-code" id="cb98"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb98-1"><a href="#cb98-1" aria-hidden="true" tabindex="-1"></a>plt.figure()</span>
<span id="cb98-2"><a href="#cb98-2" aria-hidden="true" tabindex="-1"></a>plt.hist(opt_weight_gaussian, <span class="dv">10</span>, alpha<span class="op">=</span><span class="fl">0.8</span>, density<span class="op">=</span><span class="va">True</span>, label<span class="op">=</span><span class="st">'Гаусові прибутковості'</span>)</span>
<span id="cb98-3"><a href="#cb98-3" aria-hidden="true" tabindex="-1"></a>plt.hist(opt_weight_t, <span class="dv">20</span>, alpha<span class="op">=</span><span class="fl">0.8</span>, density<span class="op">=</span><span class="va">True</span>, label<span class="op">=</span><span class="st">"Прибутковості Стьюдента"</span>)</span>
<span id="cb98-4"><a href="#cb98-4" aria-hidden="true" tabindex="-1"></a>plt.xlim([<span class="dv">0</span>, <span class="dv">1</span>])</span>
<span id="cb98-5"><a href="#cb98-5" aria-hidden="true" tabindex="-1"></a>plt.legend()</span>
<span id="cb98-6"><a href="#cb98-6" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Вага $w_1$ для портфеля з максимальним коеф. Шарпа'</span>)</span>
<span id="cb98-7"><a href="#cb98-7" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Розп. ймов.'</span>)</span>
<span id="cb98-8"><a href="#cb98-8" aria-hidden="true" tabindex="-1"></a>plt.show()<span class="op">;</span></span></code><button title="Копіювати" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="lab_12_files/figure-html/cell-63-output-1.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution_count="63">
<div class="sourceCode cell-code" id="cb99"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb99-1"><a href="#cb99-1" aria-hidden="true" tabindex="-1"></a>np.percentile(opt_weight_t, <span class="dv">5</span>), np.percentile(opt_weight_t, <span class="dv">95</span>)</span></code><button title="Копіювати" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="63">
<pre><code>(0.54, 0.77)</code></pre>
</div>
</div>
<p>Як ми можемо бачити, оптимальна вага розподілу <span class="math inline">\(w_1\)</span> тепер коливається між <span class="math inline">\(54\%\)</span> і <span class="math inline">\(77\%\)</span>, що приблизно в 2 рази перевищує ширину надійного інтервалу для оптимізації портфеля, яка дотримувалася припущення про гаусовість! Навіть при узгодженому стандартному відхиленні гаусового і t-розподілу, нескінченний ексцес t-розподілу дестабілізує вибіркову дисперсію наших змодельованих прибутковостей і, таким чином, знижує точність наших оціночних ваг розподілу. Хоча цей приклад, безумовно, не розкриває всіх слабкостей сучасної теорії портфеля, він допомагає нам побачити, як досить абстрактні ефекти, такі як нестабільність дисперсії через надмірний ексцес, в кінцевому результаті псують широко використовувані фінансові моделі. Використання модельованої прибутковості, заснованої на гаусовому розподілі порівняно з розподілом з великим хвостом, може допомогти виявити обмеження фінансових моделей або знайти мінімальний обсяг даних, необхідний для досягнення певної достовірності, перш ніж нова модель буде фактично запущена у виробництво!</p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Примітка
</div>
</div>
<div class="callout-body-container callout-body">
<p>Важкі хвости розподілу прибутковостей можуть сильно вплинути на результати усталених математичних моделей у фінансах, або збільшуючи невизначеність параметрів (як у сучасній теорії портфеля), або приводячи до збоїв моделей поза вибірки через нескінченно великі моменти. У фінансах краще екстраполювати частоту екстремальних подій і готуватися до них за допомогою конкретних інструментів геджування, ніж намагатися передбачити майбутню прибутковість за допомогою моделей часових рядів!</p>
</div>
</div>
</section>
<section id="розподіл-леві" class="level3" data-number="12.1.11">
<h3 data-number="12.1.11" class="anchored" data-anchor-id="розподіл-леві"><span class="header-section-number">12.1.11</span> Розподіл Леві</h3>
<p>Альфа-стабільний розподіл є узагальненням розподілу Гауса, яке цінується за те, що воно тягне за собою жирні хвости. З цієї причини він широко використовується при обробці сигналів, наприклад, у медицині чи фінансах.</p>
<p>Загальний клас стабільних розподілів був введений і отримав цю назву французьким математиком Полем Леві на початку 1920-х років.</p>
<p>Раніше ця тема привертала лише помірну увагу провідних експертів, хоча були і ентузіасти, з яких можна згадати російського математика Олександра Яковича Хінчіна. Натхненням для Леві стало бажання узагальнити відому центральну граничну теорему, згідно з якою будь-який розподіл ймовірностей з кінцевою дисперсією збігається до гауссового розподілу.</p>
<p>Стабільні розподіли мають три виняткові властивості, які можна коротко підсумувати, заявляючи, що вони:</p>
<ul>
<li>інваріантні при додаванні;</li>
<li>мають власну область збіжності;</li>
<li>дозволяють канонічну форму характеристичної функції.</li>
</ul>
<section id="інваріантність-при-додавані" class="level4" data-number="12.1.11.1">
<h4 data-number="12.1.11.1" class="anchored" data-anchor-id="інваріантність-при-додавані"><span class="header-section-number">12.1.11.1</span> Інваріантність при додавані</h4>
<p><em>Випадкова величина <span class="math inline">\(X\)</span> підпорядковується стабільному розподілу <span class="math inline">\(P(x) = \text{Prob}\{X \leq x\}\)</span> якщо для будь-якого <span class="math inline">\(n \geq 2\)</span> існують додатнє значення <span class="math inline">\(c_{n}\)</span> та дійсне значення <span class="math inline">\(d_{n}\)</span> такі, що</em></p>
<p><span class="math display">\[
X_1 + X_2 + ... + X_n \stackrel{d}{=} c_{n}X + d_{n},
\]</span></p>
<p><em>де <span class="math inline">\(X_1, X_2, ..., X_n\)</span> характеризуються як незалежні, ідентично розподілені випадкові величини.</em> Також <span class="math inline">\(\stackrel{d}{=}\)</span> позначає <em>рівність розподілів</em>, тобто, випадкові величини з обох сторін мають однаковий розподіл ймовірностей.</p>
<p>Загалом, сума незалежних, ідентично розподілених випадкових величин результує у випадкову величину з іншим розподілом. Однак, для випадкових величин, що характеризуються <em>стабільним</em> розподілом, сума ідентично розподілених випадкових величин до величини такого самого розподілу. У цьому випадку результуюча випадкова величина (розподіл) може відрізнятися від попередніх величин характерним масштабом (<span class="math inline">\(c_{n}\)</span>) та зміщенням (<span class="math inline">\(d_{n}\)</span>). Якщо <span class="math inline">\(d_{n} = 0\)</span>, розподіл називається <em>строго стабільним</em>.</p>
<p>Відомо, що нормована константа <span class="math inline">\(c_{n}\)</span> має вид</p>
<p><span class="math display">\[
c_{n} = n^{1/\alpha} \, \text{with} \, 0 &lt; \alpha \leq 2.
\]</span></p>
<p>Параметр <span class="math inline">\(\alpha\)</span> має назву <em>характеристична експонента</em> або <em>індекс стабільності</em> стабільного розподілу.</p>
<p>Попередня теорема має альтернативну версію, що включає в суму лише дві випадкові величини. <em>Випадкова величина <span class="math inline">\(X\)</span> підпорядковується стабільному розподілу, якщо для будь-яких позитивних значень <span class="math inline">\(A\)</span> та <span class="math inline">\(B\)</span> існує позитивне число <span class="math inline">\(C\)</span> та дійсне число <span class="math inline">\(D\)</span> такі, що</em></p>
<p><span class="math display">\[
A X_1 + B X_2 \stackrel{d}{=} C X + D,
\]</span></p>
<p><em>де <span class="math inline">\(X_1\)</span> та <span class="math inline">\(X_2\)</span> незалежні копії <span class="math inline">\(X\)</span></em>. Тоді існує значення <span class="math inline">\(\alpha \in (0, 2]\)</span> при яких значення <span class="math inline">\(C\)</span> задовільняє рівність <span class="math inline">\(C^{\alpha} = A^{\alpha} + B^{\alpha}\)</span>.</p>
<p>Для строго стабільних розподілів <span class="math inline">\(D = 0\)</span>. Це означає, що всі лінійні комбінації випадкових незалежних, ідентично розподілених випадкових величин, що підкоряються строго стабільному розподілу, результують у випадкову величину з одним і тим же типом розподілу.</p>
<p>Стабільний розподіл вважається <em>симетричним</em>, якщо випадкова величина <span class="math inline">\(-X\)</span> має такий самий тип розподілу. <em>Симетричний</em> стабільний розподіл обов’язково <em>строго стабільний</em>.</p>
<p>Оскільки аналітичний вираз функції щільності ймовірностей для стабільного розподілу невідома, за винятком кількох членів стабільного сімейства, більшість традиційних методів математичної статистики не можуть бути використані. Відбовідними вийнятками є</p>
<ul>
<li><strong>Гаусовий розподіл</strong> <span class="math inline">\(S_2(0,\mu, \sigma) = \mathcal{N}(\mu, 2\sigma^2)\)</span>. Гаусовий розподіл є спеціальним випадком стабільного розподілу при <span class="math inline">\(\alpha = 2\)</span> так що <span class="math inline">\(\mathcal{N}(\mu, \sigma) = S(2,0,\mu, \frac{\sigma}{\sqrt{2}})\)</span>, де <span class="math inline">\(\mu\)</span> позначає середнє значення нормального розподілу, а <span class="math inline">\(\sigma\)</span> — це стандартне відхилення. Функція щільності ймовірностей має вид</li>
</ul>
<p><span class="math display">\[
\frac{1}{\sigma\sqrt{2\pi}}\text{exp}^{-(x-\mu)^{2}/2\sigma^{2}}.
\]</span></p>
<ul>
<li><strong>Розподіл Коші</strong>. Розподіл Коші — це ще одне представлення стабільного розподілу при <span class="math inline">\(\alpha = 1\)</span> та <span class="math inline">\(\beta = 0\)</span> такими, що <span class="math inline">\(Cauchy(\delta, \gamma) = S_1(1,0,\gamma,\delta)\)</span>, де <span class="math inline">\(\gamma\)</span> — це параметр масштабування, а <span class="math inline">\(\delta\)</span> — це параметр зсуву розподілу Коші. Функція щільності ймовірностей представлена як:</li>
</ul>
<p><span class="math display">\[
\frac{\gamma}{\pi((x-\delta)^2 + \gamma^2)}, \, -\infty &lt; x &lt; \infty.
\]</span></p>
<ul>
<li><strong>Розподіл Леві</strong> також є вийнятком із класу стабільних розподілів, де <span class="math inline">\(\alpha = 0.5\)</span> і <span class="math inline">\(\beta = 1\)</span>. Іншими словами, <span class="math inline">\(Levy(\delta, \gamma) = S_{1/2}(0.5, 1, \gamma, \delta)\)</span>. Функція щільності ймовірностей має вид</li>
</ul>
<p><span class="math display">\[
\sqrt{\frac{\gamma}{2\pi}}\frac{1}{(x-\delta)^{3/2}}\exp{\left[ \frac{-\gamma}{2(x-\delta)} \right]}, \, \delta &lt; x &lt; \infty.
\]</span></p>
<p>Якщо <span class="math inline">\(X \sim S_{1/2}(0.5, 1, \gamma, \delta)\)</span>, тоді для <span class="math inline">\(x &gt; 0\)</span></p>
<p><span class="math display">\[
P(X \leq x) = 2 \left( 1 - \phi \left( \sqrt{\frac{\gamma}{x}} \right) \right),
\]</span></p>
<p>де <span class="math inline">\(\phi\)</span> позначає кумулятивну функцію нормального розподілу.</p>
</section>
<section id="область-збіжності" class="level4" data-number="12.1.11.2">
<h4 data-number="12.1.11.2" class="anchored" data-anchor-id="область-збіжності"><span class="header-section-number">12.1.11.2</span> Область збіжності</h4>
<p>Інше (еквівалентне) визначення стверджує, що стабільні розподіли — це єдині розподіли, які можна отримати при границі нормалізованих сум незалежних, ідентично розподілених випадкових величин. Кажуть, що випадкова величина <span class="math inline">\(X\)</span> має область збіжності, тобто якщо існує послідовність незалежних, ідентично розподілених випадкових величин <span class="math inline">\(Y_1, Y_2, ...\)</span> і послідовності позитивних чисел <span class="math inline">\({\gamma_n}\)</span> і дійсних чисел <span class="math inline">\({\delta_n}\)</span> таких, що</p>
<p><span class="math display">\[  
\frac{Y_1 + Y_2 + ... + Y_n}{\gamma_n} + \delta_n \stackrel{d}{\Rightarrow} X.  
\]</span></p>
<p>Коли <span class="math inline">\(X\)</span> це гаусова випадкова величина, а <span class="math inline">\(Y_i's\)</span> є незалежними, ідентично розподіленими випадковими величинами з визначенною дисперсією, тоді рівняння вище є твердженням звичайної <em>центральної граничної теореми</em>. Область збіжності <span class="math inline">\(X\)</span> вважається <em>нормальною</em> коли <span class="math inline">\(\gamma_n = n^{1/\alpha}\)</span>.</p>
</section>
<section id="канонічні-представлення-характеристичної-функції" class="level4" data-number="12.1.11.3">
<h4 data-number="12.1.11.3" class="anchored" data-anchor-id="канонічні-представлення-характеристичної-функції"><span class="header-section-number">12.1.11.3</span> Канонічні представлення характеристичної функції</h4>
<p>Чотири параметри використовуються для опису випадкової величини, що слідує за стабільним розподілом: <span class="math inline">\(X \sim S(\alpha, \beta, \mu, \gamma)\)</span>. Параметр <span class="math inline">\(\alpha \in (0, 2]\)</span> — це той, який нас найбільше зацікавить. Цей параметр визначає товщину хвостів. Параметр <span class="math inline">\(\beta \in [-1, 1]\)</span> є параметром асиметрії. Останні два параметри позначають розташування <span class="math inline">\((\mu \in \Re)\)</span> і масштаб <span class="math inline">\((\gamma &gt; 0)\)</span> розподілу. Альфа-стабільний розподіл немає жодного аналітичного виразу для щільності ймовірності <span class="math inline">\(X\)</span>, але ми можемо охарактеризувати його характеристичною функцією:</p>
<p><span class="math display">\[
    \begin{split}
    \phi(t) &amp;= E\left[\exp(itX)\right] \\
            &amp;=
        \begin{cases}
            \exp\left(i \mu t - \gamma^{\alpha}|t|^{\alpha} \left[1-i\beta\text{sign}(t)\tan{\frac{\pi\alpha}{2}}\right]\right) &amp; \text{якщо} \,\, \alpha \neq 1 \\ \exp\left(i \mu t - \gamma|t| \left[1+i\beta\text{sign}(t)\frac{2}{\pi}\log{|t|}\right]\right) &amp; \text{якщо} \,\, \alpha = 1.
        \end{cases}
    \end{split}
\]</span></p>
<p>Ми могли б використовувати перетворення Фур’є, щоб отримати функцію щільності розподілу ймовірностей з характеристичної функції:</p>
<p><span class="math display">\[
f(x) = \frac{1}{2\pi}\int_{-\infty}^{+\infty} \phi(t) \cdot \exp(-itX) dt.
\]</span></p>
<p>Але наведена вище параметризація не є повністю задовільною, оскільки функція щільності розподілу ймовірностей не є безперервною, зокрема, при <span class="math inline">\(\alpha = 1\)</span>. Дійсно, коли <span class="math inline">\(\beta &gt; 0\)</span>, щільність розподілу зміщується вправо, коли <span class="math inline">\(\alpha &lt; 1\)</span> і вліво, коли <span class="math inline">\(\alpha &gt; 1\)</span>, зі зсувом в сторону <span class="math inline">\(+\infty\)</span> (відповідно <span class="math inline">\(-\infty\)</span>), коли <span class="math inline">\(\alpha\)</span> прагне до 1. Таким чином, для прикладного аналізу даних та інтерпретації коефіцієнтів слід уникати такої параметризації.</p>
<p>Існує багато параметризацій для стабільних законів, і ці різні параметризації викликали велику плутанину. Різноманітність параметризацій обумовлена поєднанням історичної еволюції плюс численними проблемами, які були проаналізовані за допомогою спеціалізованих форм стабільного розподілу. Є вагомі причини використовувати різні параметризації в різних ситуаціях. Якщо в пріорітеті чисельні розрахунки, робота із даними, то краще використовувати одну параметризацію. Якщо бажані прості алгебраїчні властивості розподілу або аналітичні властивості строго стійких законів, то краще розглянути декілька параметризацій. Нолан запропонував використовувати параметризацію Золотарьова (M), яку також часто позначають як <span class="math inline">\(S^{0}\)</span>. Характеристична функція, що відповідає <span class="math inline">\(X \sim S^{0}(\alpha, \beta, \mu_{0}, \gamma)\)</span>, дорівнює:</p>
<p><span class="math display">\[
    \begin{split}
    \phi(t) &amp;= E\left[\exp(itX)\right] \\
            &amp;=
        \begin{cases}
            \exp\left(i \mu_{0} t - \gamma^{\alpha}|t|^{\alpha} \left[1+i\beta\text{sign}(t)\tan{\frac{\pi\alpha}{2}}\left( \gamma^{1-\alpha}|t|^{1-\alpha}-1 \right)\right]\right) &amp; \text{якщо} \,\, \alpha \neq 1 \\ \exp\left(i \mu_{0} t - \gamma|t| \left[1+i\beta\text{sign}(t)\frac{2}{\pi}\left(\log{|t|} + \log{\gamma}\right) \right]\right) &amp; \text{якщо} \,\, \alpha = 1.
        \end{cases}
    \end{split}
\]</span></p>
<p>Ця альтернативна параметризація недалека від зазначеної напочатку. Єдина відмінність стосується параметра <span class="math inline">\(\mu\)</span>, який у даній параметризації коригує зсув для значень <span class="math inline">\(\alpha\)</span> близьких до 1:</p>
<p><span class="math display">\[
\mu_{0} = \begin{cases} \mu + \beta\gamma\tan{\frac{\pi\alpha}{2}} &amp; \text{if} \, \alpha \neq 1 \\ \mu + \beta\frac{2}{\pi}\gamma\log{\gamma} &amp; \text{якщо} \,\, \alpha = 1. \end{cases}
\]</span></p>
</section>
<section id="метод-розрахунку-параметрів-alpha-стабільного-розподілу" class="level4" data-number="12.1.11.4">
<h4 data-number="12.1.11.4" class="anchored" data-anchor-id="метод-розрахунку-параметрів-alpha-стабільного-розподілу"><span class="header-section-number">12.1.11.4</span> Метод розрахунку параметрів <span class="math inline">\(\alpha\)</span>-стабільного розподілу</h4>
<p>Числені методи, такі як метод Маккаллоха, заснований на квантилях, і метод оцінки максимальної правдоподібності були розроблені в результаті відсутності аналітичних рішень. Припустимо, що <span class="math inline">\(\text{X} = (X_1, ... , X_T)\)</span> вектор, що складається з <span class="math inline">\(T\)</span> незалежних ідентично розподілених випадкових величин із розподілу Парето, і також <span class="math inline">\(x \sim S_{\alpha}(\alpha, \beta, \delta, \gamma)\)</span>. Визначивши <span class="math inline">\(\theta = (\alpha, \beta, \delta, \gamma)\)</span>, Митник, Доганоглу та Ченайо розробили алогритм максимальної правдоподібності і показали, що <span class="math inline">\(\theta\)</span> можна розрахувати, максимізуючи функцію логарифмічної правдоподібності</p>
<p><span class="math display">\[
l(\theta, x) = \sum_{i=1}^{T}\log{f(x_{i}, \theta)}.
\]</span></p>
<p>Дюмушель застосував метод максимальної правдоподібності до стабільного розподілу і визначив функцію правдоподібності наступним чином:</p>
<p><span class="math display">\[
L(\theta) = \prod_{k=1}^{n}S_{\alpha,\beta} \left( \frac{X_{k} - \delta}{\gamma} \right) \Big/ \gamma,
\]</span></p>
<p>де <span class="math inline">\(\theta = (\alpha, \beta, \delta, \gamma)\)</span> опираючись на <span class="math inline">\(x = (x_1, ... , x_n)\)</span> для розміру вибірки <span class="math inline">\(n\)</span>.</p>
</section>
</section>
</section>
<section id="хід-роботи" class="level2" data-number="12.2">
<h2 data-number="12.2" class="anchored" data-anchor-id="хід-роботи"><span class="header-section-number">12.2</span> Хід роботи</h2>
<p>Зчитуємо дані з Yahoo Finance:</p>
<div class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb101"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb101-1"><a href="#cb101-1" aria-hidden="true" tabindex="-1"></a><span class="co"># встановлення назви індексу</span></span>
<span id="cb101-2"><a href="#cb101-2" aria-hidden="true" tabindex="-1"></a>symbol <span class="op">=</span> <span class="st">"^BSESN"</span> </span>
<span id="cb101-3"><a href="#cb101-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb101-4"><a href="#cb101-4" aria-hidden="true" tabindex="-1"></a><span class="co"># встановлення діапазону з яким будемо працювати</span></span>
<span id="cb101-5"><a href="#cb101-5" aria-hidden="true" tabindex="-1"></a>start <span class="op">=</span> <span class="st">"1980-01-01"</span></span>
<span id="cb101-6"><a href="#cb101-6" aria-hidden="true" tabindex="-1"></a>end <span class="op">=</span> <span class="st">"2022-11-07"</span></span>
<span id="cb101-7"><a href="#cb101-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb101-8"><a href="#cb101-8" aria-hidden="true" tabindex="-1"></a><span class="co"># завантаження даних з Yahoo</span></span>
<span id="cb101-9"><a href="#cb101-9" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> yf.download(symbol, start, end)</span>
<span id="cb101-10"><a href="#cb101-10" aria-hidden="true" tabindex="-1"></a>time_ser <span class="op">=</span> data[<span class="st">'Adj Close'</span>].copy()</span>
<span id="cb101-11"><a href="#cb101-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb101-12"><a href="#cb101-12" aria-hidden="true" tabindex="-1"></a><span class="co"># підпис по вісі Ох </span></span>
<span id="cb101-13"><a href="#cb101-13" aria-hidden="true" tabindex="-1"></a>xlabel <span class="op">=</span> <span class="st">'time, days'</span></span>
<span id="cb101-14"><a href="#cb101-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb101-15"><a href="#cb101-15" aria-hidden="true" tabindex="-1"></a><span class="co"># підпис по вісі Оу</span></span>
<span id="cb101-16"><a href="#cb101-16" aria-hidden="true" tabindex="-1"></a>ylabel <span class="op">=</span> symbol                       </span>
<span id="cb101-17"><a href="#cb101-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb101-18"><a href="#cb101-18" aria-hidden="true" tabindex="-1"></a><span class="co"># збереження результату в текстовий документ </span></span>
<span id="cb101-19"><a href="#cb101-19" aria-hidden="true" tabindex="-1"></a>np.savetxt(<span class="ss">f'</span><span class="sc">{</span>symbol<span class="sc">}</span><span class="ss">_initial_time_series.txt'</span>, time_ser.values)</span></code><button title="Копіювати" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[*********************100%%**********************]  1 of 1 completed</code></pre>
</div>
</div>
<div class="callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Увага
</div>
</div>
<div class="callout-body-container callout-body">
<p>Виконайте цей блок, якщо хочете зчитати дані не з Yahoo! Finance, а із власного файлу. Зрозуміло, що й аналіз результатів, і висновки залежать від того з яким рядом ми працюємо</p>
</div>
</div>
<hr>
<div class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb103"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb103-1"><a href="#cb103-1" aria-hidden="true" tabindex="-1"></a>symbol <span class="op">=</span> <span class="st">'sMpa11'</span>                  <span class="co"># Символ індексу</span></span>
<span id="cb103-2"><a href="#cb103-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-3"><a href="#cb103-3" aria-hidden="true" tabindex="-1"></a>path <span class="op">=</span> <span class="st">"databases\sMpa11.txt"</span>      <span class="co"># шлях по якому здійснюється зчитування файлу</span></span>
<span id="cb103-4"><a href="#cb103-4" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> pd.read_csv(path,           <span class="co"># зчитування даних </span></span>
<span id="cb103-5"><a href="#cb103-5" aria-hidden="true" tabindex="-1"></a>                   names<span class="op">=</span>[symbol])</span>
<span id="cb103-6"><a href="#cb103-6" aria-hidden="true" tabindex="-1"></a>time_ser <span class="op">=</span> data[symbol].copy()     <span class="co"># копіюємо значення кривої </span></span>
<span id="cb103-7"><a href="#cb103-7" aria-hidden="true" tabindex="-1"></a>                                   <span class="co"># "напруга-видовження" до окремої змінної</span></span>
<span id="cb103-8"><a href="#cb103-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-9"><a href="#cb103-9" aria-hidden="true" tabindex="-1"></a>xlabel <span class="op">=</span> <span class="vs">r'$\varepsilon$'</span>          <span class="co"># підпис по вісі Ох </span></span>
<span id="cb103-10"><a href="#cb103-10" aria-hidden="true" tabindex="-1"></a>ylabel <span class="op">=</span> symbol                    <span class="co"># підпис по вісі Оу</span></span></code><button title="Копіювати" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<hr>
<p>Виводимо графік досліджуваного ряду</p>
<div class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb104"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb104-1"><a href="#cb104-1" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots()                   <span class="co"># Створюємо порожній графік</span></span>
<span id="cb104-2"><a href="#cb104-2" aria-hidden="true" tabindex="-1"></a>ax.plot(time_ser.index, time_ser.values)   <span class="co"># Додаємо дані до графіку</span></span>
<span id="cb104-3"><a href="#cb104-3" aria-hidden="true" tabindex="-1"></a>ax.legend([symbol])                        <span class="co"># Додаємо легенду</span></span>
<span id="cb104-4"><a href="#cb104-4" aria-hidden="true" tabindex="-1"></a>ax.set_xlabel(xlabel)                      <span class="co"># Встановимо підпис по вісі Ох</span></span>
<span id="cb104-5"><a href="#cb104-5" aria-hidden="true" tabindex="-1"></a>ax.set_ylabel(ylabel)                      <span class="co"># Встановимо підпис по вісі Oy</span></span>
<span id="cb104-6"><a href="#cb104-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb104-7"><a href="#cb104-7" aria-hidden="true" tabindex="-1"></a>plt.xticks(rotation<span class="op">=</span><span class="dv">45</span>)                    <span class="co"># оберт позначок по осі Ох на 45 градусів</span></span>
<span id="cb104-8"><a href="#cb104-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb104-9"><a href="#cb104-9" aria-hidden="true" tabindex="-1"></a>plt.savefig(<span class="ss">f'</span><span class="sc">{</span>symbol<span class="sc">}</span><span class="ss">.jpg'</span>)               <span class="co"># Зберігаємо графік </span></span>
<span id="cb104-10"><a href="#cb104-10" aria-hidden="true" tabindex="-1"></a>plt.show()<span class="op">;</span>                                <span class="co"># Виводимо графік</span></span></code><button title="Копіювати" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div id="fig-bsesn-init" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="lab_12_files/figure-html/fig-bsesn-init-output-1.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Рис.&nbsp;12.1: Динаміка щоденних змін фондового індексу BSESN</figcaption>
</figure>
</div>
</div>
</div>
<section id="побудова-розподілу-леві-та-розрахунок-параметрів-для-всього-ряду" class="level3" data-number="12.2.1">
<h3 data-number="12.2.1" class="anchored" data-anchor-id="побудова-розподілу-леві-та-розрахунок-параметрів-для-всього-ряду"><span class="header-section-number">12.2.1</span> Побудова розподілу Леві та розрахунок параметрів для всього ряду</h3>
<p>Для приведення ряду до стандартизованого вигляду або прибутковостей визначимо функцію <code>transformations()</code>:</p>
<div class="cell" data-execution_count="9">
<div class="sourceCode cell-code" id="cb105"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb105-1"><a href="#cb105-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> transformation(signal, ret_type):</span>
<span id="cb105-2"><a href="#cb105-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-3"><a href="#cb105-3" aria-hidden="true" tabindex="-1"></a>    for_rec <span class="op">=</span> signal.copy()</span>
<span id="cb105-4"><a href="#cb105-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-5"><a href="#cb105-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> ret_type <span class="op">==</span> <span class="dv">1</span>:       <span class="co"># Зважаючи на вид ряду, виконуємо</span></span>
<span id="cb105-6"><a href="#cb105-6" aria-hidden="true" tabindex="-1"></a>                            <span class="co"># необхідні перетворення</span></span>
<span id="cb105-7"><a href="#cb105-7" aria-hidden="true" tabindex="-1"></a>        <span class="cf">pass</span></span>
<span id="cb105-8"><a href="#cb105-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">elif</span> ret_type <span class="op">==</span> <span class="dv">2</span>:</span>
<span id="cb105-9"><a href="#cb105-9" aria-hidden="true" tabindex="-1"></a>        for_rec <span class="op">=</span> for_rec.diff()</span>
<span id="cb105-10"><a href="#cb105-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">elif</span> ret_type <span class="op">==</span> <span class="dv">3</span>:</span>
<span id="cb105-11"><a href="#cb105-11" aria-hidden="true" tabindex="-1"></a>        for_rec <span class="op">=</span> for_rec.pct_change()</span>
<span id="cb105-12"><a href="#cb105-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">elif</span> ret_type <span class="op">==</span> <span class="dv">4</span>:</span>
<span id="cb105-13"><a href="#cb105-13" aria-hidden="true" tabindex="-1"></a>        for_rec <span class="op">=</span> for_rec.pct_change()</span>
<span id="cb105-14"><a href="#cb105-14" aria-hidden="true" tabindex="-1"></a>        for_rec <span class="op">-=</span> for_rec.mean()</span>
<span id="cb105-15"><a href="#cb105-15" aria-hidden="true" tabindex="-1"></a>        for_rec <span class="op">/=</span> for_rec.std()</span>
<span id="cb105-16"><a href="#cb105-16" aria-hidden="true" tabindex="-1"></a>    <span class="cf">elif</span> ret_type <span class="op">==</span> <span class="dv">5</span>: </span>
<span id="cb105-17"><a href="#cb105-17" aria-hidden="true" tabindex="-1"></a>        for_rec <span class="op">=</span> for_rec.pct_change()</span>
<span id="cb105-18"><a href="#cb105-18" aria-hidden="true" tabindex="-1"></a>        for_rec <span class="op">-=</span> for_rec.mean()</span>
<span id="cb105-19"><a href="#cb105-19" aria-hidden="true" tabindex="-1"></a>        for_rec <span class="op">/=</span> for_rec.std()</span>
<span id="cb105-20"><a href="#cb105-20" aria-hidden="true" tabindex="-1"></a>        for_rec <span class="op">=</span> for_rec.<span class="bu">abs</span>()</span>
<span id="cb105-21"><a href="#cb105-21" aria-hidden="true" tabindex="-1"></a>    <span class="cf">elif</span> ret_type <span class="op">==</span> <span class="dv">6</span>:</span>
<span id="cb105-22"><a href="#cb105-22" aria-hidden="true" tabindex="-1"></a>        for_rec <span class="op">-=</span> for_rec.mean()</span>
<span id="cb105-23"><a href="#cb105-23" aria-hidden="true" tabindex="-1"></a>        for_rec <span class="op">/=</span> for_rec.std()</span>
<span id="cb105-24"><a href="#cb105-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-25"><a href="#cb105-25" aria-hidden="true" tabindex="-1"></a>    for_rec <span class="op">=</span> for_rec.dropna().values</span>
<span id="cb105-26"><a href="#cb105-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-27"><a href="#cb105-27" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> for_rec</span></code><button title="Копіювати" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Для побудови в парі певного індикатора та досліджуваного ряду визначимо функцію <code>plot_pair</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb106"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb106-1"><a href="#cb106-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> plot_pair(x_values, </span>
<span id="cb106-2"><a href="#cb106-2" aria-hidden="true" tabindex="-1"></a>              y1_values,</span>
<span id="cb106-3"><a href="#cb106-3" aria-hidden="true" tabindex="-1"></a>              y2_values,  </span>
<span id="cb106-4"><a href="#cb106-4" aria-hidden="true" tabindex="-1"></a>              y1_label, </span>
<span id="cb106-5"><a href="#cb106-5" aria-hidden="true" tabindex="-1"></a>              y2_label,</span>
<span id="cb106-6"><a href="#cb106-6" aria-hidden="true" tabindex="-1"></a>              x_label, </span>
<span id="cb106-7"><a href="#cb106-7" aria-hidden="true" tabindex="-1"></a>              file_name, clr<span class="op">=</span><span class="st">"magenta"</span>):</span>
<span id="cb106-8"><a href="#cb106-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-9"><a href="#cb106-9" aria-hidden="true" tabindex="-1"></a>    fig, ax <span class="op">=</span> plt.subplots()</span>
<span id="cb106-10"><a href="#cb106-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-11"><a href="#cb106-11" aria-hidden="true" tabindex="-1"></a>    ax2 <span class="op">=</span> ax.twinx()</span>
<span id="cb106-12"><a href="#cb106-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-13"><a href="#cb106-13" aria-hidden="true" tabindex="-1"></a>    ax2.spines.right.set_position((<span class="st">"axes"</span>, <span class="fl">1.03</span>))</span>
<span id="cb106-14"><a href="#cb106-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-15"><a href="#cb106-15" aria-hidden="true" tabindex="-1"></a>    p1, <span class="op">=</span> ax.plot(x_values, </span>
<span id="cb106-16"><a href="#cb106-16" aria-hidden="true" tabindex="-1"></a>                  y1_values, </span>
<span id="cb106-17"><a href="#cb106-17" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"b-"</span>, label<span class="op">=</span><span class="vs">fr"</span><span class="sc">{</span>y1_label<span class="sc">}</span><span class="vs">"</span>)</span>
<span id="cb106-18"><a href="#cb106-18" aria-hidden="true" tabindex="-1"></a>    p2, <span class="op">=</span> ax2.plot(x_values,</span>
<span id="cb106-19"><a href="#cb106-19" aria-hidden="true" tabindex="-1"></a>                   y2_values, </span>
<span id="cb106-20"><a href="#cb106-20" aria-hidden="true" tabindex="-1"></a>                   color<span class="op">=</span>clr, </span>
<span id="cb106-21"><a href="#cb106-21" aria-hidden="true" tabindex="-1"></a>                   label<span class="op">=</span>y2_label)</span>
<span id="cb106-22"><a href="#cb106-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-23"><a href="#cb106-23" aria-hidden="true" tabindex="-1"></a>    ax.set_xlabel(x_label)</span>
<span id="cb106-24"><a href="#cb106-24" aria-hidden="true" tabindex="-1"></a>    ax.set_ylabel(<span class="ss">f"</span><span class="sc">{</span>y1_label<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb106-25"><a href="#cb106-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-26"><a href="#cb106-26" aria-hidden="true" tabindex="-1"></a>    ax.yaxis.label.set_color(p1.get_color())</span>
<span id="cb106-27"><a href="#cb106-27" aria-hidden="true" tabindex="-1"></a>    ax2.yaxis.label.set_color(p2.get_color())</span>
<span id="cb106-28"><a href="#cb106-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-29"><a href="#cb106-29" aria-hidden="true" tabindex="-1"></a>    tkw <span class="op">=</span> <span class="bu">dict</span>(size<span class="op">=</span><span class="dv">2</span>, width<span class="op">=</span><span class="fl">1.5</span>)</span>
<span id="cb106-30"><a href="#cb106-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-31"><a href="#cb106-31" aria-hidden="true" tabindex="-1"></a>    ax.tick_params(axis<span class="op">=</span><span class="st">'x'</span>, <span class="op">**</span>tkw)</span>
<span id="cb106-32"><a href="#cb106-32" aria-hidden="true" tabindex="-1"></a>    ax.tick_params(axis<span class="op">=</span><span class="st">'y'</span>, colors<span class="op">=</span>p1.get_color(), <span class="op">**</span>tkw)</span>
<span id="cb106-33"><a href="#cb106-33" aria-hidden="true" tabindex="-1"></a>    ax2.tick_params(axis<span class="op">=</span><span class="st">'y'</span>, colors<span class="op">=</span>p2.get_color(), <span class="op">**</span>tkw)</span>
<span id="cb106-34"><a href="#cb106-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-35"><a href="#cb106-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-36"><a href="#cb106-36" aria-hidden="true" tabindex="-1"></a>    ax2.legend(handles<span class="op">=</span>[p1, p2])</span>
<span id="cb106-37"><a href="#cb106-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-38"><a href="#cb106-38" aria-hidden="true" tabindex="-1"></a>    plt.savefig(file_name <span class="op">+</span> <span class="st">".jpg"</span>)</span>
<span id="cb106-39"><a href="#cb106-39" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb106-40"><a href="#cb106-40" aria-hidden="true" tabindex="-1"></a>    plt.show()<span class="op">;</span></span></code><button title="Копіювати" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Далі виконаємо приведення ряду до прибутковостей:</p>
<div class="cell" data-execution_count="7">
<div class="sourceCode cell-code" id="cb107"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb107-1"><a href="#cb107-1" aria-hidden="true" tabindex="-1"></a>ret_type <span class="op">=</span> <span class="dv">4</span>    <span class="co"># вид ряду: </span></span>
<span id="cb107-2"><a href="#cb107-2" aria-hidden="true" tabindex="-1"></a>                <span class="co"># 1 - вихідний, </span></span>
<span id="cb107-3"><a href="#cb107-3" aria-hidden="true" tabindex="-1"></a>                <span class="co"># 2 - детрендований (різниця між теп. значенням та попереднім)</span></span>
<span id="cb107-4"><a href="#cb107-4" aria-hidden="true" tabindex="-1"></a>                <span class="co"># 3 - прибутковості звичайні, </span></span>
<span id="cb107-5"><a href="#cb107-5" aria-hidden="true" tabindex="-1"></a>                <span class="co"># 4 - стандартизовані прибутковості, </span></span>
<span id="cb107-6"><a href="#cb107-6" aria-hidden="true" tabindex="-1"></a>                <span class="co"># 5 - абсолютні значення (волатильності)</span></span>
<span id="cb107-7"><a href="#cb107-7" aria-hidden="true" tabindex="-1"></a>                <span class="co"># 6 - стандартизований ряд </span></span>
<span id="cb107-8"><a href="#cb107-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-9"><a href="#cb107-9" aria-hidden="true" tabindex="-1"></a>for_levy <span class="op">=</span> transformation(time_ser)</span></code><button title="Копіювати" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Підганяємо розподіл Леві та Гауса для порівняння:</p>
<div class="cell" data-execution_count="10">
<div class="sourceCode cell-code" id="cb108"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb108-1"><a href="#cb108-1" aria-hidden="true" tabindex="-1"></a>params <span class="op">=</span> levy.fit_levy(for_levy)</span>
<span id="cb108-2"><a href="#cb108-2" aria-hidden="true" tabindex="-1"></a>mean, std <span class="op">=</span> norm.fit(for_levy)</span></code><button title="Копіювати" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Отримуємо параметри розподілу Леві у відповідності до однієї із параметризацій, що пропонує пакет <code>levy</code>:</p>
<div class="cell" data-execution_count="11">
<div class="sourceCode cell-code" id="cb109"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb109-1"><a href="#cb109-1" aria-hidden="true" tabindex="-1"></a>alpha, beta, mu, sigma <span class="op">=</span> params[<span class="dv">0</span>].get(<span class="st">'1'</span>)</span></code><button title="Копіювати" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Будуємо теоретичні та емпіричні розподіли:</p>
<div class="cell" data-execution_count="15">
<div class="sourceCode cell-code" id="cb110"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb110-1"><a href="#cb110-1" aria-hidden="true" tabindex="-1"></a>xmin <span class="op">=</span> for_levy.<span class="bu">min</span>()</span>
<span id="cb110-2"><a href="#cb110-2" aria-hidden="true" tabindex="-1"></a>xmax <span class="op">=</span> for_levy.<span class="bu">max</span>()</span>
<span id="cb110-3"><a href="#cb110-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-4"><a href="#cb110-4" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> np.linspace(xmin, xmax, <span class="bu">len</span>(for_levy))</span>
<span id="cb110-5"><a href="#cb110-5" aria-hidden="true" tabindex="-1"></a>pdf <span class="op">=</span> levy.levy(x, alpha, beta, mu, sigma)</span>
<span id="cb110-6"><a href="#cb110-6" aria-hidden="true" tabindex="-1"></a>pdf_norm <span class="op">=</span> norm.pdf(x, mean, std)</span>
<span id="cb110-7"><a href="#cb110-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-8"><a href="#cb110-8" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">2</span>, figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">8</span>))</span>
<span id="cb110-9"><a href="#cb110-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-10"><a href="#cb110-10" aria-hidden="true" tabindex="-1"></a>fig.suptitle(<span class="vs">fr'Теоретичні та емпіричні $\alpha$-стабільні розподіли для </span><span class="sc">{</span>symbol<span class="sc">}</span><span class="vs">'</span>, fontsize<span class="op">=</span><span class="dv">20</span>)</span>
<span id="cb110-11"><a href="#cb110-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-12"><a href="#cb110-12" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">0</span>].hist(for_levy, bins<span class="op">=</span><span class="dv">50</span>, density<span class="op">=</span><span class="va">True</span>, alpha<span class="op">=</span><span class="fl">0.6</span>, color<span class="op">=</span><span class="st">'b'</span>)</span>
<span id="cb110-13"><a href="#cb110-13" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">0</span>].plot(x, pdf, <span class="st">'k'</span>)</span>
<span id="cb110-14"><a href="#cb110-14" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">0</span>].plot(x, pdf_norm, <span class="st">'r'</span>)</span>
<span id="cb110-15"><a href="#cb110-15" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">0</span>].set_yscale(<span class="st">'log'</span>)</span>
<span id="cb110-16"><a href="#cb110-16" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">0</span>].set_xlabel(<span class="vs">r'$x$'</span>)</span>
<span id="cb110-17"><a href="#cb110-17" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">0</span>].set_ylabel(<span class="vs">r'$f_{\alpha}(x), \, \mathrm</span><span class="sc">{ePDF}</span><span class="vs">$'</span>)</span>
<span id="cb110-18"><a href="#cb110-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-19"><a href="#cb110-19" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">1</span>].hist(for_levy, bins<span class="op">=</span><span class="dv">50</span>, density<span class="op">=</span><span class="va">True</span>, alpha<span class="op">=</span><span class="fl">0.6</span>, color<span class="op">=</span><span class="st">'g'</span>)</span>
<span id="cb110-20"><a href="#cb110-20" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">1</span>].plot(x, pdf, <span class="st">'k'</span>)</span>
<span id="cb110-21"><a href="#cb110-21" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">1</span>].plot(x, pdf_norm, <span class="st">'r'</span>)</span>
<span id="cb110-22"><a href="#cb110-22" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">1</span>].set_xlabel(<span class="vs">r'$x$'</span>)</span>
<span id="cb110-23"><a href="#cb110-23" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">1</span>].set_ylabel(<span class="vs">r'$f_{\alpha}(x), \, \mathrm</span><span class="sc">{ePDF}</span><span class="vs">$'</span>)</span>
<span id="cb110-24"><a href="#cb110-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-25"><a href="#cb110-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-26"><a href="#cb110-26" aria-hidden="true" tabindex="-1"></a>plt.savefig(<span class="ss">f"Теоретичні та емпіричні альфа стабільні розподіли для </span><span class="sc">{</span>symbol<span class="sc">}</span><span class="ss">.jpg"</span>)</span>
<span id="cb110-27"><a href="#cb110-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-28"><a href="#cb110-28" aria-hidden="true" tabindex="-1"></a>fig.tight_layout()</span>
<span id="cb110-29"><a href="#cb110-29" aria-hidden="true" tabindex="-1"></a>plt.show()<span class="op">;</span></span></code><button title="Копіювати" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div id="fig-pdfs-ther-emp" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="lab_12_files/figure-html/fig-pdfs-ther-emp-output-1.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Рис.&nbsp;12.2: Теоретичні та емпіричні альфа-стабільні функції щільності ймовірностей</figcaption>
</figure>
</div>
</div>
</div>
<p>Виводимо параметри розподілу Леві для заданого індексу</p>
<div class="cell" data-execution_count="16">
<div class="sourceCode cell-code" id="cb111"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb111-1"><a href="#cb111-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="vs">fr"Параматери alpha = </span><span class="sc">{</span>alpha<span class="sc">:.2f}</span><span class="vs">, beta = </span><span class="sc">{</span>beta<span class="sc">:.2f}</span><span class="vs">, mu = </span><span class="sc">{</span>mu<span class="sc">:.2f}</span><span class="vs">, sigma = </span><span class="sc">{</span>sigma<span class="sc">:.2f}</span><span class="vs">"</span>)</span></code><button title="Копіювати" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Параматери alpha = 1.63, beta = -0.11, mu = -0.01, sigma = 0.53</code></pre>
</div>
</div>
<p>Для досліджуваного індексу бачимо, що параметр <span class="math inline">\(\alpha &lt; 2.0\)</span> та <span class="math inline">\(\beta &lt; 0\)</span>, що вказує на відхилення розподілу даного індексу від нормального. Тобто, для даного ряду переважаючими є кризові явища, на що вказують важкі хвости розподілу. Із порівняльного аналізу Гауссового та Леві розподілів бачимо, що хвости нормального розподілу значно недооцінюють ймовірність появи кризових явищ чого, наприклад, не скажешь про альфа-стабільний розподіл. Взявши логарифм значень ймовірності по осі <span class="math inline">\(Oy\)</span> ми можемо спостерігати, що, наприклад, недооцінка негативних прибутковостей Гаусовим розподілом, у порівнянні з альфа-стабільним, складає <span class="math inline">\(\approx 10^{15}\)</span> порядків. Для позитивних прибутковостей, що перевищують значення <span class="math inline">\(+10\sigma\)</span> недооцінка Гауссовим розподілом складає <span class="math inline">\(\approx 10^{27}\)</span> порядків. Теоретичне значення альфа-стабільного розподілу достатньо точно враховує важкі хвости емпіричного розподілу, що також виражається високим ексцесом розподілу. Також варто зазначити, що коефіцієнт асиметрії <span class="math inline">\(\beta\)</span> вказує на невеличке зміщення розподілу в ліву сторону, що також демонструє переважання кризових явищ.</p>
</section>
<section id="дослідження-поведінки-альфа-стабільного-розподілу-леві" class="level3" data-number="12.2.2">
<h3 data-number="12.2.2" class="anchored" data-anchor-id="дослідження-поведінки-альфа-стабільного-розподілу-леві"><span class="header-section-number">12.2.2</span> Дослідження поведінки альфа-стабільного розподілу Леві</h3>
<div class="cell" data-execution_count="17">
<div class="sourceCode cell-code" id="cb113"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb113-1"><a href="#cb113-1" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> np.arange(<span class="op">-</span><span class="dv">5</span>, <span class="dv">5</span>, <span class="fl">.01</span>)</span>
<span id="cb113-2"><a href="#cb113-2" aria-hidden="true" tabindex="-1"></a>beta_1 <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb113-3"><a href="#cb113-3" aria-hidden="true" tabindex="-1"></a>mu <span class="op">=</span> <span class="dv">0</span> </span>
<span id="cb113-4"><a href="#cb113-4" aria-hidden="true" tabindex="-1"></a>sigm <span class="op">=</span> <span class="dv">1</span> </span>
<span id="cb113-5"><a href="#cb113-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb113-6"><a href="#cb113-6" aria-hidden="true" tabindex="-1"></a>beta_2 <span class="op">=</span> <span class="fl">1.0</span></span>
<span id="cb113-7"><a href="#cb113-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb113-8"><a href="#cb113-8" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(<span class="dv">2</span>, <span class="dv">2</span>, figsize<span class="op">=</span>(<span class="dv">20</span>, <span class="dv">10</span>))</span>
<span id="cb113-9"><a href="#cb113-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb113-10"><a href="#cb113-10" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">0</span>][<span class="dv">0</span>].plot(x, levy.levy(x, <span class="fl">0.5</span>, beta_1, mu, sigm), label <span class="op">=</span> <span class="vs">r"$ \alpha=0.5 $"</span>)</span>
<span id="cb113-11"><a href="#cb113-11" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">0</span>][<span class="dv">0</span>].plot(x, levy.levy(x, <span class="fl">0.75</span>, beta_1, mu, sigm), label <span class="op">=</span> <span class="vs">r"$ \alpha=0.75 $"</span>)</span>
<span id="cb113-12"><a href="#cb113-12" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">0</span>][<span class="dv">0</span>].plot(x, levy.levy(x, <span class="fl">1.0</span>, beta_1, mu, sigm), label <span class="op">=</span> <span class="vs">r"$ \alpha=1.0 $"</span>)</span>
<span id="cb113-13"><a href="#cb113-13" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">0</span>][<span class="dv">0</span>].plot(x, levy.levy(x, <span class="fl">1.25</span>, beta_1, mu, sigm), label <span class="op">=</span> <span class="vs">r"$ \alpha=1.25 $"</span>)</span>
<span id="cb113-14"><a href="#cb113-14" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">0</span>][<span class="dv">0</span>].plot(x, levy.levy(x, <span class="fl">1.5</span>, beta_1, mu, sigm), label <span class="op">=</span> <span class="vs">r"$ \alpha=1.5 $"</span>)</span>
<span id="cb113-15"><a href="#cb113-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb113-16"><a href="#cb113-16" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">0</span>][<span class="dv">0</span>].set_title(<span class="vs">r"Симетричні $\alpha$-стабільні розподіли, $ \beta = 0 $, $ \mu = 0 $, $ \sigma = 1 $"</span>, y<span class="op">=</span><span class="fl">1.03</span>, fontsize<span class="op">=</span><span class="dv">20</span>)</span>
<span id="cb113-17"><a href="#cb113-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb113-18"><a href="#cb113-18" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">0</span>][<span class="dv">0</span>].legend(fontsize<span class="op">=</span><span class="dv">20</span>)</span>
<span id="cb113-19"><a href="#cb113-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb113-20"><a href="#cb113-20" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">0</span>][<span class="dv">0</span>].set_xlabel(<span class="vs">r"$ x $"</span>)</span>
<span id="cb113-21"><a href="#cb113-21" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">0</span>][<span class="dv">0</span>].set_ylabel(<span class="vs">r"$ f_{\alpha}(x) $"</span>)</span>
<span id="cb113-22"><a href="#cb113-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb113-23"><a href="#cb113-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb113-24"><a href="#cb113-24" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">0</span>][<span class="dv">1</span>].plot(x, levy.levy(x, <span class="fl">0.5</span>, beta_2, mu, sigm), label <span class="op">=</span> <span class="vs">r"$ \alpha=0.5 $"</span>)</span>
<span id="cb113-25"><a href="#cb113-25" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">0</span>][<span class="dv">1</span>].plot(x, levy.levy(x, <span class="fl">0.75</span>, beta_2, mu, sigm), label <span class="op">=</span> <span class="vs">r"$ \alpha=0.75 $"</span>)</span>
<span id="cb113-26"><a href="#cb113-26" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">0</span>][<span class="dv">1</span>].plot(x, levy.levy(x, <span class="fl">1.0</span>, beta_2, mu, sigm), label <span class="op">=</span> <span class="vs">r"$ \alpha=1.0 $"</span>)</span>
<span id="cb113-27"><a href="#cb113-27" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">0</span>][<span class="dv">1</span>].plot(x, levy.levy(x, <span class="fl">1.25</span>, beta_2, mu, sigm), label <span class="op">=</span> <span class="vs">r"$ \alpha=1.25 $"</span>)</span>
<span id="cb113-28"><a href="#cb113-28" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">0</span>][<span class="dv">1</span>].plot(x, levy.levy(x, <span class="fl">1.5</span>, beta_2, mu, sigm), label <span class="op">=</span> <span class="vs">r"$ \alpha=1.5 $"</span>)</span>
<span id="cb113-29"><a href="#cb113-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb113-30"><a href="#cb113-30" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">0</span>][<span class="dv">1</span>].set_title(<span class="vs">r"Зміщенні $\alpha$-стабільні розподіли, $ \beta = 1 $, $ \mu = 0 $, $ \sigma = 1 $"</span>, y<span class="op">=</span><span class="fl">1.03</span>, fontsize<span class="op">=</span><span class="dv">20</span>)</span>
<span id="cb113-31"><a href="#cb113-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb113-32"><a href="#cb113-32" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">0</span>][<span class="dv">1</span>].legend(fontsize<span class="op">=</span><span class="dv">20</span>)</span>
<span id="cb113-33"><a href="#cb113-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb113-34"><a href="#cb113-34" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">0</span>][<span class="dv">1</span>].set_xlabel(<span class="vs">r"$ x $"</span>)</span>
<span id="cb113-35"><a href="#cb113-35" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">0</span>][<span class="dv">1</span>].set_ylabel(<span class="vs">r"$ f_{\alpha}(x) $"</span>)</span>
<span id="cb113-36"><a href="#cb113-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb113-37"><a href="#cb113-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb113-38"><a href="#cb113-38" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">1</span>][<span class="dv">0</span>].plot(x, levy.levy(x, <span class="fl">0.5</span>, beta_1, mu, sigm, cdf<span class="op">=</span><span class="va">True</span>), label <span class="op">=</span> <span class="vs">r"$ \alpha=0.5 $"</span>)</span>
<span id="cb113-39"><a href="#cb113-39" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">1</span>][<span class="dv">0</span>].plot(x, levy.levy(x, <span class="fl">0.75</span>, beta_1, mu, sigm, cdf<span class="op">=</span><span class="va">True</span>), label <span class="op">=</span> <span class="vs">r"$ \alpha=0.75 $"</span>)</span>
<span id="cb113-40"><a href="#cb113-40" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">1</span>][<span class="dv">0</span>].plot(x, levy.levy(x, <span class="fl">1.0</span>, beta_1, mu, sigm, cdf<span class="op">=</span><span class="va">True</span>), label <span class="op">=</span> <span class="vs">r"$ \alpha=1.0 $"</span>)</span>
<span id="cb113-41"><a href="#cb113-41" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">1</span>][<span class="dv">0</span>].plot(x, levy.levy(x, <span class="fl">1.25</span>, beta_1, mu, sigm, cdf<span class="op">=</span><span class="va">True</span>), label <span class="op">=</span> <span class="vs">r"$ \alpha=1.25 $"</span>)</span>
<span id="cb113-42"><a href="#cb113-42" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">1</span>][<span class="dv">0</span>].plot(x, levy.levy(x, <span class="fl">1.5</span>, beta_1, mu, sigm, cdf<span class="op">=</span><span class="va">True</span>), label <span class="op">=</span> <span class="vs">r"$ \alpha=1.5 $"</span>)</span>
<span id="cb113-43"><a href="#cb113-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb113-44"><a href="#cb113-44" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">1</span>][<span class="dv">0</span>].set_title(<span class="vs">r"Симетричні $\alpha$-стабільні розподіли, $ \beta = 0 $, $ \mu = 0 $, $ \sigma = 1 $"</span>, y<span class="op">=</span><span class="fl">1.03</span>, fontsize<span class="op">=</span><span class="dv">20</span>)</span>
<span id="cb113-45"><a href="#cb113-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb113-46"><a href="#cb113-46" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">1</span>][<span class="dv">0</span>].legend(fontsize<span class="op">=</span><span class="dv">20</span>, loc<span class="op">=</span><span class="st">"lower right"</span>)</span>
<span id="cb113-47"><a href="#cb113-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb113-48"><a href="#cb113-48" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">1</span>][<span class="dv">0</span>].set_xlabel(<span class="vs">r"$ x $"</span>)</span>
<span id="cb113-49"><a href="#cb113-49" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">1</span>][<span class="dv">0</span>].set_ylabel(<span class="vs">r"$ F_{\alpha}(x) $"</span>)</span>
<span id="cb113-50"><a href="#cb113-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb113-51"><a href="#cb113-51" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">1</span>][<span class="dv">1</span>].plot(x, levy.levy(x, <span class="fl">0.5</span>, beta_2, mu, sigm, cdf<span class="op">=</span><span class="va">True</span>), label <span class="op">=</span> <span class="vs">r"$ \alpha=0.5 $"</span>)</span>
<span id="cb113-52"><a href="#cb113-52" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">1</span>][<span class="dv">1</span>].plot(x, levy.levy(x, <span class="fl">0.75</span>, beta_2, mu, sigm, cdf<span class="op">=</span><span class="va">True</span>), label <span class="op">=</span> <span class="vs">r"$ \alpha=0.75 $"</span>)</span>
<span id="cb113-53"><a href="#cb113-53" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">1</span>][<span class="dv">1</span>].plot(x, levy.levy(x, <span class="fl">1.0</span>, beta_2, mu, sigm, cdf<span class="op">=</span><span class="va">True</span>), label <span class="op">=</span> <span class="vs">r"$ \alpha=1.0 $"</span>)</span>
<span id="cb113-54"><a href="#cb113-54" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">1</span>][<span class="dv">1</span>].plot(x, levy.levy(x, <span class="fl">1.25</span>, beta_2, mu, sigm, cdf<span class="op">=</span><span class="va">True</span>), label <span class="op">=</span> <span class="vs">r"$ \alpha=1.25 $"</span>)</span>
<span id="cb113-55"><a href="#cb113-55" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">1</span>][<span class="dv">1</span>].plot(x, levy.levy(x, <span class="fl">1.5</span>, beta_2, mu, sigm, cdf<span class="op">=</span><span class="va">True</span>), label <span class="op">=</span> <span class="vs">r"$ \alpha=1.5 $"</span>)</span>
<span id="cb113-56"><a href="#cb113-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb113-57"><a href="#cb113-57" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">1</span>][<span class="dv">1</span>].set_title(<span class="vs">r"Зміщенні $\alpha$-стабільні розподіли, $\beta = 1$, $\mu = 0$, $\sigma = 1$"</span>, y<span class="op">=</span><span class="fl">1.03</span>, fontsize<span class="op">=</span><span class="dv">20</span>)</span>
<span id="cb113-58"><a href="#cb113-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb113-59"><a href="#cb113-59" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">1</span>][<span class="dv">1</span>].legend(fontsize<span class="op">=</span><span class="dv">20</span>, loc<span class="op">=</span><span class="st">"lower right"</span>)</span>
<span id="cb113-60"><a href="#cb113-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb113-61"><a href="#cb113-61" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">1</span>][<span class="dv">1</span>].set_xlabel(<span class="vs">r"$ x $"</span>)</span>
<span id="cb113-62"><a href="#cb113-62" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">1</span>][<span class="dv">1</span>].set_ylabel(<span class="vs">r"$ F_{\alpha}(x) $"</span>)</span>
<span id="cb113-63"><a href="#cb113-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb113-64"><a href="#cb113-64" aria-hidden="true" tabindex="-1"></a>fig.tight_layout()</span>
<span id="cb113-65"><a href="#cb113-65" aria-hidden="true" tabindex="-1"></a>plt.show()<span class="op">;</span></span></code><button title="Копіювати" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div id="fig-pdfs-dependence" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="lab_12_files/figure-html/fig-pdfs-dependence-output-1.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Рис.&nbsp;12.3: Залежність функції щільності ймовірностей альфа-стабільного розподілу Леві та кумулятивної функції щільності від різних значень параметрів розподілу</figcaption>
</figure>
</div>
</div>
</div>
</section>
<section id="віконна-процедура" class="level3" data-number="12.2.3">
<h3 data-number="12.2.3" class="anchored" data-anchor-id="віконна-процедура"><span class="header-section-number">12.2.3</span> Віконна процедура</h3>
<p>У даному блоці оберемо тип ряду для якого і виконуватимуться розрахунки. Перед нами представлено 6 варіантів представлення часового ряду. Виконуватимемо подальші обчислення для стандартизованих прибутковостей, оскільки згідно багатьом роботам було показано, що розподіл прибутковостей тих же самих фінансових активів (фондових індексів, валютних, криптовалют, тощо) виходить за межі нормального Гауссового розподілу. Покажемо це у даному ноутбуці та застосуємо альфа-стабільний розподіл Леві для кращого моделювання складних систем та передчасної ідентифікації кризових явищ.</p>
<div class="cell" data-execution_count="36">
<div class="sourceCode cell-code" id="cb114"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb114-1"><a href="#cb114-1" aria-hidden="true" tabindex="-1"></a>window <span class="op">=</span> <span class="dv">250</span>    <span class="co"># ширина ковзного вікна</span></span>
<span id="cb114-2"><a href="#cb114-2" aria-hidden="true" tabindex="-1"></a>tstep <span class="op">=</span> <span class="dv">5</span>       <span class="co"># крок</span></span>
<span id="cb114-3"><a href="#cb114-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-4"><a href="#cb114-4" aria-hidden="true" tabindex="-1"></a>ret_type <span class="op">=</span> <span class="dv">4</span>    <span class="co"># вид ряду: </span></span>
<span id="cb114-5"><a href="#cb114-5" aria-hidden="true" tabindex="-1"></a>                <span class="co"># 1 - вихідний, </span></span>
<span id="cb114-6"><a href="#cb114-6" aria-hidden="true" tabindex="-1"></a>                <span class="co"># 2 - детрендований (різниця між теп. значенням та попереднім)</span></span>
<span id="cb114-7"><a href="#cb114-7" aria-hidden="true" tabindex="-1"></a>                <span class="co"># 3 - прибутковості звичайні, </span></span>
<span id="cb114-8"><a href="#cb114-8" aria-hidden="true" tabindex="-1"></a>                <span class="co"># 4 - стандартизовані прибутковості, </span></span>
<span id="cb114-9"><a href="#cb114-9" aria-hidden="true" tabindex="-1"></a>                <span class="co"># 5 - абсолютні значення (волатильності)</span></span>
<span id="cb114-10"><a href="#cb114-10" aria-hidden="true" tabindex="-1"></a>                <span class="co"># 6 - стандартизований ряд</span></span>
<span id="cb114-11"><a href="#cb114-11" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb114-12"><a href="#cb114-12" aria-hidden="true" tabindex="-1"></a>length <span class="op">=</span> <span class="bu">len</span>(time_ser)</span>
<span id="cb114-13"><a href="#cb114-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-14"><a href="#cb114-14" aria-hidden="true" tabindex="-1"></a>alpha <span class="op">=</span> []</span>
<span id="cb114-15"><a href="#cb114-15" aria-hidden="true" tabindex="-1"></a>beta <span class="op">=</span> []</span>
<span id="cb114-16"><a href="#cb114-16" aria-hidden="true" tabindex="-1"></a>mu <span class="op">=</span> []</span>
<span id="cb114-17"><a href="#cb114-17" aria-hidden="true" tabindex="-1"></a>sigma <span class="op">=</span> []</span></code><button title="Копіювати" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="38">
<div class="sourceCode cell-code" id="cb115"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb115-1"><a href="#cb115-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> tqdm(<span class="bu">range</span>(<span class="dv">0</span>,length<span class="op">-</span>window,tstep)):</span>
<span id="cb115-2"><a href="#cb115-2" aria-hidden="true" tabindex="-1"></a>    <span class="co"># відбираємо фрагмент</span></span>
<span id="cb115-3"><a href="#cb115-3" aria-hidden="true" tabindex="-1"></a>    fragm <span class="op">=</span> time_ser.iloc[i:i<span class="op">+</span>window].copy()  </span>
<span id="cb115-4"><a href="#cb115-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-5"><a href="#cb115-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># виконуємо процедуру трансформації ряду </span></span>
<span id="cb115-6"><a href="#cb115-6" aria-hidden="true" tabindex="-1"></a>    fragm <span class="op">=</span> transformation(fragm, ret_type)</span>
<span id="cb115-7"><a href="#cb115-7" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb115-8"><a href="#cb115-8" aria-hidden="true" tabindex="-1"></a>    <span class="co"># здійснюємо підгонку розподілу під значення ряду</span></span>
<span id="cb115-9"><a href="#cb115-9" aria-hidden="true" tabindex="-1"></a>    params <span class="op">=</span> levy.fit_levy(fragm)</span>
<span id="cb115-10"><a href="#cb115-10" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb115-11"><a href="#cb115-11" aria-hidden="true" tabindex="-1"></a>    <span class="co"># отримуємо параметри розподілу</span></span>
<span id="cb115-12"><a href="#cb115-12" aria-hidden="true" tabindex="-1"></a>    a, b, m, s <span class="op">=</span> params[<span class="dv">0</span>].get(<span class="st">'0'</span>)</span>
<span id="cb115-13"><a href="#cb115-13" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb115-14"><a href="#cb115-14" aria-hidden="true" tabindex="-1"></a>    alpha.append(a)</span>
<span id="cb115-15"><a href="#cb115-15" aria-hidden="true" tabindex="-1"></a>    beta.append(b)</span>
<span id="cb115-16"><a href="#cb115-16" aria-hidden="true" tabindex="-1"></a>    mu.append(m)</span>
<span id="cb115-17"><a href="#cb115-17" aria-hidden="true" tabindex="-1"></a>    sigma.append(s)</span></code><button title="Копіювати" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>100%|██████████| 1199/1199 [05:58&lt;00:00,  3.34it/s]</code></pre>
</div>
</div>
<p>Зберігаємо абсолютні значення у текстовому документі:</p>
<div class="cell" data-execution_count="39">
<div class="sourceCode cell-code" id="cb117"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb117-1"><a href="#cb117-1" aria-hidden="true" tabindex="-1"></a>np.savetxt(<span class="ss">f"alpha_idx_</span><span class="sc">{</span>symbol<span class="sc">}</span><span class="ss">_</span><span class="sc">{</span>window<span class="sc">}</span><span class="ss">_</span><span class="sc">{</span>tstep<span class="sc">}</span><span class="ss">_</span><span class="sc">{</span>ret_type<span class="sc">}</span><span class="ss">.txt"</span>, alpha)</span>
<span id="cb117-2"><a href="#cb117-2" aria-hidden="true" tabindex="-1"></a>np.savetxt(<span class="ss">f"beta_idx_</span><span class="sc">{</span>symbol<span class="sc">}</span><span class="ss">_</span><span class="sc">{</span>window<span class="sc">}</span><span class="ss">_</span><span class="sc">{</span>tstep<span class="sc">}</span><span class="ss">_</span><span class="sc">{</span>ret_type<span class="sc">}</span><span class="ss">.txt"</span>, beta)</span>
<span id="cb117-3"><a href="#cb117-3" aria-hidden="true" tabindex="-1"></a>np.savetxt(<span class="ss">f"mu_idx_</span><span class="sc">{</span>symbol<span class="sc">}</span><span class="ss">_</span><span class="sc">{</span>window<span class="sc">}</span><span class="ss">_</span><span class="sc">{</span>tstep<span class="sc">}</span><span class="ss">_</span><span class="sc">{</span>ret_type<span class="sc">}</span><span class="ss">.txt"</span>, mu)</span>
<span id="cb117-4"><a href="#cb117-4" aria-hidden="true" tabindex="-1"></a>np.savetxt(<span class="ss">f"sigma_idx_</span><span class="sc">{</span>symbol<span class="sc">}</span><span class="ss">_</span><span class="sc">{</span>window<span class="sc">}</span><span class="ss">_</span><span class="sc">{</span>tstep<span class="sc">}</span><span class="ss">_</span><span class="sc">{</span>ret_type<span class="sc">}</span><span class="ss">.txt"</span>, sigma)</span></code><button title="Копіювати" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="динаміка-показника-стабільності-alpha" class="level3" data-number="12.2.4">
<h3 data-number="12.2.4" class="anchored" data-anchor-id="динаміка-показника-стабільності-alpha"><span class="header-section-number">12.2.4</span> Динаміка показника стабільності <span class="math inline">\(\alpha\)</span></h3>
<p>Оголошуємо мітки для рисунків та назви збережених рисунків:</p>
<div class="cell" data-execution_count="41">
<div class="sourceCode cell-code" id="cb118"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb118-1"><a href="#cb118-1" aria-hidden="true" tabindex="-1"></a>measure_label <span class="op">=</span> <span class="vs">r'$\alpha$'</span></span>
<span id="cb118-2"><a href="#cb118-2" aria-hidden="true" tabindex="-1"></a>file_name <span class="op">=</span> <span class="ss">f"alpha_idx_</span><span class="sc">{</span>symbol<span class="sc">}</span><span class="ss">_</span><span class="sc">{</span>window<span class="sc">}</span><span class="ss">_</span><span class="sc">{</span>tstep<span class="sc">}</span><span class="ss">_</span><span class="sc">{</span>ret_type<span class="sc">}</span><span class="ss">"</span></span></code><button title="Копіювати" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Виводимо результат:</p>
<div class="cell" data-execution_count="42">
<div class="sourceCode cell-code" id="cb119"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb119-1"><a href="#cb119-1" aria-hidden="true" tabindex="-1"></a>plot_pair(time_ser.index[window:length:tstep],</span>
<span id="cb119-2"><a href="#cb119-2" aria-hidden="true" tabindex="-1"></a>          time_ser.values[window:length:tstep],</span>
<span id="cb119-3"><a href="#cb119-3" aria-hidden="true" tabindex="-1"></a>          alpha, </span>
<span id="cb119-4"><a href="#cb119-4" aria-hidden="true" tabindex="-1"></a>          ylabel, </span>
<span id="cb119-5"><a href="#cb119-5" aria-hidden="true" tabindex="-1"></a>          measure_label,</span>
<span id="cb119-6"><a href="#cb119-6" aria-hidden="true" tabindex="-1"></a>          xlabel,</span>
<span id="cb119-7"><a href="#cb119-7" aria-hidden="true" tabindex="-1"></a>          file_name)</span></code><button title="Копіювати" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div id="fig-alpha" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="lab_12_files/figure-html/fig-alpha-output-1.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Рис.&nbsp;12.4: Динаміка фондового індексу BSESN та показника стабільності <span class="math inline">\(\alpha\)</span></figcaption>
</figure>
</div>
</div>
</div>
<p>Параметр <span class="math inline">\(\alpha\)</span> (індекс стабільності хвостів розподілу) починає спадати у (перед)кризовий період, що робить його індикатором(-передвісником) кризових явищ. Під час криз у розподілі прибутковостей зростає ексцес, а самі хвости стають важчими, на що даний показник реагує передчасно.</p>
</section>
<section id="динаміка-показника-асиметрії-beta" class="level3" data-number="12.2.5">
<h3 data-number="12.2.5" class="anchored" data-anchor-id="динаміка-показника-асиметрії-beta"><span class="header-section-number">12.2.5</span> Динаміка показника асиметрії <span class="math inline">\(\beta\)</span></h3>
<p>Оголошуємо мітки для рисунків та назви збережених рисунків:</p>
<div class="cell" data-execution_count="43">
<div class="sourceCode cell-code" id="cb120"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb120-1"><a href="#cb120-1" aria-hidden="true" tabindex="-1"></a>measure_label <span class="op">=</span> <span class="vs">r'$\beta$'</span></span>
<span id="cb120-2"><a href="#cb120-2" aria-hidden="true" tabindex="-1"></a>file_name <span class="op">=</span> <span class="ss">f"beta_idx_</span><span class="sc">{</span>symbol<span class="sc">}</span><span class="ss">_</span><span class="sc">{</span>window<span class="sc">}</span><span class="ss">_</span><span class="sc">{</span>tstep<span class="sc">}</span><span class="ss">_</span><span class="sc">{</span>ret_type<span class="sc">}</span><span class="ss">"</span></span></code><button title="Копіювати" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Виводимо результат:</p>
<div class="cell" data-execution_count="44">
<div class="sourceCode cell-code" id="cb121"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb121-1"><a href="#cb121-1" aria-hidden="true" tabindex="-1"></a>plot_pair(time_ser.index[window:length:tstep],</span>
<span id="cb121-2"><a href="#cb121-2" aria-hidden="true" tabindex="-1"></a>          time_ser.values[window:length:tstep],</span>
<span id="cb121-3"><a href="#cb121-3" aria-hidden="true" tabindex="-1"></a>          beta, </span>
<span id="cb121-4"><a href="#cb121-4" aria-hidden="true" tabindex="-1"></a>          ylabel, </span>
<span id="cb121-5"><a href="#cb121-5" aria-hidden="true" tabindex="-1"></a>          measure_label,</span>
<span id="cb121-6"><a href="#cb121-6" aria-hidden="true" tabindex="-1"></a>          xlabel,</span>
<span id="cb121-7"><a href="#cb121-7" aria-hidden="true" tabindex="-1"></a>          file_name)</span></code><button title="Копіювати" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div id="fig-beta" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="lab_12_files/figure-html/fig-beta-output-1.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Рис.&nbsp;12.5: Динаміка фондового індексу BSESN та показника асиметрії <span class="math inline">\(\beta\)</span></figcaption>
</figure>
</div>
</div>
</div>
<p>Динаміка даної міри виглядає набагато хаотичніше у порівнянні з індексом стабільності. Для представлених результатів можна зробити наступний висновок: у передкризовий період даний показник має зростати, вказуючи на значну правосторонню асиметрію розподілу прибутковостей (переважання позитивних прибутковостей). Для кризового періоду цей показник має спадати, вказуючи на домінацію негативних прибутковостей (лівостороння асиметрія розподілу). Даний показник важко розглядати у якості надійного індикатора, оскільки його коливання представляються значними навіть при незначних падіннях представленого фондового індексу.</p>
</section>
<section id="динаміка-параметра-зміщення-mu" class="level3" data-number="12.2.6">
<h3 data-number="12.2.6" class="anchored" data-anchor-id="динаміка-параметра-зміщення-mu"><span class="header-section-number">12.2.6</span> Динаміка параметра зміщення <span class="math inline">\(\mu\)</span></h3>
<p>Оголошуємо мітки для рисунків та назви збережених рисунків:</p>
<div class="cell" data-execution_count="45">
<div class="sourceCode cell-code" id="cb122"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb122-1"><a href="#cb122-1" aria-hidden="true" tabindex="-1"></a>measure_label <span class="op">=</span> <span class="vs">r'$\mu$'</span></span>
<span id="cb122-2"><a href="#cb122-2" aria-hidden="true" tabindex="-1"></a>file_name <span class="op">=</span> <span class="ss">f"mu_idx_</span><span class="sc">{</span>symbol<span class="sc">}</span><span class="ss">_</span><span class="sc">{</span>window<span class="sc">}</span><span class="ss">_</span><span class="sc">{</span>tstep<span class="sc">}</span><span class="ss">_</span><span class="sc">{</span>ret_type<span class="sc">}</span><span class="ss">"</span></span></code><button title="Копіювати" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Виводимо результат:</p>
<div class="cell" data-execution_count="46">
<div class="sourceCode cell-code" id="cb123"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb123-1"><a href="#cb123-1" aria-hidden="true" tabindex="-1"></a>plot_pair(time_ser.index[window:length:tstep],</span>
<span id="cb123-2"><a href="#cb123-2" aria-hidden="true" tabindex="-1"></a>          time_ser.values[window:length:tstep],</span>
<span id="cb123-3"><a href="#cb123-3" aria-hidden="true" tabindex="-1"></a>          mu, </span>
<span id="cb123-4"><a href="#cb123-4" aria-hidden="true" tabindex="-1"></a>          ylabel, </span>
<span id="cb123-5"><a href="#cb123-5" aria-hidden="true" tabindex="-1"></a>          measure_label,</span>
<span id="cb123-6"><a href="#cb123-6" aria-hidden="true" tabindex="-1"></a>          xlabel,</span>
<span id="cb123-7"><a href="#cb123-7" aria-hidden="true" tabindex="-1"></a>          file_name)</span></code><button title="Копіювати" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div id="fig-mu" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="lab_12_files/figure-html/fig-mu-output-1.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Рис.&nbsp;12.6: Динаміка фондового індексу BSESN та показника зміщення <span class="math inline">\(\mu\)</span></figcaption>
</figure>
</div>
</div>
</div>
<p>Показник розташування <span class="math inline">\(\mu\)</span> потроху спадає у кризовий період, демонструючи зміщення розподілу в сторону негативних прибутковостей. Тим не менш, цей розподіл представляєть настільки ж хаотичним як і показник асиметрії <span class="math inline">\(\beta\)</span>.</p>
</section>
<section id="динаміка-параметра-масштабу-sigma" class="level3" data-number="12.2.7">
<h3 data-number="12.2.7" class="anchored" data-anchor-id="динаміка-параметра-масштабу-sigma"><span class="header-section-number">12.2.7</span> Динаміка параметра масштабу <span class="math inline">\(\sigma\)</span></h3>
<p>Оголошуємо мітки для рисунків та назви збережених рисунків:</p>
<div class="cell" data-execution_count="47">
<div class="sourceCode cell-code" id="cb124"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb124-1"><a href="#cb124-1" aria-hidden="true" tabindex="-1"></a>measure_label <span class="op">=</span> <span class="vs">r'$\sigma$'</span></span>
<span id="cb124-2"><a href="#cb124-2" aria-hidden="true" tabindex="-1"></a>file_name <span class="op">=</span> <span class="ss">f"sigma_idx_</span><span class="sc">{</span>symbol<span class="sc">}</span><span class="ss">_</span><span class="sc">{</span>window<span class="sc">}</span><span class="ss">_</span><span class="sc">{</span>tstep<span class="sc">}</span><span class="ss">_</span><span class="sc">{</span>ret_type<span class="sc">}</span><span class="ss">"</span></span></code><button title="Копіювати" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Виводимо результат:</p>
<div class="cell" data-execution_count="48">
<div class="sourceCode cell-code" id="cb125"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb125-1"><a href="#cb125-1" aria-hidden="true" tabindex="-1"></a>plot_pair(time_ser.index[window:length:tstep],</span>
<span id="cb125-2"><a href="#cb125-2" aria-hidden="true" tabindex="-1"></a>          time_ser.values[window:length:tstep],</span>
<span id="cb125-3"><a href="#cb125-3" aria-hidden="true" tabindex="-1"></a>          sigma, </span>
<span id="cb125-4"><a href="#cb125-4" aria-hidden="true" tabindex="-1"></a>          ylabel, </span>
<span id="cb125-5"><a href="#cb125-5" aria-hidden="true" tabindex="-1"></a>          measure_label,</span>
<span id="cb125-6"><a href="#cb125-6" aria-hidden="true" tabindex="-1"></a>          xlabel,</span>
<span id="cb125-7"><a href="#cb125-7" aria-hidden="true" tabindex="-1"></a>          file_name)</span></code><button title="Копіювати" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div id="fig-sigma" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="lab_12_files/figure-html/fig-sigma-output-1.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Рис.&nbsp;12.7: Динаміка фондового індексу BSESN та показника масштабу <span class="math inline">\(\sigma\)</span></figcaption>
</figure>
</div>
</div>
</div>
<p>Із представлених результатів видно, що даний показник спадає у (перед)кризовий період, вказуючи на зменшення масштабу (форми) альфа-стабільного розподілу Леві.</p>
<p>Отже, з усіх 4-ох показників, показник стабільності <span class="math inline">\(\alpha\)</span> є найкращим для ідентифікації кризових явищ та побудови надійних стратегій ризик-менеджменту.</p>
</section>
</section>
<section id="висновок" class="level2" data-number="12.3">
<h2 data-number="12.3" class="anchored" data-anchor-id="висновок"><span class="header-section-number">12.3</span> Висновок</h2>
<p>Стабільні розподіли — захоплюючий і плідний об’єкт досліджень в теорії ймовірностей; більше того, в даний час вони мають велику цінність при моделюванні складних процесів у фізиці, астрономії, економіці, теорії комунікацій тощо.</p>
<p>У даній роботі було представлено теоретичні та чисельні обгрунтування в сторону альфа-стабільного розподілу Леві в якості практичної моделі для кращого розуміння та передбачення кризових явищ у складних системах.</p>
<p>Тут ми представили розрахунки як для усього ряду, так і для його підфрагментів, використовуючи алгоритм ковзного вікна. Виходячи з усього ряду прибутковостей, видно, що хвости їх розподілу далеко виходять за межі Гаусового. Найкраще емпіричний розподіл прибутковостей збігається саме з теоретичним альфа-стабільним розподілом Леві.</p>
<p>Використовуючи алгоритм сковзного вікна, ми побачили, що параметри альфа-стабільного розподілу змінюються з часом.</p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Література для подальшого вивчення степеневих розподілів та важких хвостів
</div>
</div>
<div class="callout-body-container callout-body">
<p>Nassim Taleb’s <a href="https://arxiv.org/ftp/arxiv/papers/2001/2001.10488.pdf"><em>Statistical Consequences of Fat Tails: Real World Preasymptotics, Epistemology, and Applications</em></a> (вільно доступна за посиланням)</p>
</div>
</div>
</section>
<section id="завдання-для-самостійної-роботи" class="level2" data-number="12.4">
<h2 data-number="12.4" class="anchored" data-anchor-id="завдання-для-самостійної-роботи"><span class="header-section-number">12.4</span> Завдання для самостійної роботи</h2>
<ol type="1">
<li>Оберіть варіант ряду у викладача</li>
<li>Для вашого ряду побудуйте еміричний розподіл його прибутковостей і порівняйте його з розподілом Гауса та альфа-стабільним розподілом Леві. Проаналізуйте отримані результати</li>
<li>Використовуючи алгоритм ковзного вікна, дослідіть динаміку 4 ключових показників альфа-стабільного розподілу для вашого ряду і зробіть висновки</li>
</ol>


<div id="refs" class="references csl-bib-body" role="list" style="display: none">
<div id="ref-10.1890/07-1288.1" class="csl-entry" role="listitem">
<div class="csl-left-margin">[1] </div><div class="csl-right-inline">E. P. White, B. J. Enquist, and J. L. Green, <em><a href="https://doi.org/10.1890/07-1288.1">On Estimating the Exponent of Power-Law Frequency Distributions</a></em>, Ecology <strong>89</strong>, 905 (2008).</div>
</div>
</div>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  let localAlternateSentinel = 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Скопійовано!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Скопійовано!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation column-body">
  <div class="nav-page nav-page-previous">
      <a href="./lab_11.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Лабораторна робота № 11</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./lab_13.html" class="pagination-link">
        <span class="nav-page-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Лабораторна робота № 13</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->



</body></html>